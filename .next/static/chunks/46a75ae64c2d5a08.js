(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8521,93582,e=>{"use strict";var t=e.i(43476),s=e.i(71645),l=e.i(73635);function a({open:e,title:l="Confirm",description:a,confirmLabel:r="Confirm",cancelLabel:i="Cancel",onConfirm:n,onCancel:c,onClose:d}){let o=(0,s.useRef)(null),u=(0,s.useRef)(null),m=(0,s.useRef)(null);return((0,s.useEffect)(()=>{if(e)return o.current?.focus(),document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t);function t(e){if("Escape"===e.key)e.preventDefault(),(d??c)?.();else if("Tab"===e.key){let t=o.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!t||0===t.length)return;let s=t[0],l=t[t.length-1];e.shiftKey&&document.activeElement===s?(e.preventDefault(),l.focus()):e.shiftKey||document.activeElement!==l||(e.preventDefault(),s.focus())}}},[e,c,d]),e)?(0,t.jsxs)("div",{role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title",tabIndex:-1,ref:o,className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>(d??c)?.()}),(0,t.jsxs)("div",{className:"bg-white rounded shadow-lg max-w-lg w-full p-6 relative z-10",children:[(0,t.jsx)("h2",{id:"confirm-title",className:"text-lg font-medium",children:l}),a&&(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:a}),(0,t.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,t.jsx)("button",{ref:u,onClick:()=>(d??c)?.(),className:"px-3 py-1 rounded bg-gray-100",children:i}),(0,t.jsx)("button",{ref:m,onClick:n,className:"px-3 py-1 rounded bg-red-600 text-white",children:r})]})]})]}):null}e.s(["default",0,({integrationId:e,isOpen:a,onClose:r})=>{let[i,n]=(0,s.useState)(!1),[c,d]=(0,s.useState)(null),[o,u]=(0,s.useState)(null),m=(0,s.useRef)(null),x=(0,l.useToast)();return((0,s.useEffect)(()=>{if(!a||!e)return;let t=!0;return n(!0),u(null),fetch(`/api/v1/integrations/${e}`).then(e=>e.json()).then(e=>{t&&(e.ok?d(e.integration??e):(u(e.error??"Failed to load integration"),d(null)))}).catch(e=>{t&&u(String(e))}).finally(()=>{t&&n(!1)}),()=>{t=!1}},[a,e]),(0,s.useEffect)(()=>{a&&setTimeout(()=>m.current?.focus(),0)},[a]),a)?(0,t.jsxs)("div",{className:"fixed inset-0 z-[60] flex",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:r}),(0,t.jsxs)("aside",{ref:m,tabIndex:-1,className:"ml-auto w-full max-w-lg bg-white dark:bg-slate-900 shadow-xl p-6 overflow-auto","aria-label":"Connector details",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Connector details"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Inspect and run actions for this connector."})]}),(0,t.jsx)("button",{onClick:r,"aria-label":"Close",className:"ml-4 rounded p-1 text-gray-600 hover:text-gray-900",children:"✕"})]}),i?(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Loading…"}):o?(0,t.jsxs)("div",{className:"text-sm text-rose-600",children:["Error: ",o]}):c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Provider: ",(0,t.jsx)("strong",{className:"text-gray-800",children:c.provider??"—"})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Name: ",(0,t.jsx)("strong",{className:"text-gray-800",children:c.name??c.id})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Created: ",(0,t.jsx)("strong",{className:"text-gray-800",children:c.created_at??"—"})]})]}),(0,t.jsxs)("section",{className:"mt-4",children:[(0,t.jsx)("h3",{className:"font-medium mb-2",children:"Configuration"}),(0,t.jsx)("pre",{className:"text-xs bg-gray-100 dark:bg-slate-800 p-3 rounded max-h-44 overflow-auto",children:JSON.stringify(c.config??{},null,2)})]}),(0,t.jsxs)("section",{className:"mt-4",children:[(0,t.jsx)("h3",{className:"font-medium mb-2",children:"Schedule"}),c.schedule?(0,t.jsx)("pre",{className:"text-sm bg-gray-50 dark:bg-slate-800 p-2 rounded",children:JSON.stringify(c.schedule,null,2)}):(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"No schedule configured"})]}),c.last_error&&(0,t.jsxs)("div",{className:"mt-4 text-sm text-rose-600",children:["Last error: ",c.last_error]}),(0,t.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,t.jsx)("button",{onClick:async()=>{try{if(!c?.id)return;let e=await fetch(`/api/v1/integrations/${c.id}/sync`,{method:"POST"}),t=await e.json().catch(()=>null);if(!e.ok||!t?.ok)return void x.error(t?.error??"Failed to start sync");x.success("Sync queued")}catch(e){x.error(String(e?.message??e))}},className:"px-4 py-2 rounded bg-blue-600 text-white",children:"Sync now"}),(0,t.jsx)("a",{href:`/integrations/${c.id}/edit`,className:"px-4 py-2 rounded border text-sm text-gray-700 hover:bg-gray-50",children:"Edit"})]})]}):(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"No integration selected"})]})]}):null}],8521),e.s(["ConfirmDialog",()=>a],93582)},98478,e=>{"use strict";var t=e.i(43476),s=e.i(71645);let l=["","sku","title","description","price","inventory","weight","brand","image","category"];function a({open:e,headers:a,initialMapping:r={},onSave:i,onClose:n}){let[c,d]=(0,s.useState)({});return((0,s.useEffect)(()=>{let e={};for(let t of a){if(r[t]){e[t]=r[t];continue}let s=t.toLowerCase();s.includes("sku")?e[t]="sku":s.includes("title")||s.includes("name")?e[t]="title":s.includes("desc")?e[t]="description":s.includes("price")?e[t]="price":s.includes("qty")||s.includes("inventory")||s.includes("stock")?e[t]="inventory":e[t]=""}d(e)},[a,r]),e)?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-3xl rounded-lg bg-white p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Map source columns to product fields"}),(0,t.jsx)("button",{onClick:n,className:"px-2 py-1 text-sm",children:"Close"})]}),(0,t.jsx)("div",{className:"mt-3 max-h-[60vh] overflow-auto",children:(0,t.jsxs)("table",{className:"w-full table-auto",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Source column"}),(0,t.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Map to field"})]})}),(0,t.jsx)("tbody",{children:a.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-2 text-sm",children:e}),(0,t.jsx)("td",{className:"py-2",children:(0,t.jsx)("select",{value:c[e]??"",onChange:t=>{var s;return s=t.target.value,void d(t=>({...t,[e]:s}))},className:"rounded border px-2 py-1 text-sm",children:l.map(e=>(0,t.jsx)("option",{value:e,children:""===e?"-- ignore --":e},e))})})]},e))})]})}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{i(c)},className:"px-3 py-2 rounded bg-emerald-500 text-white",children:"Save mapping"}),(0,t.jsx)("button",{onClick:n,className:"px-3 py-2 rounded border",children:"Cancel"})]})]})}):null}var r=e.i(73635);function i({bucket:l="imports",maxRows:i=5e3,maxCols:n=50,onCreated:c,className:d,platform:o=null}){let u=(0,r.useToast)(),[m,x]=(0,s.useState)(null),[h,f]=(0,s.useState)([]),[p,g]=(0,s.useState)([]),[j,y]=(0,s.useState)(!1),[b,v]=(0,s.useState)(null),[N,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,P]=(0,s.useState)(null);async function O(t){v(null),y(!0),f([]),g([]),P(null);try{let s=t.name.split(".").pop()?.toLowerCase();if("csv"===s||"txt"===s){let s=await e.A(49481),l=s&&(s.default??s);await new Promise((e,s)=>{l.parse(t,{header:!0,preview:50,skipEmptyLines:!0,complete:t=>{f(t.meta?.fields??[]),g(t.data??[]),e()},error:e=>s(e)})})}else if("xlsx"===s||"xls"===s){let s=await e.A(42078),l=new FileReader;l.onload=e=>{try{let t=e.target?.result,l=s.read(t,{type:"array"}),a=s.utils.sheet_to_json(l.Sheets[l.SheetNames[0]],{defval:""});f(a.length?Object.keys(a[0]):[]),g(a.slice(0,50))}catch(e){v(e?.message??String(e))}finally{y(!1)}},l.onerror=()=>{v("Failed to read file for preview"),y(!1)},l.readAsArrayBuffer(t);return}else v("Preview unavailable for this file type")}catch(e){v(e?.message??String(e))}finally{y(!1)}}async function E(){if(v(null),!m)return void v("No file selected");if(h.length>n)return void v(`Too many columns (max ${n}). Please reduce columns.`);w(!0);try{let e=new FormData;if(e.append("file",m,m.name),S)try{e.append("mapping",JSON.stringify(S))}catch(e){}o&&e.append("platform",String(o));let t=await fetch("/api/upload-to-supabase",{method:"POST",body:e}),s=await t.json().catch(()=>null);if(!t.ok||!s?.ok){let e=s?.error??`Upload failed: ${t.status}`;v(e),u?.error?.(e);return}let a=s?.jobId??s?.data?.id??s?.inserted?.id??null,r=s?.file_path??s?.data?.path??s?.data?.raw?.fullPath??s?.data?.raw?.path??null;if(a){if(S)try{await fetch(`/api/v1/ingest/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({mapping:S})})}catch{}u?.success?.(`Upload succeeded — job ${a}`),c?.(a);return}let i=r?String(r):null;if(!a&&i){let e=i.startsWith(`${l}/`)||i.startsWith("/")?i.replace(/^\/+/,""):`${l}/${i}`;try{let t=await fetch("/api/imports",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({file_path:e,file_name:m.name,file_format:m.name.split(".").pop()?.toLowerCase()??null,mapping:S??null,platform:o??null})}),s=await t.json().catch(()=>null);if(!t.ok||!s?.ok){let e=s?.error??`Create import job failed: ${t.status}`;v(e),u?.error?.(e);return}let l=s.jobId??s.id??s.data?.id??null;if(l){u?.success?.(`Import job created: ${l}`),c?.(l);return}u?.info?.("Upload succeeded; import job created (no id returned)."),c?.("");return}catch(t){let e=String(t?.message??t);v(e),u?.error?.(e);return}}u?.info?.("Upload succeeded but no job id/path returned from server. Check server logs."),c?.("")}catch(t){let e=String(t?.message??t);v(e),u?.error?.(e)}finally{w(!1)}}return(0,s.useEffect)(()=>{m||(f([]),g([]),v(null))},[m]),(0,t.jsxs)("div",{className:d,children:[(0,t.jsx)("div",{children:(0,t.jsx)("input",{type:"file",accept:"*/*",onChange:e=>{let t=e.target.files?.[0]??null;x(t),t&&O(t)}})}),j&&(0,t.jsx)("div",{className:"mt-3 text-sm",children:"Loading preview…"}),b&&(0,t.jsx)("div",{className:"mt-3 text-sm text-rose-700",children:b}),h.length>0&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Preview headers"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:()=>C(!0),className:"text-xs px-2 py-1 border rounded mr-2",children:"Open mapping"}),(0,t.jsx)("button",{onClick:()=>{f([]),g([]),x(null),P(null)},className:"text-xs px-2 py-1 border rounded",children:"Clear"})]})]}),(0,t.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(h)}),(0,t.jsx)("div",{className:"mt-3 text-xs text-slate-500",children:"Preview rows"}),(0,t.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(p.slice(0,5),null,2)}),(0,t.jsx)("div",{className:"mt-4 flex gap-2",children:(0,t.jsx)("button",{onClick:E,disabled:N,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:N?"Uploading…":"Upload & Create Import"})})]}),!h.length&&!j&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"No preview available for this file type. You can still upload."}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:E,disabled:N,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:N?"Uploading…":"Upload & Create Import"}),(0,t.jsx)("button",{onClick:()=>{x(null),v(null)},className:"inline-flex items-center rounded px-3 py-2 border text-sm",children:"Clear"})]})]}),(0,t.jsx)(a,{open:k,headers:h,initialMapping:S??{},onSave:e=>{P(e),C(!1)},onClose:()=>C(!1)})]})}e.s(["default",()=>i],98478)},42078,e=>{e.v(t=>Promise.all(["static/chunks/d82ffea2b057bdc1.js","static/chunks/49458c2d41402225.js"].map(t=>e.l(t))).then(()=>t(70016)))},49481,e=>{e.v(t=>Promise.all(["static/chunks/f8af89e108860c77.js"].map(t=>e.l(t))).then(()=>t(59935)))}]);