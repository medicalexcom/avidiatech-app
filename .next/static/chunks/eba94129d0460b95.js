(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,98478,e=>{"use strict";var t=e.i(43476),s=e.i(71645);let l=["","sku","title","description","price","inventory","weight","brand","image","category"];function a({open:e,headers:a,initialMapping:i={},onSave:r,onClose:n}){let[c,d]=(0,s.useState)({});return((0,s.useEffect)(()=>{let e={};for(let t of a){if(i[t]){e[t]=i[t];continue}let s=t.toLowerCase();s.includes("sku")?e[t]="sku":s.includes("title")||s.includes("name")?e[t]="title":s.includes("desc")?e[t]="description":s.includes("price")?e[t]="price":s.includes("qty")||s.includes("inventory")||s.includes("stock")?e[t]="inventory":e[t]=""}d(e)},[a,i]),e)?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-3xl rounded-lg bg-white p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Map source columns to product fields"}),(0,t.jsx)("button",{onClick:n,className:"px-2 py-1 text-sm",children:"Close"})]}),(0,t.jsx)("div",{className:"mt-3 max-h-[60vh] overflow-auto",children:(0,t.jsxs)("table",{className:"w-full table-auto",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Source column"}),(0,t.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Map to field"})]})}),(0,t.jsx)("tbody",{children:a.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-2 text-sm",children:e}),(0,t.jsx)("td",{className:"py-2",children:(0,t.jsx)("select",{value:c[e]??"",onChange:t=>{var s;return s=t.target.value,void d(t=>({...t,[e]:s}))},className:"rounded border px-2 py-1 text-sm",children:l.map(e=>(0,t.jsx)("option",{value:e,children:""===e?"-- ignore --":e},e))})})]},e))})]})}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{r(c)},className:"px-3 py-2 rounded bg-emerald-500 text-white",children:"Save mapping"}),(0,t.jsx)("button",{onClick:n,className:"px-3 py-2 rounded border",children:"Cancel"})]})]})}):null}var i=e.i(73635);function r({bucket:l="imports",maxRows:r=5e3,maxCols:n=50,onCreated:c,className:d,platform:o=null}){let u=(0,i.useToast)(),[m,p]=(0,s.useState)(null),[x,h]=(0,s.useState)([]),[f,j]=(0,s.useState)([]),[b,y]=(0,s.useState)(!1),[g,v]=(0,s.useState)(null),[w,N]=(0,s.useState)(!1),[C,S]=(0,s.useState)(!1),[k,P]=(0,s.useState)(null);async function U(t){v(null),y(!0),h([]),j([]),P(null);try{let s=t.name.split(".").pop()?.toLowerCase();if("csv"===s||"txt"===s){let s=await e.A(49481),l=s&&(s.default??s);await new Promise((e,s)=>{l.parse(t,{header:!0,preview:50,skipEmptyLines:!0,complete:t=>{h(t.meta?.fields??[]),j(t.data??[]),e()},error:e=>s(e)})})}else if("xlsx"===s||"xls"===s){let s=await e.A(42078),l=new FileReader;l.onload=e=>{try{let t=e.target?.result,l=s.read(t,{type:"array"}),a=s.utils.sheet_to_json(l.Sheets[l.SheetNames[0]],{defval:""});h(a.length?Object.keys(a[0]):[]),j(a.slice(0,50))}catch(e){v(e?.message??String(e))}finally{y(!1)}},l.onerror=()=>{v("Failed to read file for preview"),y(!1)},l.readAsArrayBuffer(t);return}else v("Preview unavailable for this file type")}catch(e){v(e?.message??String(e))}finally{y(!1)}}async function O(){if(v(null),!m)return void v("No file selected");if(x.length>n)return void v(`Too many columns (max ${n}). Please reduce columns.`);N(!0);try{let e=new FormData;if(e.append("file",m,m.name),k)try{e.append("mapping",JSON.stringify(k))}catch(e){}o&&e.append("platform",String(o));let t=await fetch("/api/upload-to-supabase",{method:"POST",body:e}),s=await t.json().catch(()=>null);if(!t.ok||!s?.ok){let e=s?.error??`Upload failed: ${t.status}`;v(e),u?.error?.(e);return}let a=s?.jobId??s?.data?.id??s?.inserted?.id??null,i=s?.file_path??s?.data?.path??s?.data?.raw?.fullPath??s?.data?.raw?.path??null;if(a){if(k)try{await fetch(`/api/v1/ingest/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({mapping:k})})}catch{}u?.success?.(`Upload succeeded — job ${a}`),c?.(a);return}let r=i?String(i):null;if(!a&&r){let e=r.startsWith(`${l}/`)||r.startsWith("/")?r.replace(/^\/+/,""):`${l}/${r}`;try{let t=await fetch("/api/imports",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({file_path:e,file_name:m.name,file_format:m.name.split(".").pop()?.toLowerCase()??null,mapping:k??null,platform:o??null})}),s=await t.json().catch(()=>null);if(!t.ok||!s?.ok){let e=s?.error??`Create import job failed: ${t.status}`;v(e),u?.error?.(e);return}let l=s.jobId??s.id??s.data?.id??null;if(l){u?.success?.(`Import job created: ${l}`),c?.(l);return}u?.info?.("Upload succeeded; import job created (no id returned)."),c?.("");return}catch(t){let e=String(t?.message??t);v(e),u?.error?.(e);return}}u?.info?.("Upload succeeded but no job id/path returned from server. Check server logs."),c?.("")}catch(t){let e=String(t?.message??t);v(e),u?.error?.(e)}finally{N(!1)}}return(0,s.useEffect)(()=>{m||(h([]),j([]),v(null))},[m]),(0,t.jsxs)("div",{className:d,children:[(0,t.jsx)("div",{children:(0,t.jsx)("input",{type:"file",accept:"*/*",onChange:e=>{let t=e.target.files?.[0]??null;p(t),t&&U(t)}})}),b&&(0,t.jsx)("div",{className:"mt-3 text-sm",children:"Loading preview…"}),g&&(0,t.jsx)("div",{className:"mt-3 text-sm text-rose-700",children:g}),x.length>0&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Preview headers"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:()=>S(!0),className:"text-xs px-2 py-1 border rounded mr-2",children:"Open mapping"}),(0,t.jsx)("button",{onClick:()=>{h([]),j([]),p(null),P(null)},className:"text-xs px-2 py-1 border rounded",children:"Clear"})]})]}),(0,t.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(x)}),(0,t.jsx)("div",{className:"mt-3 text-xs text-slate-500",children:"Preview rows"}),(0,t.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(f.slice(0,5),null,2)}),(0,t.jsx)("div",{className:"mt-4 flex gap-2",children:(0,t.jsx)("button",{onClick:O,disabled:w,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:w?"Uploading…":"Upload & Create Import"})})]}),!x.length&&!b&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"No preview available for this file type. You can still upload."}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:O,disabled:w,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:w?"Uploading…":"Upload & Create Import"}),(0,t.jsx)("button",{onClick:()=>{p(null),v(null)},className:"inline-flex items-center rounded px-3 py-2 border text-sm",children:"Clear"})]})]}),(0,t.jsx)(a,{open:C,headers:x,initialMapping:k??{},onSave:e=>{P(e),S(!1)},onClose:()=>S(!1)})]})}e.s(["default",()=>r],98478)},65583,e=>{"use strict";var t=e.i(43476),s=e.i(98478);function l(){return(0,t.jsx)("main",{className:"flex min-h-screen items-center justify-center bg-gray-50 px-4 py-12",children:(0,t.jsx)("div",{className:"w-full max-w-xl",children:(0,t.jsxs)("div",{className:"rounded-lg bg-white p-6 shadow-sm",children:[(0,t.jsx)("h1",{className:"text-xl font-semibold mb-3",children:"Create import"}),(0,t.jsx)("p",{className:"text-sm text-slate-500 mb-4",children:"Upload a CSV or Excel file. Max rows: 5000, Max columns: 50."}),(0,t.jsx)(s.default,{bucket:"imports",onCreated:e=>{e?window.location.href=`/imports/${e}`:window.location.reload()}})]})})})}e.s(["default",()=>l])},42078,e=>{e.v(t=>Promise.all(["static/chunks/d82ffea2b057bdc1.js","static/chunks/49458c2d41402225.js"].map(t=>e.l(t))).then(()=>t(70016)))},49481,e=>{e.v(t=>Promise.all(["static/chunks/f8af89e108860c77.js"].map(t=>e.l(t))).then(()=>t(59935)))}]);