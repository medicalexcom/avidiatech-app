(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70363,e=>{"use strict";var t=e.i(43476),i=e.i(71645),r=e.i(67034);class s extends Error{constructor(e,t,i,...n){for(const o of(Array.isArray(t)&&(t=t.join(" ").trim()),super(t),void 0!==Error.captureStackTrace&&Error.captureStackTrace(this,s),this.code=e,n))for(const e in o){const t=o[e];this[e]=r.Buffer.isBuffer(t)?t.toString(i.encoding):null==t?t:JSON.parse(JSON.stringify(t))}}}let n=function(e){let t=[];for(let i=0,r=e.length;i<r;i++){let r=e[i];if(null==r||!1===r)t[i]={disabled:!0};else if("string"==typeof r)t[i]={name:r};else{if("object"!=typeof r||null===r||Array.isArray(r))throw new s("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(r)} at position ${i}`]);if("string"!=typeof r.name)throw new s("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${i}`,"when column is an object literal"]);t[i]=r}}return t},o=class{constructor(e=100){this.size=e,this.length=0,this.buf=r.Buffer.allocUnsafe(e)}prepend(e){if(r.Buffer.isBuffer(e)){let t=this.length+e.length;if(t>=this.size&&(this.resize(),t>=this.size))throw Error("INVALID_BUFFER_STATE");let i=this.buf;this.buf=r.Buffer.allocUnsafe(this.size),e.copy(this.buf,0),i.copy(this.buf,e.length),this.length+=e.length}else{let t=this.length++;t===this.size&&this.resize();let i=this.clone();this.buf[0]=e,i.copy(this.buf,1,0,t)}}append(e){let t=this.length++;t===this.size&&this.resize(),this.buf[t]=e}clone(){return r.Buffer.from(this.buf.slice(0,this.length))}resize(){let e=this.length;this.size=2*this.size;let t=r.Buffer.allocUnsafe(this.size);this.buf.copy(t,0,0,e),this.buf=t}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}},l=function(e){let t={};for(let i in e)t[i.replace(/([A-Z])/g,function(e,t){return"_"+t.toLowerCase()})]=e[i];if(void 0===t.encoding||!0===t.encoding)t.encoding="utf8";else if(null===t.encoding||!1===t.encoding)t.encoding=null;else if("string"!=typeof t.encoding&&null!==t.encoding)throw new s("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(t.encoding)}`],t);if(void 0===t.bom||null===t.bom||!1===t.bom)t.bom=!1;else if(!0!==t.bom)throw new s("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(t.bom)}`],t);if(t.cast_function=null,void 0===t.cast||null===t.cast||!1===t.cast||""===t.cast)t.cast=void 0;else if("function"==typeof t.cast)t.cast_function=t.cast,t.cast=!0;else if(!0!==t.cast)throw new s("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(t.cast)}`],t);if(void 0===t.cast_date||null===t.cast_date||!1===t.cast_date||""===t.cast_date)t.cast_date=!1;else if(!0===t.cast_date)t.cast_date=function(e){let t=Date.parse(e);return isNaN(t)?e:new Date(t)};else if("function"!=typeof t.cast_date)throw new s("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(t.cast_date)}`],t);if(t.cast_first_line_to_header=null,!0===t.columns)t.cast_first_line_to_header=void 0;else if("function"==typeof t.columns)t.cast_first_line_to_header=t.columns,t.columns=!0;else if(Array.isArray(t.columns))t.columns=n(t.columns);else if(void 0===t.columns||null===t.columns||!1===t.columns)t.columns=!1;else throw new s("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(t.columns)}`],t);if(void 0===t.group_columns_by_name||null===t.group_columns_by_name||!1===t.group_columns_by_name)t.group_columns_by_name=!1;else if(!0!==t.group_columns_by_name)throw new s("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(t.group_columns_by_name)}`],t);else if(!1===t.columns)throw new s("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],t);if(void 0===t.comment||null===t.comment||!1===t.comment||""===t.comment)t.comment=null;else if("string"==typeof t.comment&&(t.comment=r.Buffer.from(t.comment,t.encoding)),!r.Buffer.isBuffer(t.comment))throw new s("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(t.comment)}`],t);if(void 0===t.comment_no_infix||null===t.comment_no_infix||!1===t.comment_no_infix)t.comment_no_infix=!1;else if(!0!==t.comment_no_infix)throw new s("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(t.comment_no_infix)}`],t);let i=JSON.stringify(t.delimiter);if(Array.isArray(t.delimiter)||(t.delimiter=[t.delimiter]),0===t.delimiter.length)throw new s("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${i}`],t);if(t.delimiter=t.delimiter.map(function(e){if(null==e||!1===e)return r.Buffer.from(",",t.encoding);if("string"==typeof e&&(e=r.Buffer.from(e,t.encoding)),!r.Buffer.isBuffer(e)||0===e.length)throw new s("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${i}`],t);return e}),void 0===t.escape||!0===t.escape?t.escape=r.Buffer.from('"',t.encoding):"string"==typeof t.escape?t.escape=r.Buffer.from(t.escape,t.encoding):(null===t.escape||!1===t.escape)&&(t.escape=null),null!==t.escape&&!r.Buffer.isBuffer(t.escape))throw Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(t.escape)}`);if(void 0===t.from||null===t.from)t.from=1;else if("string"==typeof t.from&&/\d+/.test(t.from)&&(t.from=parseInt(t.from)),Number.isInteger(t.from)){if(t.from<0)throw Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(e.from)}`)}else throw Error(`Invalid Option: from must be an integer, got ${JSON.stringify(t.from)}`);if(void 0===t.from_line||null===t.from_line)t.from_line=1;else if("string"==typeof t.from_line&&/\d+/.test(t.from_line)&&(t.from_line=parseInt(t.from_line)),Number.isInteger(t.from_line)){if(t.from_line<=0)throw Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(e.from_line)}`)}else throw Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(e.from_line)}`);if(void 0===t.ignore_last_delimiters||null===t.ignore_last_delimiters)t.ignore_last_delimiters=!1;else if("number"==typeof t.ignore_last_delimiters)t.ignore_last_delimiters=Math.floor(t.ignore_last_delimiters),0===t.ignore_last_delimiters&&(t.ignore_last_delimiters=!1);else if("boolean"!=typeof t.ignore_last_delimiters)throw new s("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(t.ignore_last_delimiters)}`],t);if(!0===t.ignore_last_delimiters&&!1===t.columns)throw new s("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],t);if(void 0===t.info||null===t.info||!1===t.info)t.info=!1;else if(!0!==t.info)throw Error(`Invalid Option: info must be true, got ${JSON.stringify(t.info)}`);if(void 0===t.max_record_size||null===t.max_record_size||!1===t.max_record_size)t.max_record_size=0;else if(Number.isInteger(t.max_record_size)&&t.max_record_size>=0);else if("string"==typeof t.max_record_size&&/\d+/.test(t.max_record_size))t.max_record_size=parseInt(t.max_record_size);else throw Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(t.max_record_size)}`);if(void 0===t.objname||null===t.objname||!1===t.objname)t.objname=void 0;else if(r.Buffer.isBuffer(t.objname)){if(0===t.objname.length)throw Error("Invalid Option: objname must be a non empty buffer");null===t.encoding||(t.objname=t.objname.toString(t.encoding))}else if("string"==typeof t.objname){if(0===t.objname.length)throw Error("Invalid Option: objname must be a non empty string")}else if("number"==typeof t.objname);else throw Error(`Invalid Option: objname must be a string or a buffer, got ${t.objname}`);if(void 0!==t.objname){if("number"==typeof t.objname){if(!1!==t.columns)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(!1===t.columns)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(void 0===t.on_record||null===t.on_record)t.on_record=void 0;else if("function"!=typeof t.on_record)throw new s("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(t.on_record)}`],t);if(void 0!==t.on_skip&&null!==t.on_skip&&"function"!=typeof t.on_skip)throw Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(t.on_skip)}`);if(null===t.quote||!1===t.quote||""===t.quote)t.quote=null;else if(void 0===t.quote||!0===t.quote?t.quote=r.Buffer.from('"',t.encoding):"string"==typeof t.quote&&(t.quote=r.Buffer.from(t.quote,t.encoding)),!r.Buffer.isBuffer(t.quote))throw Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(t.quote)}`);if(void 0===t.raw||null===t.raw||!1===t.raw)t.raw=!1;else if(!0!==t.raw)throw Error(`Invalid Option: raw must be true, got ${JSON.stringify(t.raw)}`);if(void 0===t.record_delimiter)t.record_delimiter=[];else if("string"==typeof t.record_delimiter||r.Buffer.isBuffer(t.record_delimiter)){if(0===t.record_delimiter.length)throw new s("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(t.record_delimiter)}`],t);t.record_delimiter=[t.record_delimiter]}else if(!Array.isArray(t.record_delimiter))throw new s("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(t.record_delimiter)}`],t);if(t.record_delimiter=t.record_delimiter.map(function(e,i){if("string"==typeof e||r.Buffer.isBuffer(e)){if(0===e.length)throw new s("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${i},`,`got ${JSON.stringify(e)}`],t)}else throw new s("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${i},`,`got ${JSON.stringify(e)}`],t);return"string"==typeof e&&(e=r.Buffer.from(e,t.encoding)),e}),"boolean"==typeof t.relax_column_count);else if(void 0===t.relax_column_count||null===t.relax_column_count)t.relax_column_count=!1;else throw Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(t.relax_column_count)}`);if("boolean"==typeof t.relax_column_count_less);else if(void 0===t.relax_column_count_less||null===t.relax_column_count_less)t.relax_column_count_less=!1;else throw Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(t.relax_column_count_less)}`);if("boolean"==typeof t.relax_column_count_more);else if(void 0===t.relax_column_count_more||null===t.relax_column_count_more)t.relax_column_count_more=!1;else throw Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(t.relax_column_count_more)}`);if("boolean"==typeof t.relax_quotes);else if(void 0===t.relax_quotes||null===t.relax_quotes)t.relax_quotes=!1;else throw Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(t.relax_quotes)}`);if("boolean"==typeof t.skip_empty_lines);else if(void 0===t.skip_empty_lines||null===t.skip_empty_lines)t.skip_empty_lines=!1;else throw Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(t.skip_empty_lines)}`);if("boolean"==typeof t.skip_records_with_empty_values);else if(void 0===t.skip_records_with_empty_values||null===t.skip_records_with_empty_values)t.skip_records_with_empty_values=!1;else throw Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(t.skip_records_with_empty_values)}`);if("boolean"==typeof t.skip_records_with_error);else if(void 0===t.skip_records_with_error||null===t.skip_records_with_error)t.skip_records_with_error=!1;else throw Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(t.skip_records_with_error)}`);if(void 0===t.rtrim||null===t.rtrim||!1===t.rtrim)t.rtrim=!1;else if(!0!==t.rtrim)throw Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(t.rtrim)}`);if(void 0===t.ltrim||null===t.ltrim||!1===t.ltrim)t.ltrim=!1;else if(!0!==t.ltrim)throw Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(t.ltrim)}`);if(void 0===t.trim||null===t.trim||!1===t.trim)t.trim=!1;else if(!0!==t.trim)throw Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(t.trim)}`);if(!0===t.trim&&!1!==e.ltrim?t.ltrim=!0:!0!==t.ltrim&&(t.ltrim=!1),!0===t.trim&&!1!==e.rtrim?t.rtrim=!0:!0!==t.rtrim&&(t.rtrim=!1),void 0===t.to||null===t.to)t.to=-1;else if("string"==typeof t.to&&/\d+/.test(t.to)&&(t.to=parseInt(t.to)),Number.isInteger(t.to)){if(t.to<=0)throw Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(e.to)}`)}else throw Error(`Invalid Option: to must be an integer, got ${JSON.stringify(e.to)}`);if(void 0===t.to_line||null===t.to_line)t.to_line=-1;else if("string"==typeof t.to_line&&/\d+/.test(t.to_line)&&(t.to_line=parseInt(t.to_line)),Number.isInteger(t.to_line)){if(t.to_line<=0)throw Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(e.to_line)}`)}else throw Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(e.to_line)}`);return t},a=function(e){return e.every(e=>null==e||e.toString&&""===e.toString().trim())},d={utf8:r.Buffer.from([239,187,191]),utf16le:r.Buffer.from([255,254])},c=function(e={}){let t=l(e);return{info:{bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},original_options:e,options:t,state:{bomSkipped:!1,bufBytesStart:0,castField:t.cast_function,commenting:!1,error:void 0,enabled:1===t.from_line,escaping:!1,escapeIsQuote:r.Buffer.isBuffer(t.escape)&&r.Buffer.isBuffer(t.quote)&&0===r.Buffer.compare(t.escape,t.quote),expectedRecordLength:Array.isArray(t.columns)?t.columns.length:void 0,field:new o(20),firstLineToHeaders:t.cast_first_line_to_header,needMoreDataSize:Math.max(null!==t.comment?t.comment.length:0,...t.delimiter.map(e=>e.length),null!==t.quote?t.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new o(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:0===t.record_delimiter.length?0:Math.max(...t.record_delimiter.map(e=>e.length)),trimChars:[r.Buffer.from(" ",t.encoding)[0],r.Buffer.from("	",t.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[r.Buffer.from(r.Buffer.from([13],"utf8").toString(),t.encoding),r.Buffer.from(r.Buffer.from([10],"utf8").toString(),t.encoding),r.Buffer.from(r.Buffer.from([12],"utf8").toString(),t.encoding),r.Buffer.from(r.Buffer.from([32],"utf8").toString(),t.encoding),r.Buffer.from(r.Buffer.from([9],"utf8").toString(),t.encoding)]},__needMoreData:function(e,t,i){if(i)return!1;let{encoding:s,escape:n,quote:o}=this.options,{quoting:l,needMoreDataSize:a,recordDelimiterMaxLength:d}=this.state;return t-e-1<Math.max(a,0===d?r.Buffer.from("\r\n",s).length:d,l?(null===n?0:n.length)+o.length:0,l?o.length+d:0)},parse:function(e,t,i,n){let o,a,{bom:c,comment_no_infix:f,encoding:u,from_line:h,ltrim:m,max_record_size:_,raw:p,relax_quotes:g,rtrim:b,skip_empty_lines:x,to:y,to_line:v}=this.options,{comment:w,escape:N,quote:j,record_delimiter:S}=this.options,{bomSkipped:I,previousBuf:O,rawBuffer:C,escapeIsQuote:R}=this.state;if(void 0===O)if(void 0===e)return void n();else o=e;else o=void 0!==O&&void 0===e?O:r.Buffer.concat([O,e]);if(!1===I)if(!1===c)this.state.bomSkipped=!0;else if(o.length<3){if(!1===t){this.state.previousBuf=o;return}}else{for(let e in d)if(0===d[e].compare(o,0,d[e].length)){let t=d[e].length;this.state.bufBytesStart+=t,o=o.slice(t),this.options=l({...this.original_options,encoding:e}),{comment:w,escape:N,quote:j}=this.options;break}this.state.bomSkipped=!0}let E=o.length;for(a=0;a<E&&!this.__needMoreData(a,E,t);a++){if(!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1),-1!==v&&this.info.lines>v){this.state.stop=!0,n();return}!1===this.state.quoting&&0===S.length&&this.__autoDiscoverRecordDelimiter(o,a)&&(S=this.options.record_delimiter);let e=o[a];if(!0===p&&C.append(e),(13===e||10===e)&&!1===this.state.wasRowDelimiter&&(this.state.wasRowDelimiter=!0),!0===this.state.escaping)this.state.escaping=!1;else{if(null!==N&&!0===this.state.quoting&&this.__isEscape(o,a,e)&&a+N.length<E)if(R){if(this.__isQuote(o,a+N.length)){this.state.escaping=!0,a+=N.length-1;continue}}else{this.state.escaping=!0,a+=N.length-1;continue}if(!1===this.state.commenting&&this.__isQuote(o,a))if(!0===this.state.quoting){let t=o[a+j.length],i=b&&this.__isCharTrimable(o,a+j.length),r=null!==w&&this.__compareBytes(w,o,a+j.length,t),n=this.__isDelimiter(o,a+j.length,t),l=0===S.length?this.__autoDiscoverRecordDelimiter(o,a+j.length):this.__isRecordDelimiter(t,o,a+j.length);if(null!==N&&this.__isEscape(o,a,e)&&this.__isQuote(o,a+N.length))a+=N.length-1;else if(!t||n||l||r||i){this.state.quoting=!1,this.state.wasQuoting=!0,a+=j.length-1;continue}else if(!1===g){let e=this.__error(new s("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(t)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(void 0!==e)return e}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(j),a+=j.length-1}else if(0!==this.state.field.length){if(!1===g){let e=this.__infoField(),t=Object.keys(d).map(e=>!!d[e].equals(this.state.field.toString())&&e).filter(Boolean)[0],i=this.__error(new s("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(e.column)} at line ${e.lines}, value is ${JSON.stringify(this.state.field.toString(u))}`,t?`(${t} bom)`:void 0],this.options,e,{field:this.state.field}));if(void 0!==i)return i}}else{this.state.quoting=!0,a+=j.length-1;continue}if(!1===this.state.quoting){let t=this.__isRecordDelimiter(e,o,a);if(0!==t){if(this.state.commenting&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length)this.info.comment_lines++;else{if(!1===this.state.enabled&&this.info.lines+ +(!0===this.state.wasRowDelimiter)>=h){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),a+=t-1;continue}if(!0===x&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length){this.info.empty_lines++,a+=t-1;continue}this.info.bytes=this.state.bufBytesStart+a;let e=this.__onField();if(void 0!==e)return e;this.info.bytes=this.state.bufBytesStart+a+t;let r=this.__onRecord(i);if(void 0!==r)return r;if(-1!==y&&this.info.records>=y){this.state.stop=!0,n();return}}this.state.commenting=!1,a+=t-1;continue}if(this.state.commenting)continue;if(null!==w&&(!1===f||0===this.state.record.length&&0===this.state.field.length)&&0!==this.__compareBytes(w,o,a,e)){this.state.commenting=!0;continue}let r=this.__isDelimiter(o,a,e);if(0!==r){this.info.bytes=this.state.bufBytesStart+a;let e=this.__onField();if(void 0!==e)return e;a+=r-1;continue}}}if(!1===this.state.commenting&&0!==_&&this.state.record_length+this.state.field.length>_)return this.__error(new s("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${_}`,`at line ${this.info.lines}`],this.options,this.__infoField()));let t=!1===m||!0===this.state.quoting||0!==this.state.field.length||!this.__isCharTrimable(o,a),r=!1===b||!1===this.state.wasQuoting;if(!0===t&&!0===r)this.state.field.append(e);else{if(!0===b&&!this.__isCharTrimable(o,a))return this.__error(new s("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));!1===t&&(a+=this.__isCharTrimable(o,a)-1);continue}}if(!0===t)if(!0===this.state.quoting){let e=this.__error(new s("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(void 0!==e)return e}else if(!0===this.state.wasQuoting||0!==this.state.record.length||0!==this.state.field.length){this.info.bytes=this.state.bufBytesStart+a;let e=this.__onField();if(void 0!==e)return e;let t=this.__onRecord(i);if(void 0!==t)return t}else!0===this.state.wasRowDelimiter?this.info.empty_lines++:!0===this.state.commenting&&this.info.comment_lines++;else this.state.bufBytesStart+=a,this.state.previousBuf=o.slice(a);!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(e){let{columns:t,group_columns_by_name:i,encoding:r,info:n,from:o,relax_column_count:l,relax_column_count_less:d,relax_column_count_more:c,raw:f,skip_records_with_empty_values:u}=this.options,{enabled:h,record:m}=this.state;if(!1===h)return this.__resetRecord();let _=m.length;if(!0===t)return!0===u&&a(m)?void this.__resetRecord():this.__firstLineToColumns(m);if(!1===t&&0===this.info.records&&(this.state.expectedRecordLength=_),_!==this.state.expectedRecordLength){let e=!1===t?new s("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${_} on line ${this.info.lines}`],this.options,this.__infoField(),{record:m}):new s("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${t.length},`,`got ${_} on line ${this.info.lines}`],this.options,this.__infoField(),{record:m});if(!0===l||!0===d&&_<this.state.expectedRecordLength||!0===c&&_>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=e;else{let t=this.__error(e);if(t)return t}}if(!0===u&&a(m))return void this.__resetRecord();if(!0===this.state.recordHasError){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,1===o||this.info.records>=o){let{objname:s}=this.options;if(!1!==t){let o={};for(let e=0,r=m.length;e<r;e++)void 0===t[e]||t[e].disabled||(!0===i&&void 0!==o[t[e].name]?Array.isArray(o[t[e].name])?o[t[e].name]=o[t[e].name].concat(m[e]):o[t[e].name]=[o[t[e].name],m[e]]:o[t[e].name]=m[e]);if(!0===f||!0===n){let t=Object.assign({record:o},!0===f?{raw:this.state.rawBuffer.toString(r)}:{},!0===n?{info:this.__infoRecord()}:{}),i=this.__push(void 0===s?t:[o[s],t],e);if(i)return i}else{let t=this.__push(void 0===s?o:[o[s],o],e);if(t)return t}}else if(!0===f||!0===n){let t=Object.assign({record:m},!0===f?{raw:this.state.rawBuffer.toString(r)}:{},!0===n?{info:this.__infoRecord()}:{}),i=this.__push(void 0===s?t:[m[s],t],e);if(i)return i}else{let t=this.__push(void 0===s?m:[m[s],m],e);if(t)return t}}this.__resetRecord()},__firstLineToColumns:function(e){let{firstLineToHeaders:t}=this.state;try{let i=void 0===t?e:t.call(null,e);if(!Array.isArray(i))return this.__error(new s("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(i)}`],this.options,this.__infoField(),{headers:i}));let r=n(i);this.state.expectedRecordLength=r.length,this.options.columns=r,this.__resetRecord();return}catch(e){return e}},__resetRecord:function(){!0===this.options.raw&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){let{cast:e,encoding:t,rtrim:i,max_record_size:r}=this.options,{enabled:s,wasQuoting:n}=this.state;if(!1===s)return this.__resetField();let o=this.state.field.toString(t);if(!0===i&&!1===n&&(o=o.trimRight()),!0===e){let[e,t]=this.__cast(o);if(void 0!==e)return e;o=t}this.state.record.push(o),0!==r&&"string"==typeof o&&(this.state.record_length+=o.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(e,t){let{on_record:i}=this.options;if(void 0!==i){let t=this.__infoRecord();try{e=i.call(null,e,t)}catch(e){return e}if(null==e)return}t(e)},__cast:function(e){let{columns:t,relax_column_count:i}=this.options;if(!0===Array.isArray(t)&&i&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(null!==this.state.castField)try{let t=this.__infoField();return[void 0,this.state.castField.call(null,e,t)]}catch(e){return[e]}if(this.__isFloat(e))return[void 0,parseFloat(e)];if(!1!==this.options.cast_date){let t=this.__infoField();return[void 0,this.options.cast_date.call(null,e,t)]}return[void 0,e]},__isCharTrimable:function(e,t){return((e,t)=>{let{timchars:i}=this.state;e:for(let r=0;r<i.length;r++){let s=i[r];for(let i=0;i<s.length;i++)if(s[i]!==e[t+i])continue e;return s.length}return 0})(e,t)},__isFloat:function(e){return e-parseFloat(e)+1>=0},__compareBytes:function(e,t,i,r){if(e[0]!==r)return 0;let s=e.length;for(let r=1;r<s;r++)if(e[r]!==t[i+r])return 0;return s},__isDelimiter:function(e,t,i){let{delimiter:r,ignore_last_delimiters:s}=this.options;if(!0===s&&this.state.record.length===this.options.columns.length-1||!1!==s&&"number"==typeof s&&this.state.record.length===s-1)return 0;e:for(let s=0;s<r.length;s++){let n=r[s];if(n[0]===i){for(let i=1;i<n.length;i++)if(n[i]!==e[t+i])continue e;return n.length}}return 0},__isRecordDelimiter:function(e,t,i){let{record_delimiter:r}=this.options,s=r.length;e:for(let n=0;n<s;n++){let s=r[n],o=s.length;if(s[0]===e){for(let e=1;e<o;e++)if(s[e]!==t[i+e])continue e;return s.length}}return 0},__isEscape:function(e,t,i){let{escape:r}=this.options;if(null===r)return!1;let s=r.length;if(r[0]===i){for(let i=0;i<s;i++)if(r[i]!==e[t+i])return!1;return!0}return!1},__isQuote:function(e,t){let{quote:i}=this.options;if(null===i)return!1;let r=i.length;for(let s=0;s<r;s++)if(i[s]!==e[t+s])return!1;return!0},__autoDiscoverRecordDelimiter:function(e,t){let{encoding:i}=this.options,s=[r.Buffer.from("\r\n",i),r.Buffer.from("\n",i),r.Buffer.from("\r",i)];t:for(let i=0;i<s.length;i++){let r=s[i].length;for(let n=0;n<r;n++)if(s[i][n]!==e[t+n])continue t;return this.options.record_delimiter.push(s[i]),this.state.recordDelimiterMaxLength=s[i].length,s[i].length}return 0},__error:function(e){let{encoding:t,raw:i,skip_records_with_error:r}=this.options,s="string"==typeof e?Error(e):e;if(!r)return s;this.state.recordHasError=!0,void 0!==this.options.on_skip&&this.options.on_skip(s,i?this.state.rawBuffer.toString(t):void 0)},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){let{columns:e,raw:t,encoding:i}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:!0===e,index:this.state.record.length,raw:t?this.state.rawBuffer.toString(i):void 0}},__infoField:function(){let{columns:e}=this.options,t=Array.isArray(e);return{...this.__infoRecord(),column:!0===t?e.length>this.state.record.length?e[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},f=function(e,t={}){"string"==typeof e&&(e=r.Buffer.from(e));let i=t&&t.objname?{}:[],s=c(t),n=e=>{void 0===s.options.objname?i.push(e):i[e[0]]=e[1]},o=()=>{},l=s.parse(e,!1,n,o);if(void 0!==l)throw l;let a=s.parse(void 0,!0,n,o);if(void 0!==a)throw a;return i};function u(){let[e,r]=(0,i.useState)(""),[s,n]=(0,i.useState)(!1),[o,l]=(0,i.useState)(null),[a,d]=(0,i.useState)([]);async function c(){n(!0);let{items:t,warnings:i}=function(e){if(!(e=(e||"").toString().trim()))return{items:[],warnings:[]};let t=[];try{t=f(e,{trim:!0,skip_empty_lines:!0})}catch{t=e.split(/\r?\n/).map(e=>e.split(",").map(e=>e.trim())).filter(e=>e.length>0&&e[0])}let i=new Set,r=[],s=[];for(let e of t){let t=(e[0]||"").toString().trim();if(!t){s.push("empty-sku-row");continue}let n=t?t.toString().trim().toLowerCase().replace(/[^a-z0-9\-_]/g,""):"";if(!n){s.push(`invalid-sku:${t}`);continue}let o=(e[1]||"").toString().trim(),l=o&&(o?o.toString().trim().toLowerCase().replace(/[\u00A0\u2000-\u200B]+/g," ").replace(/[^\w\-\s]/g," ").replace(/\s+/g," ").trim():"")||void 0,a=(e[2]||"").toString().trim()||void 0,d=`${n}|${l||""}|${a||""}`;if(i.has(d)){s.push(`duplicate:${n}`);continue}i.add(d),r.push({sku:n,brand:l,gtin:a})}return{items:r,warnings:s}}(e);d(i);try{let e=await fetch("/api/v1/match",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({items:t})}),i=await e.json();i.jobId&&l(i.jobId)}catch(e){console.error(e),alert("submit failed")}finally{n(!1)}}return(0,t.jsxs)("div",{style:{border:"1px solid #ddd",padding:12,borderRadius:6},children:[(0,t.jsx)("h3",{children:"Upload or Paste SKUs"}),(0,t.jsx)("textarea",{value:e,onChange:e=>r(e.target.value),rows:6,style:{width:"100%"},placeholder:"sku,brand,gtin per line"}),(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsx)("button",{onClick:c,disabled:s,children:"Submit"}),o&&(0,t.jsxs)("span",{style:{marginLeft:12},children:["Job: ",o]})]}),a.length>0&&(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsx)("strong",{children:"Warnings:"}),(0,t.jsx)("ul",{children:a.map((e,i)=>(0,t.jsx)("li",{children:e},i))})]})]})}function h(){return(0,t.jsxs)("div",{style:{marginTop:12},children:[(0,t.jsx)("strong",{children:"Job progress:"})," ",(0,t.jsx)("span",{children:"0 submitted / 0 candidates / 0 failed"})]})}function m(){return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{children:"Filter: "}),(0,t.jsxs)("select",{children:[(0,t.jsx)("option",{children:"All"}),(0,t.jsx)("option",{children:"High (≥0.90)"}),(0,t.jsx)("option",{children:"Needs Review (0.70–0.89)"}),(0,t.jsx)("option",{children:"No match"}),(0,t.jsx)("option",{children:"Confirmed"}),(0,t.jsx)("option",{children:"Rejected"})]})]})}function _(){let[e,r]=(0,i.useState)([]);return((0,i.useEffect)(()=>{},[]),e.length)?(0,t.jsxs)("table",{style:{width:"100%",marginTop:12,borderCollapse:"collapse"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"SKU"}),(0,t.jsx)("th",{children:"Brand"}),(0,t.jsx)("th",{children:"Suggested URL"}),(0,t.jsx)("th",{children:"Confidence"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:e.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.sku}),(0,t.jsx)("td",{children:e.brand_hint}),(0,t.jsx)("td",{children:(0,t.jsx)("a",{href:e.candidate_url,target:"_blank",rel:"noreferrer",children:e.candidate_url})}),(0,t.jsx)("td",{children:(e.confidence||0).toFixed(2)}),(0,t.jsx)("td",{children:e.status}),(0,t.jsxs)("td",{children:[(0,t.jsx)("button",{children:"Confirm"}),(0,t.jsx)("button",{children:"Reject"}),(0,t.jsx)("button",{children:"Ingest"})]})]},e.id))})]}):(0,t.jsx)("div",{style:{marginTop:12},children:"No results yet."})}function p(){return(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{children:"Confirm selected"}),(0,t.jsx)("button",{children:"Reject selected"}),(0,t.jsx)("button",{children:"Ingest selected"})]})}function g(e){if(null==e)return"";let t="string"==typeof e?e:String(e);return t.includes('"')||t.includes(",")||t.includes("\n")||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}function b(){let[r,s]=(0,i.useState)([]),[n,o]=(0,i.useState)(!1),[l,a]=(0,i.useState)(null),[d,c]=(0,i.useState)(null),[f,b]=(0,i.useState)(null),[x,y]=(0,i.useState)(!1),[v,w]=(0,i.useState)(!1),[N,j]=(0,i.useState)(!1),[S,I]=(0,i.useState)([]),[O,C]=(0,i.useState)(!1),[R,E]=(0,i.useState)(void 0),[k,B]=(0,i.useState)(50),[$,D]=(0,i.useState)(0),L=(0,i.useCallback)(async t=>{if(a(null),s([]),t){o(!0);try{let i,r=await e.A(42078),n=r&&r.default?r.default:r;if(!n||"function"!=typeof n.read)throw Error("xlsx library not available in browser");if((t.name||"").toLowerCase().endsWith(".csv")){let e=await t.text();i=n.read(e,{type:"string",raw:!1})}else{let e=await t.arrayBuffer();i=n.read(e,{type:"array",raw:!1})}if(!i||!i.SheetNames||0===i.SheetNames.length)throw Error("Workbook empty or unreadable");let o=i.SheetNames.find(e=>/searchexport/i.test(e))??i.SheetNames[0],l=i.Sheets[o];if(!l)throw Error(`Sheet not found: ${o}`);let a=n.utils.sheet_to_json(l,{defval:"",blankrows:!1}).slice(0,200).map((e,t)=>({row_id:String(t+1),supplier_name:String(e["Supplier Name"]??e.supplier??e.supplier_name??e.Vendor??"").trim(),sku:String(e.SKU??e.sku??e["Item SKU"]??e.mpn??"").trim(),ndc_item_code:String(e["NDC Item Code"]??e.NDC??e.ndc??"").trim(),product_name:String(e["Product Name"]??e["Item Name"]??e.name??e.title??"").trim(),brand_name:String(e["Brand Name"]??e.Brand??e.brand??"").trim(),raw:e}));s(a)}catch(e){console.error("Failed to parse uploaded file:",e),a(String(e?.message??e)),alert(`Failed to parse file: ${String(e?.message??e)} — see console`)}finally{o(!1)}}},[]),T=(0,i.useCallback)(async e=>{try{let t=await fetch(`/api/v1/match/url-jobs/${encodeURIComponent(e)}`),i=await t.json().catch(()=>null);if(t.ok&&i?.ok)return b(i.job??null),i.job??null;return null}catch(e){return console.warn("fetchJobStatus error",e),null}},[]),A=(0,i.useCallback)(async(e,t,i=50,r=0)=>{C(!0);try{let s=new URL(`/api/v1/match/url-jobs/${encodeURIComponent(e)}/rows`,location.origin);t&&s.searchParams.set("status",t),s.searchParams.set("limit",String(i)),s.searchParams.set("offset",String(r));let n=await fetch(s.toString()),o=await n.json().catch(()=>null);if(!n.ok||!o?.ok)return I([]),[];return I(o.rows??[]),o.rows??[]}catch(e){return console.warn("fetchResultsRows error",e),I([]),[]}finally{C(!1)}},[]),J=(0,i.useCallback)(async e=>{if(e){j(!0);try{for(;;){let t=await T(e);if(t&&["running","partial","succeeded"].includes(t.status)&&await A(e,R,k,$),!t||["succeeded","failed","partial","canceled"].includes(t?.status))break;await new Promise(e=>setTimeout(e,2500))}}finally{j(!1)}}},[T,A,R,k,$]),V=(0,i.useCallback)(async e=>{let t=(e??r)||[];if(!t.length)return alert("No preview rows to create job from."),null;y(!0);try{let e={file_name:`upload-${Date.now()}`,rows:t.map(e=>({...e,raw:e.raw}))},i=await fetch("/api/v1/match/url-jobs",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),r=await i.json().catch(()=>null);if(!i.ok||!r?.ok)return alert("Create job failed: "+(r?.error??i.statusText)),null;return c(r.job_id),await T(r.job_id),await A(r.job_id,R,k,$),r.job_id}catch(e){return console.error("createJob error:",e),alert("Create job failed (see console)"),null}finally{y(!1)}},[r,T,A,k,$,R]),U=(0,i.useCallback)(async e=>{let t=e??d;if(!t)return alert("No job selected to start.");w(!0);try{let e=await fetch(`/api/v1/match/url-jobs/${encodeURIComponent(t)}/start`,{method:"POST"}),i=await e.json().catch(()=>null);if(!e.ok||!i?.ok)return void alert("Start job failed: "+(i?.error??e.statusText));J(t)}catch(e){console.error("startJob error:",e)}finally{w(!1)}},[d,J]),M=(0,i.useCallback)(async()=>{let e=await V();e&&await U(e)},[V,U]),P=(0,i.useCallback)(async()=>{if(!d)return alert("No job selected");try{let e=await fetch(`/api/v1/match/url-jobs/${encodeURIComponent(d)}/requeue`,{method:"POST"}),t=await e.json().catch(()=>null);if(!e.ok||!t?.ok)return void alert("Retry failed: "+(t?.error??e.statusText));await U(d),setTimeout(()=>A(d,R,k,$),2500)}catch(e){console.error("retryUnresolved error:",e),alert("Retry failed (see console)")}},[d,U,A,k,$,R]);(0,i.useEffect)(()=>{d?A(d,R,k,$):I([])},[d]);let q=(0,i.useCallback)(async(e,t)=>{if(!d)return alert("No job context");if(confirm("Approve this candidate URL and mark row resolved?"))try{let i=await fetch(`/api/v1/match/url-jobs/${encodeURIComponent(d)}/rows/${encodeURIComponent(e)}/approve`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({approved_url:t})}),r=await i.json().catch(()=>null);if(!i.ok||!r?.ok)return void alert("Approve failed: "+(r?.error??i.statusText));await A(d,R,k,$),await T(d)}catch(e){console.error("approveCandidate error:",e),alert("Approve failed (see console)")}},[d,A,T,R,k,$]),[F,z]=(0,i.useState)({}),Q=(0,i.useCallback)(e=>z(t=>({...t,[e]:!t[e]})),[]),G=(0,i.useCallback)(()=>z({}),[]),H=(0,i.useCallback)(async()=>{if(!d)return alert("No job selected");let e=Object.keys(F).filter(e=>F[e]);if(!e.length)return alert("No rows selected");if(confirm(`Approve ${e.length} selected rows using their top candidate?`)){for(let t of e){let e=S.find(e=>e.id===t||e.row_id===t),i=e?.candidates?.[0]?.url??null;i&&await q(e.id??e.row_id,i)}G(),d&&await A(d,R,k,$)}},[F,S,d,q,k,$,R]),K=(0,i.useCallback)(()=>{if(!S||0===S.length)return alert("No results to export");let e=["row_id","supplier_name","sku","ndc_item_code","product_name","brand_name"],t=new Set;for(let e of S){let i=e.raw??{};i&&"object"==typeof i&&Object.keys(i).forEach(e=>t.add(e))}let i=new Set(Array.from(e).map(e=>e.toLowerCase())),r=Array.from(t).filter(e=>!i.has(e.toLowerCase())),s=[...e,...r,"status","resolved_url","resolved_domain","confidence","candidates"],n=[];for(let t of(n.push(s.map(g).join(",")),S)){let i=t.raw??{},s=[];for(let r of e){let e=t[r]??i[r]??i[r.replace(/\s+/g," ")]??"";s.push(e)}for(let e of r){let t=i[e]??"";s.push(t)}let o="";Array.isArray(t.candidates)&&t.candidates.length&&(o=t.candidates.map(e=>"string"==typeof e?e:e.url??JSON.stringify(e)).join(" | ")),s.push(t.status??"",t.resolved_url??"",t.resolved_domain??"",t.confidence??"",o),n.push(s.map(g).join(","))}let o=new Blob([n.join("\n")],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(o),a=document.createElement("a");a.href=l;let c=`match-results-${d??Date.now()}.csv`;a.setAttribute("download",c),document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(l)},[S,d]),X=(0,i.useMemo)(()=>({onFile:L}),[L]),W=(0,i.useMemo)(()=>({rows:S,loading:O,selectedRowIds:F,toggleRowSelection:Q,onRefresh:()=>d&&A(d,R,k,$),approveCandidate:q}),[S,O,F,Q,d,A,R,k,$,q]),Y=(0,i.useMemo)(()=>({selectedCount:Object.keys(F).filter(e=>F[e]).length,onBulkApprove:H,onClearSelection:G}),[F,H,G]);return(0,t.jsx)("main",{className:"relative min-h-screen overflow-hidden bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-50",children:(0,t.jsxs)("div",{className:"px-4 py-6 sm:px-6 lg:px-10 lg:py-8 max-w-7xl mx-auto",children:[(0,t.jsxs)("header",{className:"mb-6 flex items-start justify-between gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs text-slate-500",children:"Data Intelligence · AvidiaMatch"}),(0,t.jsx)("h1",{className:"mt-3 text-2xl font-bold",children:"Match — SKU → Product URL"}),(0,t.jsx)("p",{className:"text-sm text-slate-600",children:"Upload competitor/product sheets, create jobs and verify candidate URLs."})]}),(0,t.jsx)("div",{className:"w-72",children:(0,t.jsxs)("div",{className:"rounded-xl border p-3 bg-white",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Job"}),(0,t.jsx)("div",{className:"mt-2 font-mono text-sm break-all",children:d?`job:${d}`:"No job"}),(0,t.jsx)("div",{className:"mt-2 text-xs text-slate-500",children:f?f.status:"status: —"}),(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,t.jsx)("button",{onClick:()=>M(),disabled:n||x||!r.length,className:"w-full rounded bg-emerald-600 px-3 py-2 text-sm text-white disabled:opacity-60",children:x||v?"Working…":"Upload & Create"}),(0,t.jsx)("button",{onClick:()=>void V(),disabled:n||x||!r.length,className:"w-full rounded border px-3 py-2 text-sm disabled:opacity-60",children:x?"Creating…":"Create job from preview"}),(0,t.jsx)("button",{onClick:()=>void U(d),disabled:!d||v||N,className:"w-full rounded border px-3 py-2 text-sm disabled:opacity-60",children:v||N?"Starting…":"Start resolve"}),(0,t.jsx)("button",{onClick:()=>d&&A(d,R,k,$),disabled:!d,className:"w-full rounded border px-3 py-2 text-sm mt-1",children:"Refresh rows"}),(0,t.jsx)("button",{onClick:()=>P(),disabled:!d,className:"w-full rounded border px-3 py-2 text-sm mt-1",children:"Retry unresolved"}),(0,t.jsx)("button",{onClick:()=>K(),disabled:!S||0===S.length,className:"w-full rounded border px-3 py-2 text-sm mt-2",children:"Download CSV"})]})]})})]}),(0,t.jsxs)("section",{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1.1fr)]",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-2xl border bg-white p-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-sm font-semibold",children:"1 · Upload or paste data"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Upload XLSX/CSV or paste rows."})]})}),(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsx)(u,{...X}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{id:"match-upload-file",type:"file",accept:".xlsx,.xls,.csv",onChange:e=>L(e.target.files?.[0]??null),className:"rounded border p-2"}),(0,t.jsx)("label",{htmlFor:"match-upload-file",className:"text-xs text-slate-500",children:"Upload XLSX/CSV"}),n&&(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Parsing…"})]}),l?(0,t.jsxs)("div",{className:"text-xs text-red-600",children:["Parse error: ",l]}):null,(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Preview shows up to 200 rows."}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-slate-600",children:["Preview rows: ",r.length]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border bg-white p-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-sm font-semibold",children:"2 · Refine matches"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Filter by status and apply bulk actions."})]})}),(0,t.jsxs)("div",{className:"mt-3 flex gap-4",children:[(0,t.jsx)(m,{onChangeStatus:e=>{E(e||void 0),d&&A(d,e||void 0,k,0)}}),(0,t.jsx)(p,{...Y})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border bg-white p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold",children:"3 · Review results"}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Live match grid"})]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)(_,{...W}),S&&S.length>0?(0,t.jsxs)("div",{className:"mt-4 rounded-md border bg-white p-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Fallback: Raw rows (simple view)"}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsxs)("table",{className:"w-full table-auto text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"text-left",children:[(0,t.jsx)("th",{className:"px-2 py-1",children:"Row ID"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"SKU"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Product Name"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Supplier"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Status"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Resolved URL"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Confidence"})]})}),(0,t.jsx)("tbody",{children:S.map(e=>(0,t.jsxs)("tr",{className:"border-t align-top",children:[(0,t.jsx)("td",{className:"px-2 py-1 align-top",children:e.row_id??e.id}),(0,t.jsx)("td",{className:"px-2 py-1 align-top",children:e.sku}),(0,t.jsx)("td",{className:"px-2 py-1 align-top",children:e.product_name}),(0,t.jsx)("td",{className:"px-2 py-1 align-top",children:e.supplier_name}),(0,t.jsx)("td",{className:"px-2 py-1 align-top",children:e.status}),(0,t.jsx)("td",{className:"px-2 py-1 align-top",children:e.resolved_url?(0,t.jsx)("a",{href:e.resolved_url,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:e.resolved_url}):Array.isArray(e.candidates)&&e.candidates.length?(0,t.jsx)("div",{className:"text-xs",children:e.candidates.slice(0,3).map((e,i)=>(0,t.jsx)("div",{children:(0,t.jsx)("a",{href:e.url??("string"==typeof e?e:""),target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:e.url??e})},i))}):(0,t.jsx)("span",{className:"text-xs text-slate-500",children:"—"})}),(0,t.jsx)("td",{className:"px-2 py-1 align-top",children:e.confidence??""})]},e.id))})]})})]}):(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-3",children:"No rows to display yet."})]})]})]}),(0,t.jsxs)("aside",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-2xl border bg-white p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold",children:"Match queue"}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(h,{jobId:d,jobStatus:f,startJob:()=>U(d),refresh:()=>d&&T(d),polling:N})})]}),(0,t.jsxs)("div",{className:"rounded-2xl border-dashed bg-slate-50 p-4",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold text-slate-500",children:"Tips for better matching"}),(0,t.jsxs)("ul",{className:"mt-2 text-xs text-slate-600",children:[(0,t.jsx)("li",{children:"Include manufacturer part numbers (MPN) where possible."}),(0,t.jsx)("li",{children:"One row per variant improves accuracy."}),(0,t.jsx)("li",{children:"Use consistent brand names with AvidiaExtract."})]})]})]})]})]})})}e.s(["default",()=>b],70363)}]);