(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,91937,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function s(...e){return e.filter(Boolean).join(" ")}function r(e){return Math.max(1,Math.round(24*e*3600))}function l({days:e,onChange:r,ariaLabel:l,className:n}){let d=[1,7,14,30],i=Math.max(1,Math.round(e||14)),[o,c]=(0,a.useState)(d.includes(i)?String(i):"custom"),[x,m]=(0,a.useState)(i);return(0,a.useEffect)(()=>{let t=Math.max(1,Math.round(e||14));c(d.includes(t)?String(t):"custom"),m(t)},[e]),(0,t.jsxs)("div",{className:s("relative inline-flex items-center gap-2",n),children:[(0,t.jsxs)("select",{"aria-label":l??"frequency-presets",value:o,onChange:e=>{let t=e.target.value;if(c(t),"custom"===t)return;let a=Number(t);m(a),r(a)},className:"h-8 rounded-md border border-slate-200 bg-white px-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-slate-200",children:[d.map(e=>(0,t.jsx)("option",{value:String(e),children:String(e)},e)),(0,t.jsx)("option",{value:"custom",children:"Custom…"})]}),(0,t.jsx)("span",{className:"text-xs text-slate-500",children:"days"}),"custom"===o?(0,t.jsxs)("div",{className:"absolute left-0 top-full z-20 mt-2 w-[260px] rounded-xl border border-slate-200 bg-white p-3 shadow-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"number",min:1,step:1,value:x,onChange:e=>m(Number(e.target.value)),className:"h-8 w-24 rounded-md border border-slate-200 bg-white px-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-slate-200",title:"Custom days between checks"}),(0,t.jsx)("button",{onClick:()=>r(Math.max(1,Math.round(x))),className:"h-8 rounded-md bg-indigo-600 px-3 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200",title:"Apply custom frequency (days)",children:"Apply"}),(0,t.jsx)("button",{onClick:()=>c(String(14)),className:"h-8 rounded-md border border-slate-200 bg-white px-3 text-xs font-semibold text-slate-700 shadow-sm hover:bg-slate-50",title:"Close",children:"Close"})]}),(0,t.jsx)("div",{className:"mt-2 text-[11px] text-slate-500",children:"Enter a number of days, then Apply."})]}):null]})}function n({status:e}){let a=(e??"unknown").toLowerCase(),r={ok:"border-emerald-200 bg-emerald-50 text-emerald-700",changed:"border-amber-200 bg-amber-50 text-amber-700",scrape_failed:"border-red-200 bg-red-50 text-red-700",error:"border-red-200 bg-red-50 text-red-700",unknown:"border-slate-200 bg-slate-50 text-slate-700"},l=r[a]??r.unknown;return(0,t.jsx)("span",{className:s("inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold capitalize",l),children:a.replace("_"," ")})}function d({tone:e}){return(0,t.jsx)("span",{className:s("inline-block h-2 w-2 rounded-full","ok"===e?"bg-emerald-500":"warn"===e?"bg-amber-500":"bad"===e?"bg-red-500":"bg-slate-400")})}let i="h-8 rounded-md px-3 text-xs font-semibold shadow-sm transition focus:outline-none focus:ring-2";s(i,"border border-slate-200 bg-white text-slate-700 hover:bg-slate-50 focus:ring-slate-200");let o=s(i,"bg-sky-600 text-white hover:bg-sky-500 focus:ring-sky-200"),c=s(i,"bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-60 disabled:cursor-not-allowed focus:ring-indigo-200"),x=s(i,"bg-slate-900 text-white hover:bg-slate-800 focus:ring-slate-300");function m({watch:e,onSaveFreq:s,onTriggerCheck:r,onUpdate:i}){var m;let h=((m=e?.frequency_seconds)&&"number"==typeof m?Math.max(1,Math.round(m/86400)):null)??14,[u,b]=(0,a.useState)(h),[g,p]=(0,a.useState)(!1);(0,a.useEffect)(()=>{b(h)},[h]);let f=String(e?.last_status??"unknown").toLowerCase(),v="ok"===f?"ok":"changed"===f?"warn":f.includes("error")||f.includes("fail")?"bad":"neutral";return(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-3 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-start lg:justify-between",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d,{tone:v}),(0,t.jsx)("div",{className:"truncate text-sm font-semibold text-slate-900",children:e.source_url})]}),(0,t.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[(0,t.jsx)(n,{status:e.last_status}),(0,t.jsx)("span",{className:"text-slate-300",children:"·"}),(0,t.jsx)("span",{className:"whitespace-nowrap",children:e.last_check_at?new Date(e.last_check_at).toLocaleString():"never"}),e.muted_until?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-slate-300",children:"·"}),(0,t.jsx)("span",{className:"whitespace-nowrap text-slate-400",children:"muted"})]}):null]})]}),(0,t.jsxs)("div",{className:"flex shrink-0 flex-wrap items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>r(e.id),className:o,title:"Run a check now",children:"Check"}),(0,t.jsx)("button",{onClick:async()=>{p(!0);try{await s(e.id,u)}finally{p(!1)}},disabled:g,className:c,title:"Save frequency",children:g?"Saving…":"Save"}),(0,t.jsx)("button",{onClick:()=>i(e.id,{muted_until:e.muted_until?null:new Date(Date.now()+864e5).toISOString()}),className:x,title:e.muted_until?"Unmute":"Mute 24h",children:e.muted_until?"Unmute":"Mute"})]})]}),(0,t.jsxs)("div",{className:"mt-3 flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-slate-600",children:"Frequency"}),(0,t.jsx)(l,{days:u,onChange:e=>b(e),ariaLabel:`Frequency for ${e.source_url}`})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 lg:justify-end",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-slate-600",children:"Price Δ %"}),(0,t.jsx)("input",{type:"number",defaultValue:e.price_threshold_percent??"",onBlur:t=>i(e.id,{price_threshold_percent:t.currentTarget.value?Number(t.currentTarget.value):null}),className:"h-8 w-24 rounded-md border border-slate-200 bg-white px-2 text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-slate-200"})]})]})]})}function h(){let[e,s]=(0,a.useState)([]),[n,d]=(0,a.useState)([]),[i,o]=(0,a.useState)(!1),[c,x]=(0,a.useState)(""),[h,u]=(0,a.useState)(14);async function b(){o(!0);try{let e=await fetch("/api/monitor/watches"),t=await e.json().catch(()=>null);e.ok&&t?.ok?s(t.watches??[]):s([])}finally{o(!1)}}async function g(e){o(!0);try{let t=e?`/api/monitor/events?watchId=${encodeURIComponent(e)}`:"/api/monitor/events",a=await fetch(t),s=await a.json().catch(()=>null);a.ok&&s?.ok?d(s.events??[]):d([])}finally{o(!1)}}async function p(){if(!c)return void alert("Enter a URL to watch");o(!0);try{let e={source_url:c,frequency_seconds:r(h)},t=await fetch("/api/monitor/watches",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),a=await t.json().catch(()=>null);t.ok&&a?.ok?(x(""),await b()):alert("Failed to create watch: "+(a?.error??t.statusText))}finally{o(!1)}}async function f(e,t){let a={frequency_seconds:r(t)},s=await fetch(`/api/monitor/watches/${encodeURIComponent(e)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(a)}),l=await s.json().catch(()=>null);s.ok&&l?.ok?await b():alert("Save frequency failed: "+(l?.error??s.statusText))}async function v(e,t){try{let a=await fetch(`/api/monitor/watches/${encodeURIComponent(e)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)}),s=await a.json().catch(()=>null);a.ok&&s?.ok?await b():alert("Update failed: "+(s?.error??a.statusText))}catch(e){alert(String(e?.message??e))}}async function k(e){o(!0);try{let t=await fetch("/api/monitor/check",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({watchId:e})}),a=await t.json().catch(()=>null);t.ok&&a?.ok?(alert("Check result: "+(a?.result?.changed?"changed":"no_change")),await b(),await g(e)):alert("Check failed: "+(a?.error??t.statusText))}finally{o(!1)}}return(0,a.useEffect)(()=>{b(),g();let e=setInterval(()=>{b(),g()},3e4);return()=>clearInterval(e)},[]),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center",children:[(0,t.jsx)("input",{value:c,onChange:e=>x(e.target.value),className:"border rounded px-3 py-2 flex-1",placeholder:"https://example.com/product/...","aria-label":"New watch URL"}),(0,t.jsx)("div",{className:"flex items-center gap-2 shrink-0",children:(0,t.jsx)(l,{days:h,onChange:e=>u(e),ariaLabel:"New watch frequency (days)"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:p,className:"px-3 py-2 rounded bg-indigo-600 text-white shadow hover:bg-indigo-500",children:"Add Watch"}),(0,t.jsx)("button",{onClick:()=>{b(),g()},className:"px-3 py-2 rounded border border-slate-200 bg-white hover:bg-slate-50",children:"Refresh"})]})]}),(0,t.jsxs)("div",{style:{maxHeight:"64vh",overflowY:"auto"},className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold",children:"Watches"}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:e.length?`${e.length} total`:""})]}),(0,t.jsx)("div",{className:"mt-2 space-y-3",children:i&&!e.length?(0,t.jsx)("div",{className:"text-sm text-slate-500",children:"Loading…"}):0===e.length?(0,t.jsx)("div",{className:"text-sm text-slate-500",children:"No watches configured yet"}):e.slice(0,10).map(e=>(0,t.jsx)(m,{watch:e,onSaveFreq:f,onTriggerCheck:k,onUpdate:v},e.id))}),e.length>10?(0,t.jsxs)("div",{className:"mt-3 text-xs text-slate-500",children:["Showing ",10," of ",e.length," watches. ",(0,t.jsx)("a",{className:"underline",href:"/dashboard/monitor/all",children:"View all"})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold",children:"Recent events"}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:n.length?`${n.length} total`:""})]}),(0,t.jsx)("div",{className:"mt-2 space-y-2",children:i&&!n.length?(0,t.jsx)("div",{className:"text-sm text-slate-500",children:"Loading…"}):0===n.length?(0,t.jsx)("div",{className:"text-sm text-slate-500",children:"No events"}):n.slice(0,10).map(e=>(0,t.jsxs)("div",{className:"p-2 border rounded bg-slate-50",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:e.event_type}),(0,t.jsx)("div",{className:"text-sm font-medium text-slate-900 break-words",children:e.payload?.snapshot?.title??e.payload?.snapshot?.url}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:new Date(e.created_at).toLocaleString()})]},e.id))}),n.length>10?(0,t.jsxs)("div",{className:"mt-3 text-xs text-slate-500",children:["Showing ",10," of ",n.length," events. ",(0,t.jsx)("a",{className:"underline",href:"/dashboard/monitor/events",children:"View all"})]}):null]})]})]})}function u(...e){return e.filter(Boolean).join(" ")}function b({title:e,value:a,caption:s,tone:r="blue"}){let l={blue:{border:"border-sky-200/70 dark:border-sky-500/20",wash:"from-sky-500/10 via-sky-500/0 to-transparent dark:from-sky-400/10 dark:via-sky-400/0",glowA:"bg-sky-400/16 dark:bg-sky-500/12",glowB:"bg-indigo-400/10 dark:bg-indigo-500/10",top:"from-sky-400/55 via-sky-300/20 to-transparent dark:from-sky-300/35 dark:via-sky-300/15"},purple:{border:"border-violet-200/70 dark:border-violet-500/20",wash:"from-violet-500/10 via-violet-500/0 to-transparent dark:from-violet-400/10 dark:via-violet-400/0",glowA:"bg-violet-400/16 dark:bg-violet-500/12",glowB:"bg-fuchsia-400/10 dark:bg-fuchsia-500/10",top:"from-violet-400/55 via-violet-300/20 to-transparent dark:from-violet-300/35 dark:via-violet-300/15"},teal:{border:"border-emerald-200/70 dark:border-emerald-500/20",wash:"from-emerald-500/10 via-emerald-500/0 to-transparent dark:from-emerald-400/10 dark:via-emerald-400/0",glowA:"bg-emerald-400/14 dark:bg-emerald-500/12",glowB:"bg-cyan-400/10 dark:bg-cyan-500/10",top:"from-emerald-400/55 via-emerald-300/20 to-transparent dark:from-emerald-300/35 dark:via-emerald-300/15"},amber:{border:"border-amber-200/70 dark:border-amber-500/20",wash:"from-amber-500/12 via-amber-500/0 to-transparent dark:from-amber-400/10 dark:via-amber-400/0",glowA:"bg-amber-400/16 dark:bg-amber-500/12",glowB:"bg-orange-400/10 dark:bg-orange-500/10",top:"from-amber-400/60 via-amber-300/20 to-transparent dark:from-amber-300/35 dark:via-amber-300/15"}}[r];return(0,t.jsxs)("div",{className:u("group relative overflow-hidden rounded-2xl border bg-white/88 p-4","shadow-[0_10px_30px_-20px_rgba(2,6,23,0.35)] backdrop-blur-xl","dark:bg-slate-950/45",l.border),children:[(0,t.jsx)("div",{className:u("pointer-events-none absolute inset-x-0 top-0 h-px bg-gradient-to-r",l.top)}),(0,t.jsx)("div",{className:u("pointer-events-none absolute inset-0 bg-gradient-to-br",l.wash)}),(0,t.jsx)("div",{className:u("pointer-events-none absolute -right-10 -top-12 h-28 w-28 rounded-full blur-2xl",l.glowA)}),(0,t.jsx)("div",{className:u("pointer-events-none absolute -left-10 -bottom-12 h-28 w-28 rounded-full blur-2xl",l.glowB)}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold leading-none text-slate-900 dark:text-slate-50",children:(0,t.jsx)("span",{className:"block truncate whitespace-nowrap",children:e})}),(0,t.jsx)("div",{className:"mt-3 flex items-end justify-between gap-3",children:(0,t.jsx)("div",{className:"text-[28px] font-semibold leading-none tracking-tight text-slate-900 dark:text-slate-50",children:a})}),s?(0,t.jsx)("div",{className:"mt-2 text-[11px] leading-none text-slate-500 dark:text-slate-400",children:(0,t.jsx)("span",{className:"block truncate whitespace-nowrap",children:s})}):null]})]})}function g({href:e,children:a,variant:s="secondary",className:r}){let l="inline-flex items-center justify-center gap-2 rounded-full px-4 py-2 text-sm font-semibold transition active:translate-y-[0.5px] focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-50 dark:focus-visible:ring-offset-slate-950";return"primary"===s?(0,t.jsx)("a",{href:e,className:u(l,"text-slate-950 shadow-[0_16px_34px_-22px_rgba(2,6,23,0.55)]","bg-gradient-to-r from-amber-400 via-amber-500 to-orange-500","hover:from-amber-300 hover:via-amber-500 hover:to-orange-400","focus-visible:ring-amber-400/70",r),children:a}):(0,t.jsx)("a",{href:e,className:u(l,"border border-slate-200/80 bg-white/70 text-slate-700 shadow-sm","hover:bg-white hover:text-slate-900","dark:border-slate-800/70 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:bg-slate-950/65 dark:hover:text-slate-50","focus-visible:ring-slate-300/70 dark:focus-visible:ring-slate-700/70",r),children:a})}function p({children:e,tone:a="neutral"}){return(0,t.jsx)("span",{className:u("inline-flex items-center gap-2 rounded-full border px-2.5 py-1 text-[11px] shadow-sm backdrop-blur","signal"===a?"border-amber-200/60 bg-amber-50 text-amber-700 dark:border-amber-400/30 dark:bg-amber-500/10 dark:text-amber-100":"success"===a?"border-emerald-200/60 bg-emerald-50 text-emerald-700 dark:border-emerald-400/30 dark:bg-emerald-500/10 dark:text-emerald-100":"border-slate-200/70 bg-white/75 text-slate-600 dark:border-slate-700/70 dark:bg-slate-950/45 dark:text-slate-300"),children:e})}function f(){let[e,s]=(0,a.useState)(null),[r,l]=(0,a.useState)(null),[n,d]=(0,a.useState)(null),[i,o]=(0,a.useState)(null),[c,x]=(0,a.useState)(!1),[m,f]=(0,a.useState)(null);async function v(){x(!0);try{let[e,t,a,r]=await Promise.all([fetch("/api/monitor/watches"),fetch("/api/monitor/events"),fetch("/api/monitor/rules"),fetch("/api/monitor/notifications")]),n=await e.json().catch(()=>null),i=await t.json().catch(()=>null),c=await a.json().catch(()=>null),x=await r.json().catch(()=>null),m=e.ok&&n?.ok?n.watches??[]:[],h=t.ok&&i?.ok?i.events??[]:[],u=a.ok&&c?.ok?c.rules??[]:[],b=r.ok&&x?.ok?x.notifications??[]:[];s(m),l(h),d(u),o(b),f(h?.[0]??null)}catch(e){s([]),l([]),d([]),o([]),f(null)}finally{x(!1)}}(0,a.useEffect)(()=>{v();let e=setInterval(()=>v(),3e4);return()=>clearInterval(e)},[]);let k=e?.length??"—",j=r?r.filter(e=>{let t=new Date(e.created_at).getTime();return Date.now()-t<864e5}).length:"—",w=(0,a.useMemo)(()=>e&&0!==e.length?Math.round(e.reduce((e,t)=>e+Number(t.frequency_seconds??86400)/86400,0)/e.length*10)/10:"—",[e]),N=(0,a.useMemo)(()=>e?e.filter(e=>e.last_status&&"ok"!==String(e.last_status)||Number(e.retry_count??0)>0).length:"—",[e]),y=(0,a.useMemo)(()=>r?Math.round(r.filter(e=>{let t=new Date(e.created_at).getTime();return Date.now()-t<6048e5}).length/7*10)/10:"—",[r]),_=(0,a.useMemo)(()=>i?i.filter(e=>{let t=new Date(e.created_at).getTime();return Date.now()-t<6048e5}).length:"—",[i]),S=(0,a.useMemo)(()=>r&&0!==r.length?Math.round(r.filter(e=>!0===e.processed).length/r.length*100):"—",[r]),C=(0,a.useMemo)(()=>e&&0!==e.length?Math.round(e.filter(e=>!!e.auto_watch).length/e.length*100):"—",[e]),M=(0,a.useMemo)(()=>e&&0!==e.length?Math.round(e.filter(e=>!!e.product_id).length/e.length*100):"—",[e]),A=(0,a.useMemo)(()=>e&&0!==e.length?Math.round(e.reduce((e,t)=>e+Number(t.retry_count??0),0)/e.length*10)/10:"—",[e]),T=i?i.filter(e=>!e.read).length:"—",q=n?.length??"—";return(0,t.jsxs)("main",{className:"relative min-h-screen overflow-hidden bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-50",children:[(0,t.jsxs)("div",{className:"pointer-events-none absolute inset-0",children:[(0,t.jsx)("div",{className:"absolute -top-44 -left-36 h-96 w-96 rounded-full bg-sky-300/20 blur-3xl dark:bg-sky-500/15"}),(0,t.jsx)("div",{className:"absolute -bottom-44 right-[-12rem] h-[28rem] w-[28rem] rounded-full bg-amber-300/20 blur-3xl dark:bg-amber-500/14"}),(0,t.jsx)("div",{className:"absolute top-24 right-12 h-56 w-56 rounded-full bg-emerald-300/12 blur-3xl dark:bg-emerald-500/10"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(248,250,252,0)_0,_rgba(248,250,252,0.92)_58%,_rgba(248,250,252,1)_100%)] dark:bg-[radial-gradient(circle_at_top,_rgba(15,23,42,0)_0,_rgba(15,23,42,0.92)_58%,_rgba(15,23,42,1)_100%)]"}),(0,t.jsx)("div",{className:"absolute inset-0 opacity-[0.045] dark:opacity-[0.065]",children:(0,t.jsx)("div",{className:"h-full w-full bg-[linear-gradient(to_right,#e5e7eb_1px,transparent_1px),linear-gradient(to_bottom,#e5e7eb_1px,transparent_1px)] bg-[size:46px_46px] dark:bg-[linear-gradient(to_right,#1e293b_1px,transparent_1px),linear-gradient(to_bottom,#1e293b_1px,transparent_1px)]"})})]}),(0,t.jsxs)("div",{className:"relative mx-auto max-w-7xl space-y-6 px-4 pt-4 pb-8 sm:px-6 lg:px-8 lg:pt-6 lg:pb-10",children:[(0,t.jsxs)("header",{className:"flex flex-col gap-5 lg:flex-row lg:items-start lg:justify-between",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full border border-amber-300/60 bg-white/80 px-3 py-1.5 text-[11px] font-medium uppercase tracking-[0.18em] text-amber-700 shadow-sm backdrop-blur dark:border-amber-400/35 dark:bg-slate-950/55 dark:text-amber-100",children:[(0,t.jsx)("span",{className:"inline-flex h-4 w-4 items-center justify-center rounded-full border border-amber-400/60 bg-slate-100 dark:border-amber-400/35 dark:bg-slate-900",children:(0,t.jsx)("span",{className:"h-2 w-2 animate-pulse rounded-full bg-amber-500 dark:bg-amber-300"})}),"Commerce • AvidiaMonitor"]}),(0,t.jsxs)(p,{tone:"success",children:[(0,t.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400"}),"Workers • Rules • Notifier"]}),(0,t.jsx)(p,{tone:"signal",children:"✨ Change detection → alerts → automation"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h1",{className:"text-2xl font-semibold leading-tight text-slate-900 lg:text-3xl dark:text-slate-50",children:["Monitor"," ",(0,t.jsx)("span",{className:"bg-gradient-to-r from-amber-500 via-orange-500 to-sky-500 bg-clip-text text-transparent dark:from-amber-300 dark:via-orange-300 dark:to-sky-300",children:"changes, notifications & automation"})]}),(0,t.jsx)("p",{className:"max-w-2xl text-sm text-slate-600 dark:text-slate-300",children:"Watch product sources, detect deltas, and trigger pipelines or alerts. Manage watches, rules, and notifications here."})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 lg:justify-end",children:[(0,t.jsx)(g,{href:"#add-watch",variant:"primary",children:"Add watch"}),(0,t.jsxs)(g,{href:"/dashboard/monitor/rules",variant:"secondary",children:["Rules (",q,")"]}),(0,t.jsxs)(g,{href:"/dashboard/monitor/notifications",variant:"secondary",children:["Notifications (",T,")"]})]})]}),(0,t.jsxs)("section",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12 lg:gap-8",children:[(0,t.jsxs)("div",{className:"space-y-4 lg:col-span-8",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(b,{title:"Watches",tone:"blue",value:c?"…":k,caption:"Configured watches"}),(0,t.jsx)(b,{title:"Events (24h)",tone:"purple",value:c?"…":j,caption:"Events in last 24 hours"}),(0,t.jsx)(b,{title:"Avg frequency (days)",tone:"teal",value:c?"…":w,caption:"Average check frequency"}),(0,t.jsx)(b,{title:"Failing watches",tone:"amber",value:c?"…":N,caption:"Watches with errors/retries"})]}),(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-4 shadow-[0_14px_40px_-28px_rgba(2,6,23,0.55)] backdrop-blur dark:border-slate-800/60 dark:bg-slate-950/45",children:(0,t.jsx)(h,{})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-4 shadow-[0_14px_40px_-28px_rgba(2,6,23,0.55)] backdrop-blur dark:border-slate-800/60 dark:bg-slate-950/45",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-slate-900 dark:text-slate-50",children:"Recent monitor events"}),(0,t.jsx)("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Quick view of recent events. Use Rules to automate alerts and Notifier to deliver webhooks / emails."})]}),(0,t.jsx)("div",{className:"shrink-0 text-xs text-slate-500 dark:text-slate-400",children:"Most recent"})]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"space-y-2 pr-2",style:{maxHeight:"36vh",overflowY:"auto"},children:null===r?(0,t.jsx)("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Loading…"}):0===r.length?(0,t.jsx)("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No events yet — add a watch or upload/import a product to get started."}):r.slice(0,50).map(e=>(0,t.jsxs)("div",{className:u("rounded-xl border border-slate-200/70 bg-slate-50/70 p-3","shadow-sm","flex items-start justify-between gap-3","dark:border-slate-800/60 dark:bg-slate-900/30"),children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[e.event_type," · ",e.severity]}),(0,t.jsx)("div",{className:"mt-0.5 truncate font-medium text-slate-900 dark:text-slate-50",children:e.payload?.snapshot?.title??e.payload?.snapshot?.url??"Event"}),(0,t.jsx)("div",{className:"mt-1 truncate text-xs text-slate-400 dark:text-slate-500",children:e.payload?.snapshot?.url})]}),(0,t.jsxs)("div",{className:"shrink-0 text-right",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:new Date(e.created_at).toLocaleString()}),(0,t.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{navigator.clipboard?.writeText(JSON.stringify(e.payload??e,null,2)),alert("Event payload copied")},className:u("rounded-full px-3 py-1 text-xs font-medium","border border-slate-200/80 bg-white/70 text-slate-700 shadow-sm","hover:bg-white hover:text-slate-900","dark:border-slate-800/70 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:bg-slate-950/65 dark:hover:text-slate-50"),children:"Copy"}),(0,t.jsx)("a",{href:"/dashboard/monitor/notifications",className:u("rounded-full px-3 py-1 text-xs font-medium","border border-slate-200/80 bg-white/70 text-slate-700 shadow-sm","hover:bg-white hover:text-slate-900","dark:border-slate-800/70 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:bg-slate-950/65 dark:hover:text-slate-50"),children:"Notifications"})]})]})]},e.id))}),r&&r.length>50?(0,t.jsxs)("div",{className:"mt-3 text-xs text-slate-500 dark:text-slate-400",children:["Showing latest 50 events."," ",(0,t.jsx)("a",{className:"underline underline-offset-2",href:"/dashboard/monitor/events",children:"View all events"})]}):null]})]})]}),(0,t.jsxs)("aside",{className:"space-y-4 lg:col-span-4",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-4 shadow-[0_14px_40px_-28px_rgba(2,6,23,0.55)] backdrop-blur dark:border-slate-800/60 dark:bg-slate-950/45",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-slate-900 dark:text-slate-50",children:"Quick actions"}),(0,t.jsx)("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Admin utilities for Monitor"})]}),(0,t.jsxs)(p,{children:[(0,t.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-sky-400"}),"Ops"]})]}),(0,t.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-xl border border-slate-200/70 bg-slate-50/70 p-3 dark:border-slate-800/60 dark:bg-slate-900/30",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Run all due checks"}),(0,t.jsx)("div",{className:"truncate text-sm font-medium text-slate-900 dark:text-slate-50",children:"Worker (manual)"})]}),(0,t.jsx)("button",{onClick:()=>{v(),alert("Summary refreshed. To run checks start the worker process.")},className:u("shrink-0 rounded-full px-3 py-1 text-xs font-medium","border border-slate-200/80 bg-white/70 text-slate-700 shadow-sm","hover:bg-white hover:text-slate-900","dark:border-slate-800/70 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:bg-slate-950/65 dark:hover:text-slate-50"),children:"Refresh"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-xl border border-slate-200/70 bg-slate-50/70 p-3 dark:border-slate-800/60 dark:bg-slate-900/30",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Notifier worker"}),(0,t.jsx)("div",{className:"truncate text-sm font-medium text-slate-900 dark:text-slate-50",children:"Deliver webhooks & emails"})]}),(0,t.jsx)("button",{onClick:()=>alert("Dev command:\n\nNODE_ENV=production node -r dotenv/config ./dist/lib/monitor/notifierWorker.js"),className:u("shrink-0 rounded-full px-3 py-1 text-xs font-medium","border border-slate-200/80 bg-white/70 text-slate-700 shadow-sm","hover:bg-white hover:text-slate-900","dark:border-slate-800/70 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:bg-slate-950/65 dark:hover:text-slate-50"),children:"Show command"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-xl border border-slate-200/70 bg-slate-50/70 p-3 dark:border-slate-800/60 dark:bg-slate-900/30",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Manage rules"}),(0,t.jsx)("div",{className:"truncate text-sm font-medium text-slate-900 dark:text-slate-50",children:"Create automation for events"})]}),(0,t.jsx)("a",{href:"/dashboard/monitor/rules",className:u("shrink-0 rounded-full px-3 py-1 text-xs font-medium","border border-slate-200/80 bg-white/70 text-slate-700 shadow-sm","hover:bg-white hover:text-slate-900","dark:border-slate-800/70 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:bg-slate-950/65 dark:hover:text-slate-50"),children:"Open"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-xl border border-slate-200/70 bg-slate-50/70 p-3 dark:border-slate-800/60 dark:bg-slate-900/30",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"View notifications"}),(0,t.jsx)("div",{className:"truncate text-sm font-medium text-slate-900 dark:text-slate-50",children:"App notifications & history"})]}),(0,t.jsx)("a",{href:"/dashboard/monitor/notifications",className:u("shrink-0 rounded-full px-3 py-1 text-xs font-medium","border border-slate-200/80 bg-white/70 text-slate-700 shadow-sm","hover:bg-white hover:text-slate-900","dark:border-slate-800/70 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:bg-slate-950/65 dark:hover:text-slate-50"),children:"Open"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200/70 bg-white/70 p-4 text-xs shadow-[0_14px_40px_-28px_rgba(2,6,23,0.55)] backdrop-blur dark:border-slate-800/60 dark:bg-slate-950/35",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900 dark:text-slate-50",children:"Monitor Metrics"}),(0,t.jsxs)(p,{children:[(0,t.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400"}),"Summary"]})]}),(0,t.jsx)("div",{className:"mt-2 text-xs text-slate-600 dark:text-slate-400",children:"Operational metrics and high-level signals — no repository paths or environment values are shown here."}),(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3 text-xs",children:[[{v:k,l:"Watches"},{v:w,l:"Avg frequency (days)"},{v:N,l:"Failing watches"},{v:y,l:"Events/day (est.)"},{v:_,l:"Notifications (7d)"},{v:"—"===S?"—":`${S}%`,l:"Processed rate"},{v:"—"===C?"—":`${C}%`,l:"Auto watches"},{v:"—"===M?"—":`${M}%`,l:"Linked to product"}].map(e=>(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200/70 bg-white/75 p-3 text-center shadow-sm dark:border-slate-800/60 dark:bg-slate-950/35",children:[(0,t.jsx)("div",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-50",children:e.v}),(0,t.jsx)("div",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:e.l})]},e.l)),(0,t.jsxs)("div",{className:"col-span-2 rounded-xl border border-slate-200/70 bg-white/75 p-3 text-center shadow-sm dark:border-slate-800/60 dark:bg-slate-950/35",children:[(0,t.jsx)("div",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-50",children:A}),(0,t.jsx)("div",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:"Avg retry count"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-4 text-xs shadow-[0_14px_40px_-28px_rgba(2,6,23,0.55)] backdrop-blur dark:border-slate-800/60 dark:bg-slate-950/45",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900 dark:text-slate-50",children:"Operational tips"}),(0,t.jsxs)("ul",{className:"mt-3 space-y-2 text-slate-600 dark:text-slate-300",children:[(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"mt-[6px] h-1.5 w-1.5 shrink-0 rounded-full bg-amber-400"}),(0,t.jsx)("span",{children:"Start small: monitor a seed of important SKUs first."})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"mt-[6px] h-1.5 w-1.5 shrink-0 rounded-full bg-sky-400"}),(0,t.jsx)("span",{children:"Set frequency per vendor to avoid rate-limits and CAPTCHAs."})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"mt-[6px] h-1.5 w-1.5 shrink-0 rounded-full bg-emerald-400"}),(0,t.jsx)("span",{children:"Use rules to limit noise — e.g., alert only on price changes > X%."})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"mt-[6px] h-1.5 w-1.5 shrink-0 rounded-full bg-violet-400"}),(0,t.jsx)("span",{children:"Use a headless-renderer fallback for JS-heavy pages (separate Playwright worker)."})]})]}),m?(0,t.jsxs)("div",{className:"mt-4 rounded-xl border border-slate-200/70 bg-slate-50/70 p-3 text-[11px] text-slate-600 dark:border-slate-800/60 dark:bg-slate-900/30 dark:text-slate-300",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"Latest signal (sample)"}),(0,t.jsx)("div",{className:"mt-1 truncate",children:m?.payload?.snapshot?.url??m?.payload?.snapshot?.title??"—"})]}):null]})]})]})]})]})}e.s(["default",()=>f],91937)}]);