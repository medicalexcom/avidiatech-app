(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32833,e=>{"use strict";var t=e.i(43476),s=e.i(71645);function a(){let[e,a]=(0,s.useState)(null),[n,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(""),[i,r]=(0,s.useState)("any"),[o,x]=(0,s.useState)("any"),[u,h]=(0,s.useState)("any"),[m,p]=(0,s.useState)("last_check_at"),[j,y]=(0,s.useState)("desc"),[g,v]=(0,s.useState)(1);async function f(){l(!0);try{let e=await fetch("/api/monitor/watches"),t=await e.json().catch(()=>null);e.ok&&t?.ok?a(t.watches??[]):a([])}finally{l(!1)}}(0,s.useEffect)(()=>{f()},[]);let N=(0,s.useMemo)(()=>{let t=e??[],s=String(c||"").trim().toLowerCase(),a=t.filter(e=>("any"===i||(e.last_status??"unknown")===i)&&("any"===o||("yes"!==o||!!e.auto_watch)&&("no"!==o||!e.auto_watch))&&("any"===u||("yes"!==u||!!e.product_id)&&("no"!==u||!e.product_id))&&(!s||!!String(e.source_url??"").toLowerCase().includes(s)));return a.sort((e,t)=>{let s=e[m],a=t[m];return("last_check_at"===m||"created_at"===m?(s=e[m]?new Date(e[m]).getTime():0,a=t[m]?new Date(t[m]).getTime():0):(s=Number(s??0),a=Number(a??0)),s===a)?0:"asc"===j?s<a?-1:1:s>a?-1:1}),a},[e,c,i,o,u,m,j]),b=N.length,w=Math.max(1,Math.ceil(b/50)),_=N.slice((g-1)*50,50*g),k=(0,s.useMemo)(()=>{let t=e??[],s=t.length;if(0===s)return{total:0,failing:0,avgFrequencyDays:"—",productLinkedPct:"—",autoWatchPct:"—"};let a=t.filter(e=>e.last_status&&"ok"!==String(e.last_status)||Number(e.retry_count??0)>0).length,n=Math.round(t.reduce((e,t)=>e+Number(t.frequency_seconds??86400),0)/s/86400*10)/10,l=Math.round(t.filter(e=>!!e.product_id).length/s*100),c=Math.round(t.filter(e=>!!e.auto_watch).length/s*100);return{total:s,failing:a,avgFrequencyDays:n,productLinkedPct:l,autoWatchPct:c}},[e]);async function C(e){try{let t=await fetch("/api/monitor/check",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({watchId:e})});await t.json().catch(()=>null),f()}catch(e){console.warn(e)}}async function S(e,t){await fetch(`/api/monitor/watches/${encodeURIComponent(e)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({frequency_seconds:Math.max(1,Math.round(24*t*3600))})}),f()}async function M(e,t){let s={muted_until:t?null:new Date(Date.now()+864e5).toISOString()};await fetch(`/api/monitor/watches/${encodeURIComponent(e)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(s)}),f()}async function L(e){confirm("Delete this watch? This cannot be undone.")&&(await fetch(`/api/monitor/watches/${encodeURIComponent(e)}`,{method:"DELETE"}),f())}return(0,t.jsx)("main",{className:"p-6",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"All Watches"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Full list of watches with sorting, filtering, and bulk-friendly controls."})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("a",{href:"/dashboard",className:"px-3 py-2 rounded border",children:"Back"}),(0,t.jsx)("a",{href:"#top",className:"px-3 py-2 rounded bg-amber-500 text-white",children:"Open Monitor"})]})]}),(0,t.jsxs)("section",{className:"grid grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Total watches"}),(0,t.jsx)("div",{className:"mt-2 text-2xl font-semibold",children:k.total})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Failing watches"}),(0,t.jsx)("div",{className:"mt-2 text-2xl font-semibold",children:k.failing})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Avg frequency (days)"}),(0,t.jsx)("div",{className:"mt-2 text-2xl font-semibold",children:k.avgFrequencyDays})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Linked to product / Auto-watch"}),(0,t.jsxs)("div",{className:"mt-2 text-lg font-semibold",children:[k.productLinkedPct,"% · ",k.autoWatchPct,"%"]})]})]}),(0,t.jsx)("section",{className:"rounded-lg border bg-white p-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{value:c,onChange:e=>d(e.target.value),placeholder:"Search URL...",className:"border rounded px-3 py-2 w-80"}),(0,t.jsxs)("select",{value:i,onChange:e=>r(e.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,t.jsx)("option",{value:"any",children:"All statuses"}),(0,t.jsx)("option",{value:"ok",children:"ok"}),(0,t.jsx)("option",{value:"changed",children:"changed"}),(0,t.jsx)("option",{value:"scrape_failed",children:"scrape_failed"}),(0,t.jsx)("option",{value:"error",children:"error"})]}),(0,t.jsxs)("select",{value:o,onChange:e=>x(e.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,t.jsx)("option",{value:"any",children:"Auto watch (any)"}),(0,t.jsx)("option",{value:"yes",children:"Auto only"}),(0,t.jsx)("option",{value:"no",children:"Manual only"})]}),(0,t.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,t.jsx)("option",{value:"any",children:"Product link (any)"}),(0,t.jsx)("option",{value:"yes",children:"Linked"}),(0,t.jsx)("option",{value:"no",children:"Unlinked"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-slate-500",children:"Sort"}),(0,t.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,t.jsx)("option",{value:"last_check_at",children:"Last check"}),(0,t.jsx)("option",{value:"frequency_seconds",children:"Frequency (sec)"}),(0,t.jsx)("option",{value:"retry_count",children:"Retry count"}),(0,t.jsx)("option",{value:"created_at",children:"Created"})]}),(0,t.jsxs)("select",{value:j,onChange:e=>y(e.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,t.jsx)("option",{value:"desc",children:"desc"}),(0,t.jsx)("option",{value:"asc",children:"asc"})]}),(0,t.jsx)("button",{onClick:()=>{v(1),f()},className:"px-3 py-1 rounded border text-sm",children:"Reload"})]})]})}),(0,t.jsxs)("section",{className:"rounded-lg border bg-white p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:"Watches"}),(0,t.jsxs)("div",{className:"text-xs text-slate-500",children:["Showing ",Math.min(50,b)," of ",b," (page ",g,"/",w,")"]})]}),(0,t.jsx)("div",{className:"space-y-3",children:n&&!e?(0,t.jsx)("div",{children:"Loading…"}):0===_.length?(0,t.jsx)("div",{className:"text-sm text-slate-500",children:"No watches"}):_.map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-lg flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"font-medium truncate",children:e.source_url}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:e.product_id?"linked":"unlinked"})]}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["Last: ",e.last_check_at?new Date(e.last_check_at).toLocaleString():"never"," · Status: ",(0,t.jsx)("span",{className:"font-medium",children:e.last_status??"unknown"})," · Retries: ",e.retry_count??0]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>C(e.id),className:"px-2 py-1 text-xs border rounded",children:"Check"}),(0,t.jsx)("button",{onClick:()=>M(e.id,e.muted_until),className:"px-2 py-1 text-xs border rounded",children:e.muted_until?"Unmute":"Mute"}),(0,t.jsx)("button",{onClick:()=>L(e.id),className:"px-2 py-1 text-xs border rounded text-red-600",children:"Delete"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-slate-500",children:"Freq days"}),(0,t.jsx)("input",{type:"number",defaultValue:Math.max(1,Math.round((e.frequency_seconds??86400)/86400)),onBlur:t=>S(e.id,Number(t.currentTarget.value)),className:"w-20 rounded border px-2 py-1 text-sm"})]})]})})]},e.id))}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-xs text-slate-500",children:["Page ",g," of ",w]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>v(1),disabled:1===g,className:"px-3 py-1 border rounded text-sm",children:"First"}),(0,t.jsx)("button",{onClick:()=>v(e=>Math.max(1,e-1)),disabled:1===g,className:"px-3 py-1 border rounded text-sm",children:"Prev"}),(0,t.jsx)("button",{onClick:()=>v(e=>Math.min(w,e+1)),disabled:g===w,className:"px-3 py-1 border rounded text-sm",children:"Next"}),(0,t.jsx)("button",{onClick:()=>v(w),disabled:g===w,className:"px-3 py-1 border rounded text-sm",children:"Last"})]})]})]})]})})}e.s(["default",()=>a])}]);