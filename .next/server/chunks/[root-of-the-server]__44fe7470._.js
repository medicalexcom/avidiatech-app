module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},44070,e=>{"use strict";var t=e.i(24389);let r=process.env.NEXT_PUBLIC_SUPABASE_URL||process.env.SUPABASE_URL,i=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_ANON_KEY,n=null;r&&i?n=(0,t.createClient)(r,i):console.warn("Supabase client not configured (missing SUPABASE_URL or KEY). Some server operations will fail until configured.");let s=n,o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY??process.env.SUPABASE_ANON_KEY,a=process.env.SUPABASE_SERVICE_ROLE_KEY,l=null;function c(){let e=r&&a?(l||(l=(0,t.createClient)(r,a,{})),l):null;if(!e)throw Error("Server Supabase client is not configured. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in the environment.");return e}r&&a&&(0,t.createClient)(r,a),r&&o&&(0,t.createClient)(r,o),e.s(["getServerSupabase",()=>c,"getServiceSupabaseClient",0,c,"supabase",0,s])},24868,(e,t,r)=>{t.exports=e.x("fs/promises",()=>require("fs/promises"))},13108,e=>{"use strict";var t=e.i(14747),r=e.i(24868);let i=null,n=parseInt(process.env.RENDER_PROMPTS_TTL_SECONDS||"600",10),s=t.default.join(process.cwd(),"tools","render-engine","prompts","custom_gpt_instructions.md");async function o(){let e=await r.default.stat(s).catch(()=>null);if(!e||!e.isFile())throw Error(`custom_gpt_instructions_missing_or_empty: missing ${s}`);let t=await r.default.readFile(s,{encoding:"utf8"});if(!t||0===t.trim().length)throw Error(`custom_gpt_instructions_missing_or_empty: empty ${s}`);return console.info("loadInstructions: loaded local prompt from",s),t}async function a(e){let t=Date.now();if(i&&(t-i.fetchedAt)/1e3<n)return{text:i.value,source:"local"};let r=await o();return i={value:r,fetchedAt:Date.now(),source:"local"},{text:r,source:"local"}}e.s(["loadCustomGptInstructionsWithInfo",()=>a])},6167,e=>{"use strict";var t=e.i(44070);e.i(89228);var r=e.i(91601),i=e.i(13108);let n=process.env.OPENAI_API_KEY||"",s=process.env.OPENAI_SEO_MODEL||process.env.OPENAI_DESCRIBE_MODEL||process.env.OPENAI_MODEL||"gpt-4.1",o=new r.default({apiKey:n}),a=["not specified","not provided","not available","information not available","information not disclosed","warranty information not available","info not available","unknown","n/a","tbd","to be determined","unspecified"];function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c(e){return"string"==typeof e&&e.trim().length>0}function p(e){let t=e.toLowerCase();return t.includes("http://")||t.includes("https://")||t.includes("www.")||t.includes("product for ")}function d(e,t){if(!e){let e=Error(t);throw e.code="seo_invalid_model_output",e}}function u(e){if(!e)return"";let t=e;for(let[e,r]of Object.entries({"&nbsp;":" ","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&apos;":"'"}))t=t.replace(RegExp(e,"gi"),r);return t.replace(/&#(\d+);/g,(e,t)=>{try{return String.fromCharCode(Number(t))}catch{return""}})}function _(e){if(null==e)return"";let t=String(e);return(t=u(t=(t=t.replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g," ")).replace(/<[^>]+>/g," "))).replace(/[\r\n]+/g," ").replace(/\s+/g," ").trim()}function g(e,t){if(!e||!t)return 0;let r=e=>e.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).map(e=>e.trim()).filter(e=>e.length>1),i=new Set(r(e)),n=new Set(r(t));if(0===i.size||0===n.size)return 0;let s=0;for(let e of i)n.has(e)&&s++;let o=new Set([...i,...n]).size;return 0===o?0:s/o}function f(e,t,r=20){if("string"!=typeof e||t<=0)return"";let i=e.trim();if(i.length<=t)return i;for(let e=Math.min(i.length-1,t);e>=0;e--){let t=i[e];if("."===t||"!"===t||"?"===t){let t=i.slice(0,e+1).trim();if(t.length)return t;break}}if(r>0){let e=Math.min(i.length-1,t+r);for(let r=t+1;r<=e;r++){let e=i[r];if("."===e||"!"===e||"?"===e){let e=i.slice(0,r+1).trim();if(e.length)return e}}}let n=Math.max(i.lastIndexOf(",",t),i.lastIndexOf(";",t));if(n>-1&&n>=Math.floor(.25*t)){let e=i.slice(0,n).trim();if(e.length)return e}let s=i.slice(0,t),o=Math.max(s.lastIndexOf(" "),s.lastIndexOf("\n"),s.lastIndexOf("	"));if(o>-1&&o>=Math.floor(.2*t)){let e=i.slice(0,o).trim();if(e.length)return e}let a=s.lastIndexOf("&");if(a>0){let e=i.slice(0,a).trim();if(e.length)return e}return i.slice(0,Math.max(1,t))}async function m(e,t,r,m){if(!n)throw Error("OPENAI_API_KEY not configured");let{text:h,source:y}=await (0,i.loadCustomGptInstructionsWithInfo)(m??null);d(c(h),"seo_missing_custom_instructions: custom_gpt_instructions are required");let v={dom:{name_raw:e.name_raw||e.name,name:e.name,brand:e.brand??null,sku:e.sku??null,specs:e.specs??{},features_raw:e.features_raw??[],images:e.images??[],pdf_manual_urls:e.pdf_manual_urls??[],source_url:r??null},pdf_text:e.pdf_text??"",pdf_docs:[],browsed_text:e.description_raw??"",correlation_id:t??null,tenant_id:m??null},S={type:"object",additionalProperties:!1,required:["seo","descriptionHtml","sections","features","data_gaps","desc_audit"],properties:{seo:{type:"object",additionalProperties:!1,required:["h1","title","metaDescription","shortDescription","url"],properties:{h1:{type:"string"},title:{type:"string"},metaDescription:{type:"string"},shortDescription:{type:"string"},url:{type:"string"}}},descriptionHtml:{type:"string"},sections:{type:"object",additionalProperties:!1,required:["overview","hook","mainDescription","featuresBenefits","specifications","internalLinks","whyChoose","manuals","faqs"],properties:{overview:{type:"string"},hook:{type:"string"},mainDescription:{type:"string"},featuresBenefits:{type:"string"},specifications:{type:"string"},internalLinks:{type:"string"},whyChoose:{type:"string"},manuals:{anyOf:[{type:"string"},{type:"null"}]},faqs:{type:"string"}}},features:{type:"array",items:{type:"string"}},data_gaps:{type:"array",items:{type:"string"}},desc_audit:{type:"object",additionalProperties:!1,required:["score","data_gaps","conflicts","iterations","notes"],properties:{score:{type:"number"},data_gaps:{type:"array",items:{type:"string"}},conflicts:{type:"array",items:{type:"string"}},iterations:{type:"number"},notes:{type:"array",items:{type:"string"}}}}}},w=["You are AvidiaSEO.\nABSOLUTE PRIORITY: Follow the CUSTOM GPT INSTRUCTIONS below exactly. They override all other guidance.\n\nHARD REQUIREMENTS:\n1) Output MUST be valid JSON matching the provided JSON schema (strict).\n2) Do NOT invent facts. Use ONLY the packet fields as grounding.\n3) Customer-facing copy MUST NOT contain placeholders. Omit missing lines instead; record gaps only in desc_audit.data_gaps.\n4) sections.overview MUST equal descriptionHtml exactly (content equality after normalization).\n5) Product Specifications section MUST include real bullet(s) derived from packet.dom.specs.\n\nCUSTOM GPT INSTRUCTIONS (AUTHORITATIVE):",h.trim()].join("\n"),E=["GROUND TRUTH PACKET (JSON):",JSON.stringify(v,null,2),"\nReturn the final SEO JSON now."].join("\n"),x=null,R=null,A="",O=!1;for(let e=1;e<=3;e++){let t,r=E+(1===e?"":`
REVISION MODE (MANDATORY):
- Keep name_best exactly the same as previously chosen: ${JSON.stringify(x)}
- Fix ONLY the violations listed below.
- Do not add any new facts/specs not present in packet.
Violations: ${JSON.stringify(R)}`),i=function(e){let t=e?.output?.at?.(0)??e?.output?.[0]??null;if(!t)return"";let r=t?.content;if("string"==typeof r)return r;if(Array.isArray(r)){let e="";for(let t of r)"string"==typeof t?e+=t:t?.text&&"string"==typeof t.text?e+=t.text:t?.content&&"string"==typeof t.content&&(e+=t.content);return e}if("string"==typeof t?.text)return t.text;try{return JSON.stringify(t)}catch{return""}}(await o.responses.create({model:s,input:[{role:"system",content:w},{role:"user",content:r}],text:{format:{type:"json_schema",name:"avidia_seo_schema",schema:S,strict:!0}}}));A=i;try{t=JSON.parse(function(e){let t=(e||"").trim(),r=t.match(/```(?:json)?\s*([\s\S]*?)\s*```/i);return r?r[1].trim():t}(i))}catch(t){if(R="central_gpt_invalid_json",3===e){let e=Error("central_gpt_invalid_json");throw e.raw=i,e}continue}try{let r=String(t?.seo?.h1??"").trim();if(d(c(r),"central_gpt_seo_error: missing seo.h1"),x?d(r===x,"central_gpt_seo_error: name_best_changed"):(d(!p(r),"central_gpt_seo_error: h1_contains_url_or_placeholder"),x=r),c(t?.seo?.url)){let e=String(t.seo.url).trim();t.seo.url=e.startsWith("/")?e.endsWith("/")?e:`${e}/`:`/${e}/`}else t.seo.url=`/${x.toLowerCase().replace(/&/g," and ").replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}/`;try{let e=String(t.seo.title||t.seo?.pageTitle||"").trim(),r=String(t.seo.metaDescription||t.seo?.meta_description||"").trim(),i=u(e),n=u(r);t.seo.title=f(i,70,12),t.seo.metaDescription=f(n,160,20)}catch(e){t.seo.title=String(t.seo.title||t.seo?.pageTitle||"").trim().slice(0,70),t.seo.metaDescription=String(t.seo.metaDescription||t.seo?.meta_description||"").trim().slice(0,160)}try{let e=t.sections?.overview??"",r=t.descriptionHtml??"",i=_(e),n=_(r);if(i.length>20&&n.startsWith(i))t.sections.overview=t.descriptionHtml,O=!0;else{let e=function(e){if(!e||"string"!=typeof e)return"";let t=e.match(/<p[^>]*>[\s\S]*?<\/p>/i);if(t)return t[0];let r=e.search(/<h2\b/i);if(r>=0)return e.slice(0,r);let i=e.split(/\n\s*\n/);return i.length?i[0]:e}(r),s=_(e),o=g(i,s),a=g(i,n);i&&s&&(i===s||o>=.75)?(t.sections.overview=t.descriptionHtml,O=!0):(i===n||a>=.75)&&(t.sections.overview=t.descriptionHtml,O=O||a>=.75)}}catch(e){console.warn("overview auto-fix logic failed:",e)}return!function(e,t=.75){let r;d(e&&"object"==typeof e,"central_gpt_invalid_json"),d(e.seo&&"object"==typeof e.seo,"central_gpt_seo_error: missing seo"),d(c(e.seo.h1),"central_gpt_seo_error: missing seo.h1"),d(c(e.seo.title),"central_gpt_seo_error: missing seo.title"),d(c(e.seo.metaDescription),"central_gpt_seo_error: missing seo.metaDescription"),d(c(e.descriptionHtml),"central_gpt_seo_error: missing descriptionHtml"),d(e.sections&&"object"==typeof e.sections,"central_gpt_seo_error: missing sections"),d(!p(String(e.seo.h1)),"central_gpt_seo_error: h1_contains_url_or_placeholder");let i=function(e){if(!e||"string"!=typeof e)return null;let t=e.toLowerCase();for(let e of a){let r=e.toLowerCase().trim();if(!r||r.length<=2&&!r.includes("/"))continue;if(/[^\w\s]/.test(r)){let i=l(r);if(RegExp(`(^|[^a-z0-9])${i}([^a-z0-9]|$)`,"i").test(t))return e;continue}let i=l(r);if(RegExp(`\\b${i}\\b`,"i").test(t))return e}return null}([String(e.seo?.h1??""),String(e.seo?.title??""),String(e.seo?.metaDescription??""),String(e.seo?.shortDescription??""),String(e.descriptionHtml??""),JSON.stringify(e.sections??{})].join("\n"));d(!i,`central_gpt_seo_error: banned_placeholder_token:${i}`),d("string"==typeof e.sections.overview&&e.sections.overview.trim().length>0,"central_gpt_seo_error: sections.overview_missing");let n=_(e.sections.overview),s=_(e.descriptionHtml),o=n===s,u=g(n,s);if(!(o||u>=t)){let e=Error("central_gpt_seo_error: sections.overview_must_equal_descriptionHtml");throw e.details={normalizedOverview:n,normalizedDescription:s,tokenSimilarity:u,similarityThreshold:t},e}d("string"==typeof e.sections.specifications&&e.sections.specifications.trim().length>0,"central_gpt_seo_error: sections.specifications_missing"),d(((r=(String(e.sections.specifications)||"").match(/<li\b/gi))?r.length:0)>=1,"central_gpt_seo_error: specifications_has_no_bullets"),d(e.desc_audit&&"object"==typeof e.desc_audit,"central_gpt_seo_error: desc_audit_missing"),d(Array.isArray(e.desc_audit.data_gaps),"central_gpt_seo_error: desc_audit.data_gaps_missing")}(t,.75),Array.isArray(t.data_gaps)||(t.data_gaps=[]),Array.isArray(t.desc_audit?.data_gaps)&&(t.data_gaps=t.desc_audit.data_gaps),{descriptionHtml:t.descriptionHtml,sections:t.sections,seo:t.seo,features:Array.isArray(t.features)?t.features:[],data_gaps:Array.isArray(t.data_gaps)?t.data_gaps:[],desc_audit:t.desc_audit,_meta:{model:s,instructionsSource:y,iterations:e,autoFixedOverview:O}}}catch(t){if(R=t?.message||String(t),3===e){let e=Error(R.startsWith("central_gpt_")?R:`central_gpt_seo_error: ${R}`);throw e.raw=t?.raw??A??null,t?.details&&(e.details=t.details),t?.stack&&(e.innerStack=t.stack),e}continue}}let b=Error("central_gpt_seo_error: exhausted_iterations");throw b.raw=A,b}async function h(e){var r;let i,n,s,o,a=(0,t.getServiceSupabaseClient)(),{data:l,error:c}=await a.from("product_ingestions").select("id, tenant_id, source_url, normalized_payload, correlation_id, diagnostics").eq("id",e).maybeSingle();if(c)throw Error(`ingestion_load_failed: ${c.message||String(c)}`);if(!l)throw Error("ingestion_not_found");let p=l.normalized_payload;if(!p)throw Error("missing_required_ingestion_payload");let d=p?.name;if(!("string"==typeof d&&d.trim().length>0)||(i=String(d).toLowerCase()).includes("http://")||i.includes("https://")||i.includes("www.")||i.includes("product for "))throw Error("ingestion_not_ready: normalized_payload.name is missing or url-derived (re-ingest with proper name extraction)");if(!((r=p?.specs)&&(Array.isArray(r)?r.length>0:"object"==typeof r&&Object.keys(r).length>0)))throw Error("ingestion_not_ready: normalized_payload.specs empty (re-ingest with includeSpecs=true)");let u=new Date().toISOString(),_=await m(p,l.correlation_id||null,l.source_url||null,l.tenant_id||null),g=new Date().toISOString(),f=l.diagnostics||{},h={...f,seo:{...f.seo||{},status:"completed",started_at:u,last_run_at:g,instruction_source:_?._meta?.instructionsSource??null,model:_?._meta?.model??null,iterations:_?._meta?.iterations??null,data_gaps:_.data_gaps??[],audit_score:"number"==typeof _?.desc_audit?.score?_.desc_audit.score:null,audit_conflicts:Array.isArray(_?.desc_audit?.conflicts)?_.desc_audit.conflicts:[]}},y=(n=_&&_.seo?_.seo:_??{},s=(...e)=>{for(let t of e)if(t){if("string"==typeof t){let e=t.split("."),r=_;for(let t of e){if(null==r){r=void 0;break}r=r[t]}if(void 0!==r)return r}else if(Array.isArray(t)){let e=_;for(let r of t){if(null==e){e=void 0;break}e=e[r]}if(void 0!==e)return e}}},!(o={..._,seo:n,_meta:_?._meta??null,h1:s("seo.h1","h1")??null,pageTitle:s("seo.pageTitle","seo.title","pageTitle","title")??null,title:s("seo.title","seo.pageTitle","title","pageTitle")??null,metaDescription:s("seo.metaDescription","seo.meta_description","metaDescription","meta_description")??null,meta_description:s("seo.meta_description","seo.metaDescription","meta_description","metaDescription")??null,shortDescription:s("seo.shortDescription","seo.seoShortDescription","shortDescription","seoShortDescription")??null,seoShortDescription:s("seo.seoShortDescription","seo.shortDescription","seoShortDescription","shortDescription")??null}).pageTitle&&o.title&&(o.pageTitle=o.title),!o.title&&o.pageTitle&&(o.title=o.pageTitle),!o.metaDescription&&o.meta_description&&(o.metaDescription=o.meta_description),!o.meta_description&&o.metaDescription&&(o.meta_description=o.metaDescription),o),{data:v,error:S}=await a.from("product_ingestions").update({seo_payload:y,description_html:_.descriptionHtml,features:_.features,seo_generated_at:g,diagnostics:h,updated_at:g}).eq("id",e).select("id, seo_payload, description_html, features").maybeSingle();if(S)throw Error(`seo_persist_failed: ${S.message||String(S)}`);let w=v?.seo_payload??y,E=v?.description_html??_.descriptionHtml,x=v?.features??_.features;return{ingestionId:e,descriptionHtml:E,sections:_.sections??null,seo:_.seo??null,features:x??[],data_gaps:_.data_gaps??[],desc_audit:_.desc_audit??null,_meta:_._meta??null,seo_payload:w,description_html:E}}e.s(["runSeoForIngestion",()=>h],6167)},54696,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),n=e.i(59756),s=e.i(61916),o=e.i(14444),a=e.i(37092),l=e.i(69741),c=e.i(16795),p=e.i(87718),d=e.i(95169),u=e.i(47587),_=e.i(66012),g=e.i(70101),f=e.i(26937),m=e.i(10372),h=e.i(93695);e.i(52474);var y=e.i(5232),v=e.i(89171),S=e.i(6167);async function w(e){let t=e.headers.get("x-pipeline-secret")||"",r=process.env.PIPELINE_INTERNAL_SECRET||"";if(!r||t!==r)return v.NextResponse.json({ok:!1,error:"unauthorized"},{status:401});let i=await e.json().catch(()=>({})),n=i?.ingestionId?.toString()||"";if(!n)return v.NextResponse.json({ok:!1,error:"missing_ingestionId"},{status:400});try{let e=await (0,S.runSeoForIngestion)(n);return v.NextResponse.json({ok:!0,ingestionId:e.ingestionId,seo:e.seo,descriptionHtml:e.descriptionHtml,sections:e.sections??null,features:e.features??[],data_gaps:e.data_gaps??[],_meta:e._meta??null,seo_payload:e.seo,description_html:e.descriptionHtml},{status:200})}catch(i){let e=i?.message||String(i),t=i?.raw??null,r=i?.details??null;if(i?.innerStack,console.error("[internal/seo] error for ingestion",n,{msg:e,raw:t,details:r,stack:null}),"ingestion_not_found"===e)return v.NextResponse.json({ok:!1,error:"ingestion_not_found",detail:e,raw:t,details:r},{status:404});if("ingestion_not_ready"===e||e.startsWith("ingestion_not_ready:"))return v.NextResponse.json({ok:!1,error:"ingestion_not_ready",detail:e,raw:t,details:r},{status:409});if(e.startsWith("ingestion_load_failed:"))return v.NextResponse.json({ok:!1,error:"ingestion_load_failed",detail:e,raw:t,details:r},{status:500});if("central_gpt_invalid_json"===e||e.startsWith("central_gpt_not_configured:")||e.startsWith("central_gpt_seo_error:"))return v.NextResponse.json({ok:!1,error:"seo_model_failed",detail:e,raw:t,details:r},{status:500});if(e.startsWith("seo_persist_failed:"))return v.NextResponse.json({ok:!1,error:"seo_persist_failed",detail:e,raw:t,details:r},{status:500});return v.NextResponse.json({ok:!1,error:"seo_internal_failed",detail:e,raw:t,details:r},{status:500})}}e.s(["POST",()=>w],61644);var E=e.i(61644);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/pipeline/internal/seo/route",pathname:"/api/v1/pipeline/internal/seo",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/pipeline/internal/seo/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:R,workUnitAsyncStorage:A,serverHooks:O}=x;function b(){return(0,i.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:A})}async function N(e,t,i){x.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/v1/pipeline/internal/seo/route";v=v.replace(/\/index$/,"")||"/";let S=await x.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!S)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:w,params:E,nextConfig:R,parsedUrl:A,isDraftMode:O,prerenderManifest:b,routerServerContext:N,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,resolvedPathname:D,clientReferenceManifest:I,serverActionsManifest:P}=S,k=(0,l.normalizeAppPath)(v),j=!!(b.dynamicRoutes[k]||b.routes[D]),U=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(j&&!O){let e=!!b.routes[D],t=b.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await U();throw new h.NoFallbackError}}let H=null;!j||x.isDev||O||(H="/index"===(H=D)?"/":H);let M=!0===x.isDev||!j,q=j&&!M;P&&I&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:I,serverActionsManifest:P,serverModuleMap:(0,a.createServerModuleMap)({serverActionsManifest:P})});let L=e.method||"GET",$=(0,s.getTracer)(),B=$.getActiveScopeSpan(),K={params:E,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>x.onRequestError(e,t,i,N)},sharedContext:{buildId:w}},z=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),Y=p.NextRequestAdapter.fromNodeNextRequest(z,(0,p.signalFromNodeResponse)(t));try{let o=async e=>x.handle(Y,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${L} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${v}`)}),a=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let c=async({previousCacheEntry:r})=>{try{if(!a&&T&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let c=K.renderOpts.collectedTags;if(!j)return await (0,_.sendResponse)(z,F,s,K.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,i=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:T})},N),t}},p=await x.handleResponse({req:e,nextConfig:R,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,responseGenerator:c,waitUntil:i.waitUntil,isMinimalMode:a});if(!j)return null;if((null==p||null==(s=p.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",T?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),O&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(p.value.headers);return a&&j||d.delete(m.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(p.cacheControl)),await (0,_.sendResponse)(z,F,new Response(p.value.body,{headers:d,status:p.value.status||200})),null};B?await l(B):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${L} ${v}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:T})}),j)throw t;return await (0,_.sendResponse)(z,F,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>b,"routeModule",()=>x,"serverHooks",()=>O,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>A],54696)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__44fe7470._.js.map