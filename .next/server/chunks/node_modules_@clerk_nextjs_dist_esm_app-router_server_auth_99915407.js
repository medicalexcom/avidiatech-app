module.exports=[7218,e=>{"use strict";e.i(78417);var t=e.i(51564);e.i(51783);var r=e.i(79509),n=e.i(57594);e.i(40726);var s=e.i(62790),a=e.i(347);let o=e=>{if(!e||"string"!=typeof e)return e;try{return(e||"").replace(/^(sk_(live|test)_)(.+?)(.{3})$/,"$1*********$4")}catch{return""}},i=e=>(Array.isArray(e)?e:[e]).map(e=>"string"==typeof e?o(e):JSON.stringify(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,o(t)])),null,2)).join(", "),u=(e,t)=>(...r)=>{let n=("string"==typeof e?()=>{let t=[],r=!1;return{enable:()=>{r=!0},debug:(...e)=>{r&&t.push(e.map(e=>"function"==typeof e?e():e))},commit:()=>{if(r){var n,s;for(let r of(console.log((n=e,`[clerk debug start: ${n}]`)),t)){let e=i(r);e=e.split("\n").map(e=>`  ${e}`).join("\n"),process.env.VERCEL&&(e=function(e,t){let r=new TextEncoder,n=new TextDecoder("utf-8"),s=r.encode(e).slice(0,4096);return n.decode(s).replace(/\uFFFD/g,"")}(e,4096)),console.log(e)}console.log((s=e,`[clerk debug end: ${s}] (@clerk/nextjs=6.36.2,next=${a.default.version},timestamp=${Math.round(new Date().getTime()/1e3)})`))}}}}:e)(),s=t(n);try{let e=s(...r);if("object"==typeof e&&"then"in e&&"function"==typeof e.then)return e.then(e=>(n.commit(),e)).catch(e=>{throw n.commit(),e});return n.commit(),e}catch(e){throw n.commit(),e}};var l=e.i(78538),c=e.i(39184),d=e.i(10698),h=e.i(52119);function g(e){let t=JSON.stringify(e),r=new TextEncoder().encode(t);return d.base64url.stringify(r,{pad:!1})}async function T(e,t,r){if(!r.algorithm)throw Error("No algorithm specified");let n=new TextEncoder,s=(0,d.getCryptoAlgorithm)(r.algorithm);if(!s)return{errors:[new h.SignJWTError(`Unsupported algorithm ${r.algorithm}`)]};let a=await (0,d.importKey)(t,s,"sign"),o=r.header||{typ:"JWT"};o.alg=r.algorithm,e.iat=Math.floor(Date.now()/1e3);let i=g(o),u=g(e),l=`${i}.${u}`;try{let e=await d.runtime.crypto.subtle.sign(s,a,n.encode(l));return{data:`${l}.${d.base64url.stringify(new Uint8Array(e),{pad:!1})}`}}catch(e){return{errors:[new h.SignJWTError(e?.message)]}}}e.i(1618),(0,c.withLegacyReturn)(d.verifyJwt);var p=(0,c.withLegacySyncReturn)(d.decodeJwt);(0,c.withLegacyReturn)(T),(0,c.withLegacyReturn)(d.hasValidSignature);var y=e.i(73271),k=e.i(13832);let A=e=>({authStatus:(0,y.getAuthKeyFromRequest)(e,"AuthStatus"),authToken:(0,y.getAuthKeyFromRequest)(e,"AuthToken"),authMessage:(0,y.getAuthKeyFromRequest)(e,"AuthMessage"),authReason:(0,y.getAuthKeyFromRequest)(e,"AuthReason"),authSignature:(0,y.getAuthKeyFromRequest)(e,"AuthSignature")}),S=(e,r,s=!0)=>{let a=(0,y.getHeader)(e,t.constants.Headers.ClerkRequestData),o=(0,k.decryptClerkRequestData)(a);return{secretKey:(null==r?void 0:r.secretKey)||o.secretKey||n.SECRET_KEY,publishableKey:o.publishableKey||n.PUBLISHABLE_KEY,apiUrl:n.API_URL,apiVersion:n.API_VERSION,authStatus:(0,y.getAuthKeyFromRequest)(e,"AuthStatus"),authMessage:(0,y.getAuthKeyFromRequest)(e,"AuthMessage"),authReason:(0,y.getAuthKeyFromRequest)(e,"AuthReason"),treatPendingAsSignedOut:s}},m=(e,{treatPendingAsSignedOut:r=!0,...n}={})=>{var s,a;let{authStatus:o,authMessage:i,authReason:u,authToken:l,authSignature:c}=A(e);null==(s=n.logger)||s.debug("headers",{authStatus:o,authMessage:i,authReason:u});let d=S(e,n,r);if(!(0,t.isTokenTypeAccepted)(t.TokenType.SessionToken,n.acceptsToken||t.TokenType.SessionToken))return(0,t.signedOutAuthObject)(d);if(o&&o===t.AuthStatus.SignedIn){(0,k.assertTokenSignature)(l,d.secretKey,c);let e=p(l);return null==(a=n.logger)||a.debug("jwt",e.raw),(0,t.getAuthObjectFromJwt)(e,d)}return(0,t.signedOutAuthObject)(d)};var v=e.i(78295);(({debugLoggerName:e,noAuthStatusMessage:r})=>u(e,e=>(n,a)=>((0,s.isTruthy)((0,y.getHeader)(n,t.constants.Headers.EnableDebug))&&e.enable(),(0,k.assertAuthStatus)(n,r),((t,r={})=>m(t,{...r,logger:e,acceptsToken:null==r?void 0:r.acceptsToken}))(n,{...a,logger:e,acceptsToken:null==a?void 0:a.acceptsToken}))))({debugLoggerName:"getAuth()",noAuthStatusMessage:(0,v.getAuthAuthHeaderMissing)()});let f={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401};Object.values(f);let b="NEXT_HTTP_ERROR_FALLBACK";function R(){let e=Error(b);throw e.digest=`${b};${f.UNAUTHORIZED}`,e}var w=e.i(63177);let U=e=>{var r,n;return!!e.headers.get(w.constants.Headers.NextUrl)&&!(e.headers.get(w.constants.Headers.NextUrl)&&((null==(r=e.headers.get(t.constants.Headers.Accept))?void 0:r.includes("text/x-component"))||(null==(n=e.headers.get(t.constants.Headers.ContentType))?void 0:n.includes("multipart/form-data"))||e.headers.get(w.constants.Headers.NextAction)))||H()},H=()=>{let e=globalThis.fetch;if(!("__nextPatched"in e&&!0===e.__nextPatched))return!1;let{page:t,pagePath:r}=e.__nextGetStaticStore().getStore()||{};return!!(r||t)},E=e=>!!e.headers.get(w.constants.Headers.NextjsData);var O=e.i(15484);let D=async a=>{var o;e.r(23502);let i=await (0,O.buildRequestLike)(),c=async()=>{if(l.isNextWithUnstableServerActions)return[];try{let t=await e.A(29652).then(e=>e.hasSrcAppDir());return[`Your Middleware exists at ./${t?"src/":""}middleware.(ts|js)`]}catch{return[]}},d=await (({debugLoggerName:r,noAuthStatusMessage:n})=>u(r,r=>async(a,o)=>{if((0,s.isTruthy)((0,y.getHeader)(a,t.constants.Headers.EnableDebug))&&r.enable(),!(0,y.detectClerkMiddleware)(a)){l.isNextWithUnstableServerActions&&(0,k.assertAuthStatus)(a,n);let t=await e.A(29652).then(e=>e.suggestMiddlewareLocation()).catch(()=>void 0);if(t)throw Error(t);(0,k.assertAuthStatus)(a,n)}return((e,n={})=>((e,r={})=>{var n,s;let{authStatus:a,authMessage:o,authReason:i}=A(e);null==(n=r.logger)||n.debug("headers",{authStatus:a,authMessage:o,authReason:i});let u=(0,y.getHeader)(e,t.constants.Headers.ClerkRequestData),l=(0,k.decryptClerkRequestData)(u),c=null==(s=(0,y.getHeader)(e,t.constants.Headers.Authorization))?void 0:s.replace("Bearer ",""),d=r.acceptsToken||t.TokenType.SessionToken,h=S(e,r),g=((e,r,n,s)=>{let a=e&&(0,t.isMachineTokenByPrefix)(e),o=n===t.TokenType.SessionToken||Array.isArray(n)&&1===n.length&&n[0]===t.TokenType.SessionToken;if(a&&r&&!o){let a=(0,t.getAuthObjectForAcceptedToken)({authObject:{...r,debug:()=>s},acceptsToken:n});return{...a,getToken:()=>a.isAuthenticated?Promise.resolve(e):Promise.resolve(null),has:()=>!1}}return null})(c,l.machineAuthObject,d,h);return g||(c&&Array.isArray(d)&&!d.includes(t.TokenType.SessionToken)?(0,t.invalidTokenAuthObject)():m(e,r))})(e,{...n,logger:r,acceptsToken:null==n?void 0:n.acceptsToken}))(a,{...o,logger:r,acceptsToken:null==o?void 0:o.acceptsToken})}))({debugLoggerName:"auth()",noAuthStatusMessage:(0,v.authAuthHeaderMissing)("auth",await c())})(i,{treatPendingAsSignedOut:null==a?void 0:a.treatPendingAsSignedOut,acceptsToken:null!=(o=null==a?void 0:a.acceptsToken)?o:t.TokenType.SessionToken}),h=(0,y.getAuthKeyFromRequest)(i,"ClerkUrl"),g=(...e)=>{let{returnBackUrl:s}=e[0]||{},a=(0,t.createClerkRequest)(i),o=a.clerkUrl.searchParams.get(t.constants.QueryParameters.DevBrowser)||a.cookies.get(t.constants.Cookies.DevBrowser),u=(0,y.getHeader)(i,t.constants.Headers.ClerkRequestData),l=(0,k.decryptClerkRequestData)(u);return[(0,t.createRedirect)({redirectAdapter:r.redirect,devBrowserToken:o,baseUrl:a.clerkUrl.toString(),publishableKey:l.publishableKey||n.PUBLISHABLE_KEY,signInUrl:l.signInUrl||n.SIGN_IN_URL,signUpUrl:l.signUpUrl||n.SIGN_UP_URL,sessionStatus:d.tokenType===t.TokenType.SessionToken?d.sessionStatus:null}),null===s?"":s||(null==h?void 0:h.toString())]};return d.tokenType===t.TokenType.SessionToken?Object.assign(d,{redirectToSignIn:(e={})=>{let[t,r]=g(e);return t.redirectToSignIn({returnBackUrl:r})},redirectToSignUp:(e={})=>{let[t,r]=g(e);return t.redirectToSignUp({returnBackUrl:r})}}):d};D.protect=async(...n)=>{var s,a;e.r(23502);let o=await (0,O.buildRequestLike)(),i=(null==(s=null==n?void 0:n[0])?void 0:s.token)||(null==(a=null==n?void 0:n[1])?void 0:a.token)||t.TokenType.SessionToken,u=await D({acceptsToken:i});return(function(e){let{redirectToSignIn:r,authObject:n,redirect:s,notFound:a,request:o,unauthorized:i}=e;return async(...e)=>{var u,l,c,d,h,g,T,p;let y=(e=>{if(e&&!e.unauthenticatedUrl&&!e.unauthorizedUrl&&!e.token&&(1!==Object.keys(e).length||!("token"in e)))return e})(e[0]),k=(null==(u=e[0])?void 0:u.unauthenticatedUrl)||(null==(l=e[1])?void 0:l.unauthenticatedUrl),A=(null==(c=e[0])?void 0:c.unauthorizedUrl)||(null==(d=e[1])?void 0:d.unauthorizedUrl),S=(null==(h=e[0])?void 0:h.token)||(null==(g=e[1])?void 0:g.token)||t.TokenType.SessionToken,m=()=>n.tokenType!==t.TokenType.SessionToken?i():A?s(A):a();if(!(0,t.isTokenTypeAccepted)(n.tokenType,S))return m();if(n.tokenType!==t.TokenType.SessionToken)return n.isAuthenticated?n:m();if("pending"===n.sessionStatus||!n.userId){return k?s(k):"document"===(T=o).headers.get(t.constants.Headers.SecFetchDest)||"iframe"===T.headers.get(t.constants.Headers.SecFetchDest)||(null==(p=T.headers.get(t.constants.Headers.Accept))?void 0:p.includes("text/html"))||U(T)||E(T)?r():a()}return y?"function"==typeof y?y(n.has)?n:m():n.has(y)?n:m():n}})({request:o,authObject:u,redirectToSignIn:u.redirectToSignIn,notFound:r.notFound,redirect:r.redirect,unauthorized:R})(...n)},e.s(["auth",()=>D],7218)}];

//# sourceMappingURL=node_modules_%40clerk_nextjs_dist_esm_app-router_server_auth_99915407.js.map