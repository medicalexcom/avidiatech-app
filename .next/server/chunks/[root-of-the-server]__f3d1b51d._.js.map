{"version":3,"sources":["../../../node_modules/%40clerk/nextjs/src/runtime/node/safe-node-apis.js","../../../node_modules/%40clerk/nextjs/src/server/fs/utils.ts","../../../node_modules/%40clerk/nextjs/src/server/fs/middleware-location.ts"],"sourcesContent":["/**\n * This file is used for conditional imports to mitigate bundling issues with Next.js server actions on version prior to 14.1.0.\n */\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nconst { existsSync, writeFileSync, readFileSync, appendFileSync, mkdirSync, rmSync } = require('node:fs');\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nconst path = require('node:path');\nconst fs = {\n  existsSync,\n  writeFileSync,\n  readFileSync,\n  appendFileSync,\n  mkdirSync,\n  rmSync,\n};\n\nconst cwd = () => process.cwd();\n\nmodule.exports = { fs, path, cwd };\n","/**\n * Attention: Only import this module when the node runtime is used.\n * We are using conditional imports to mitigate bundling issues with Next.js server actions on version prior to 14.1.0.\n */\nimport nodeRuntime from '#safe-node-apis';\n\n// Generic assertion function that acts as a proper type guard\nfunction assertNotNullable<T>(value: T, moduleName: string): asserts value is NonNullable<T> {\n  if (!value) {\n    throw new Error(`Clerk: ${moduleName} is missing. This is an internal error. Please contact Clerk's support.`);\n  }\n}\n\nconst nodeFsOrThrow = (): NonNullable<typeof nodeRuntime.fs> => {\n  assertNotNullable(nodeRuntime.fs, 'fs');\n  return nodeRuntime.fs;\n};\n\nconst nodePathOrThrow = (): NonNullable<typeof nodeRuntime.path> => {\n  assertNotNullable(nodeRuntime.path, 'path');\n  return nodeRuntime.path;\n};\n\nconst nodeCwdOrThrow = (): NonNullable<typeof nodeRuntime.cwd> => {\n  assertNotNullable(nodeRuntime.cwd, 'cwd');\n  return nodeRuntime.cwd;\n};\n\nexport { nodeCwdOrThrow, nodeFsOrThrow, nodePathOrThrow };\n","import { nodeCwdOrThrow, nodeFsOrThrow, nodePathOrThrow } from './utils';\n\nfunction hasSrcAppDir() {\n  const { existsSync } = nodeFsOrThrow();\n  const path = nodePathOrThrow();\n  const cwd = nodeCwdOrThrow();\n\n  const projectWithAppSrc = path.join(cwd(), 'src', 'app');\n\n  return !!existsSync(projectWithAppSrc);\n}\n\nfunction suggestMiddlewareLocation() {\n  const fileExtensions = ['ts', 'js'] as const;\n  const suggestionMessage = (\n    extension: (typeof fileExtensions)[number],\n    to: 'src/' | '',\n    from: 'src/app/' | 'app/' | '',\n  ) =>\n    `Clerk: clerkMiddleware() was not run, your middleware file might be misplaced. Move your middleware file to ./${to}middleware.${extension}. Currently located at ./${from}middleware.${extension}`;\n\n  const { existsSync } = nodeFsOrThrow();\n  const path = nodePathOrThrow();\n  const cwd = nodeCwdOrThrow();\n\n  const projectWithAppSrcPath = path.join(cwd(), 'src', 'app');\n  const projectWithAppPath = path.join(cwd(), 'app');\n\n  const checkMiddlewareLocation = (\n    basePath: string,\n    to: 'src/' | '',\n    from: 'src/app/' | 'app/' | '',\n  ): string | undefined => {\n    for (const fileExtension of fileExtensions) {\n      if (existsSync(path.join(basePath, `middleware.${fileExtension}`))) {\n        return suggestionMessage(fileExtension, to, from);\n      }\n    }\n    return undefined;\n  };\n\n  if (existsSync(projectWithAppSrcPath)) {\n    return (\n      checkMiddlewareLocation(projectWithAppSrcPath, 'src/', 'src/app/') || checkMiddlewareLocation(cwd(), 'src/', '')\n    );\n  }\n\n  if (existsSync(projectWithAppPath)) {\n    return checkMiddlewareLocation(projectWithAppPath, '', 'app/');\n  }\n\n  return undefined;\n}\n\nexport { suggestMiddlewareLocation, hasSrcAppDir };\n"],"names":["nodeRuntime"],"mappings":"kLAIA,GAAM,YAAE,CAAA,eAAY,CAAA,cAAe,CAAA,gBAAc,CAAA,WAAgB,CAAA,QAAW,CAAA,CAAO,CAAI,EAAiB,CAAA,CAAA,IAAT,EAc/F,EAAO,KAdiG,EAcjG,CAAU,CAAE,GAXR,CACT,aACA,6BACA,iBACA,YACA,SACA,CACF,EAIuB,KAZV,EAAmB,CAAA,CAAA,IAAX,GAYQ,IAFjB,IAAM,AAVc,QAUN,GAAA,CAAI,CAEG,oXClBjC,EAAA,CAAA,IAAA,CAAA,eAAA,IAAA,EAAA,cAAA,IAAA,EAAA,gBAAA,IAAA,CAAA,mBAAA,8BAAA,EAAA,OAAA,GAAA,8BAAA,GAIA,IAAA,cAAwB,EAAA,CAAA,CAAA,MAAA,4EAGxB,SAAS,EAAqB,CAAA,CAAU,CAAA,EAAqD,AAC3F,GAAI,CAAC,EACH,KADU,CACJ,AAAI,MAAM,CAAA,OAAA,EAAU,EAAU,QAAA,+DAAA,CAAyE,CAEjH,CAEA,IAAM,EAAgB,KACpB,CAD8D,CAC5C,EAAAA,OAAAA,CAAY,EAAA,CAAI,IAAI,EAC/B,EAAAA,OAAAA,CAAY,EAAA,EAGf,EAAkB,KACtB,CADkE,CAChD,EAAAA,OAAAA,CAAY,IAAA,CAAM,MAAM,EACnC,EAAAA,OAAAA,CAAY,IAAA,EAGf,EAAiB,KACrB,CADgE,CAC9C,EAAAA,OAAAA,CAAY,GAAA,CAAK,KAAK,EACjC,EAAAA,OAAAA,CAAY,GAAA,4JCzBrB,EAAA,CAAA,IAAA,CAAA,aAAA,IAAA,EAAA,0BAAA,IAAA,CAAA,mBAAA,8BAAA,EAAA,OAAA,GAAA,yMAAA,GAAA,IAAA,EAA+D,EAAA,CAAA,CAAA,MAE/D,SAAS,IACP,GAAM,QADgB,IACd,CAAA,CAAW,CAAA,CAAA,EAAI,EAAA,aAAA,EAAc,EAC/B,EAAA,CAAA,EAAO,EAAA,eAAA,EAAgB,EACvB,EAAA,CAAA,EAAM,EAAA,cAAA,EAAe,EAI3B,MAAO,CAAC,CAAC,EAFiB,EAAK,IAAA,CAAK,EAEhB,EAFoB,AAAG,MAAO,KAAK,EAGzD,CAEA,CAHuC,QAG9B,IACP,IAAM,EAAiB,CAAC,KAAM,IAAI,CAAA,CAC5B,EAAoB,CACxB,EACA,CAJiC,CAKjC,IAEA,CAAA,8GAAA,EAAiH,EAAE,WAAA,EAAc,EAAS,OAAA,kBAAA,EAA4B,EAAI,EAAA,SAAA,EAAc,EAAS,CAAA,CAE7L,KAF6L,OAE3L,CAAA,CAAW,CAAA,CAAA,EAAI,EAAA,aAAA,EAAc,EAC/B,EAAA,CAAA,EAAO,EAAA,eAAA,EAAgB,EACvB,EAAA,CAAA,EAAM,EAAA,cAAA,EAAe,EAErB,EAAwB,EAAK,IAAA,CAAK,IAAO,AAAH,MAAU,KAAK,EACrD,EAAqB,EAAK,IAAA,CAAK,IAAI,AAAG,KAAK,EAE3C,EAA0B,CAC9B,EACA,EACA,KAEA,IAAA,AADuB,IACZ,KAAiB,EAC1B,GAAI,EAAW,EAAK,IAAA,CAAK,CADiB,CACP,CAAA,WAAA,EAAc,EAAa,CAAE,CAAC,EAC/D,CADkE,MAAN,AACrD,EAAkB,EAAe,EAAI,EAIlD,EAJsD,OAMtD,AAAI,EAAW,GAEX,EAAwB,EAAuB,OAAQ,OAFvB,GAAG,AAE8B,GAAK,EAAwB,IAAI,AAAG,OAAQ,EAAE,EAI/G,EAAW,GACN,EAAwB,EAAoB,GAAI,MAAM,EAD9B,GAAG,GAKtC"}