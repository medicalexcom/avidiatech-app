module.exports=[14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},44070,e=>{"use strict";var t=e.i(24389);let r=process.env.NEXT_PUBLIC_SUPABASE_URL||process.env.SUPABASE_URL,i=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_ANON_KEY,s=null;r&&i?s=(0,t.createClient)(r,i):console.warn("Supabase client not configured (missing SUPABASE_URL or KEY). Some server operations will fail until configured.");let n=s,o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY??process.env.SUPABASE_ANON_KEY,a=process.env.SUPABASE_SERVICE_ROLE_KEY,l=null;function c(){let e=r&&a?(l||(l=(0,t.createClient)(r,a,{})),l):null;if(!e)throw Error("Server Supabase client is not configured. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in the environment.");return e}r&&a&&(0,t.createClient)(r,a),r&&o&&(0,t.createClient)(r,o),e.s(["getServerSupabase",()=>c,"getServiceSupabaseClient",0,c,"supabase",0,n])},78500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},87914,e=>{"use strict";function t(t){if(!process.env.CLERK_SECRET&&!process.env.NEXT_PUBLIC_CLERK_FRONTEND_API&&!process.env.NEXT_PUBLIC_CLERK_FRONTEND)return{userId:null};try{let r=e.r(6417);if(r&&"function"==typeof r.getAuth)try{return r.getAuth(t)}catch(e){console.warn("safeGetAuth: getAuth threw:",String(e))}}catch(e){console.warn("safeGetAuth: @clerk/nextjs/server not available at runtime:",String(e))}return{userId:null}}e.s(["safeGetAuth",()=>t])},24868,(e,t,r)=>{t.exports=e.x("fs/promises",()=>require("fs/promises"))},13108,e=>{"use strict";var t=e.i(14747),r=e.i(24868);let i=null,s=parseInt(process.env.RENDER_PROMPTS_TTL_SECONDS||"600",10),n=t.default.join(process.cwd(),"tools","render-engine","prompts","custom_gpt_instructions.md");async function o(){let e=await r.default.stat(n).catch(()=>null);if(!e||!e.isFile())throw Error(`custom_gpt_instructions_missing_or_empty: missing ${n}`);let t=await r.default.readFile(n,{encoding:"utf8"});if(!t||0===t.trim().length)throw Error(`custom_gpt_instructions_missing_or_empty: empty ${n}`);return console.info("loadInstructions: loaded local prompt from",n),t}async function a(e){let t=Date.now();if(i&&(t-i.fetchedAt)/1e3<s)return{text:i.value,source:"local"};let r=await o();return i={value:r,fetchedAt:Date.now(),source:"local"},{text:r,source:"local"}}e.s(["loadCustomGptInstructionsWithInfo",()=>a])},6167,e=>{"use strict";var t=e.i(44070);e.i(89228);var r=e.i(91601),i=e.i(13108);let s=process.env.OPENAI_API_KEY||"",n=process.env.OPENAI_SEO_MODEL||process.env.OPENAI_DESCRIBE_MODEL||process.env.OPENAI_MODEL||"gpt-4.1",o=new r.default({apiKey:s}),a=["not specified","not provided","not available","information not available","information not disclosed","warranty information not available","info not available","unknown","n/a","tbd","to be determined","unspecified"];function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c(e){return"string"==typeof e&&e.trim().length>0}function u(e){let t=e.toLowerCase();return t.includes("http://")||t.includes("https://")||t.includes("www.")||t.includes("product for ")}function p(e,t){if(!e){let e=Error(t);throw e.code="seo_invalid_model_output",e}}function d(e){if(!e)return"";let t=e;for(let[e,r]of Object.entries({"&nbsp;":" ","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&apos;":"'"}))t=t.replace(RegExp(e,"gi"),r);return t.replace(/&#(\d+);/g,(e,t)=>{try{return String.fromCharCode(Number(t))}catch{return""}})}function _(e){if(null==e)return"";let t=String(e);return(t=d(t=(t=t.replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g," ")).replace(/<[^>]+>/g," "))).replace(/[\r\n]+/g," ").replace(/\s+/g," ").trim()}function g(e,t){if(!e||!t)return 0;let r=e=>e.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).map(e=>e.trim()).filter(e=>e.length>1),i=new Set(r(e)),s=new Set(r(t));if(0===i.size||0===s.size)return 0;let n=0;for(let e of i)s.has(e)&&n++;let o=new Set([...i,...s]).size;return 0===o?0:n/o}function f(e,t,r=20){if("string"!=typeof e||t<=0)return"";let i=e.trim();if(i.length<=t)return i;for(let e=Math.min(i.length-1,t);e>=0;e--){let t=i[e];if("."===t||"!"===t||"?"===t){let t=i.slice(0,e+1).trim();if(t.length)return t;break}}if(r>0){let e=Math.min(i.length-1,t+r);for(let r=t+1;r<=e;r++){let e=i[r];if("."===e||"!"===e||"?"===e){let e=i.slice(0,r+1).trim();if(e.length)return e}}}let s=Math.max(i.lastIndexOf(",",t),i.lastIndexOf(";",t));if(s>-1&&s>=Math.floor(.25*t)){let e=i.slice(0,s).trim();if(e.length)return e}let n=i.slice(0,t),o=Math.max(n.lastIndexOf(" "),n.lastIndexOf("\n"),n.lastIndexOf("	"));if(o>-1&&o>=Math.floor(.2*t)){let e=i.slice(0,o).trim();if(e.length)return e}let a=n.lastIndexOf("&");if(a>0){let e=i.slice(0,a).trim();if(e.length)return e}return i.slice(0,Math.max(1,t))}async function m(e,t,r,m){if(!s)throw Error("OPENAI_API_KEY not configured");let{text:h,source:y}=await (0,i.loadCustomGptInstructionsWithInfo)(m??null);p(c(h),"seo_missing_custom_instructions: custom_gpt_instructions are required");let v={dom:{name_raw:e.name_raw||e.name,name:e.name,brand:e.brand??null,sku:e.sku??null,specs:e.specs??{},features_raw:e.features_raw??[],images:e.images??[],pdf_manual_urls:e.pdf_manual_urls??[],source_url:r??null},pdf_text:e.pdf_text??"",pdf_docs:[],browsed_text:e.description_raw??"",correlation_id:t??null,tenant_id:m??null},S={type:"object",additionalProperties:!1,required:["seo","descriptionHtml","sections","features","data_gaps","desc_audit"],properties:{seo:{type:"object",additionalProperties:!1,required:["h1","title","metaDescription","shortDescription","url"],properties:{h1:{type:"string"},title:{type:"string"},metaDescription:{type:"string"},shortDescription:{type:"string"},url:{type:"string"}}},descriptionHtml:{type:"string"},sections:{type:"object",additionalProperties:!1,required:["overview","hook","mainDescription","featuresBenefits","specifications","internalLinks","whyChoose","manuals","faqs"],properties:{overview:{type:"string"},hook:{type:"string"},mainDescription:{type:"string"},featuresBenefits:{type:"string"},specifications:{type:"string"},internalLinks:{type:"string"},whyChoose:{type:"string"},manuals:{anyOf:[{type:"string"},{type:"null"}]},faqs:{type:"string"}}},features:{type:"array",items:{type:"string"}},data_gaps:{type:"array",items:{type:"string"}},desc_audit:{type:"object",additionalProperties:!1,required:["score","data_gaps","conflicts","iterations","notes"],properties:{score:{type:"number"},data_gaps:{type:"array",items:{type:"string"}},conflicts:{type:"array",items:{type:"string"}},iterations:{type:"number"},notes:{type:"array",items:{type:"string"}}}}}},E=["You are AvidiaSEO.\nABSOLUTE PRIORITY: Follow the CUSTOM GPT INSTRUCTIONS below exactly. They override all other guidance.\n\nHARD REQUIREMENTS:\n1) Output MUST be valid JSON matching the provided JSON schema (strict).\n2) Do NOT invent facts. Use ONLY the packet fields as grounding.\n3) Customer-facing copy MUST NOT contain placeholders. Omit missing lines instead; record gaps only in desc_audit.data_gaps.\n4) sections.overview MUST equal descriptionHtml exactly (content equality after normalization).\n5) Product Specifications section MUST include real bullet(s) derived from packet.dom.specs.\n\nCUSTOM GPT INSTRUCTIONS (AUTHORITATIVE):",h.trim()].join("\n"),w=["GROUND TRUTH PACKET (JSON):",JSON.stringify(v,null,2),"\nReturn the final SEO JSON now."].join("\n"),R=null,A=null,O="",x=!1;for(let e=1;e<=3;e++){let t,r=w+(1===e?"":`
REVISION MODE (MANDATORY):
- Keep name_best exactly the same as previously chosen: ${JSON.stringify(R)}
- Fix ONLY the violations listed below.
- Do not add any new facts/specs not present in packet.
Violations: ${JSON.stringify(A)}`),i=function(e){let t=e?.output?.at?.(0)??e?.output?.[0]??null;if(!t)return"";let r=t?.content;if("string"==typeof r)return r;if(Array.isArray(r)){let e="";for(let t of r)"string"==typeof t?e+=t:t?.text&&"string"==typeof t.text?e+=t.text:t?.content&&"string"==typeof t.content&&(e+=t.content);return e}if("string"==typeof t?.text)return t.text;try{return JSON.stringify(t)}catch{return""}}(await o.responses.create({model:n,input:[{role:"system",content:E},{role:"user",content:r}],text:{format:{type:"json_schema",name:"avidia_seo_schema",schema:S,strict:!0}}}));O=i;try{t=JSON.parse(function(e){let t=(e||"").trim(),r=t.match(/```(?:json)?\s*([\s\S]*?)\s*```/i);return r?r[1].trim():t}(i))}catch(t){if(A="central_gpt_invalid_json",3===e){let e=Error("central_gpt_invalid_json");throw e.raw=i,e}continue}try{let r=String(t?.seo?.h1??"").trim();if(p(c(r),"central_gpt_seo_error: missing seo.h1"),R?p(r===R,"central_gpt_seo_error: name_best_changed"):(p(!u(r),"central_gpt_seo_error: h1_contains_url_or_placeholder"),R=r),c(t?.seo?.url)){let e=String(t.seo.url).trim();t.seo.url=e.startsWith("/")?e.endsWith("/")?e:`${e}/`:`/${e}/`}else t.seo.url=`/${R.toLowerCase().replace(/&/g," and ").replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}/`;try{let e=String(t.seo.title||t.seo?.pageTitle||"").trim(),r=String(t.seo.metaDescription||t.seo?.meta_description||"").trim(),i=d(e),s=d(r);t.seo.title=f(i,70,12),t.seo.metaDescription=f(s,160,20)}catch(e){t.seo.title=String(t.seo.title||t.seo?.pageTitle||"").trim().slice(0,70),t.seo.metaDescription=String(t.seo.metaDescription||t.seo?.meta_description||"").trim().slice(0,160)}try{let e=t.sections?.overview??"",r=t.descriptionHtml??"",i=_(e),s=_(r);if(i.length>20&&s.startsWith(i))t.sections.overview=t.descriptionHtml,x=!0;else{let e=function(e){if(!e||"string"!=typeof e)return"";let t=e.match(/<p[^>]*>[\s\S]*?<\/p>/i);if(t)return t[0];let r=e.search(/<h2\b/i);if(r>=0)return e.slice(0,r);let i=e.split(/\n\s*\n/);return i.length?i[0]:e}(r),n=_(e),o=g(i,n),a=g(i,s);i&&n&&(i===n||o>=.75)?(t.sections.overview=t.descriptionHtml,x=!0):(i===s||a>=.75)&&(t.sections.overview=t.descriptionHtml,x=x||a>=.75)}}catch(e){console.warn("overview auto-fix logic failed:",e)}return!function(e,t=.75){let r;p(e&&"object"==typeof e,"central_gpt_invalid_json"),p(e.seo&&"object"==typeof e.seo,"central_gpt_seo_error: missing seo"),p(c(e.seo.h1),"central_gpt_seo_error: missing seo.h1"),p(c(e.seo.title),"central_gpt_seo_error: missing seo.title"),p(c(e.seo.metaDescription),"central_gpt_seo_error: missing seo.metaDescription"),p(c(e.descriptionHtml),"central_gpt_seo_error: missing descriptionHtml"),p(e.sections&&"object"==typeof e.sections,"central_gpt_seo_error: missing sections"),p(!u(String(e.seo.h1)),"central_gpt_seo_error: h1_contains_url_or_placeholder");let i=function(e){if(!e||"string"!=typeof e)return null;let t=e.toLowerCase();for(let e of a){let r=e.toLowerCase().trim();if(!r||r.length<=2&&!r.includes("/"))continue;if(/[^\w\s]/.test(r)){let i=l(r);if(RegExp(`(^|[^a-z0-9])${i}([^a-z0-9]|$)`,"i").test(t))return e;continue}let i=l(r);if(RegExp(`\\b${i}\\b`,"i").test(t))return e}return null}([String(e.seo?.h1??""),String(e.seo?.title??""),String(e.seo?.metaDescription??""),String(e.seo?.shortDescription??""),String(e.descriptionHtml??""),JSON.stringify(e.sections??{})].join("\n"));p(!i,`central_gpt_seo_error: banned_placeholder_token:${i}`),p("string"==typeof e.sections.overview&&e.sections.overview.trim().length>0,"central_gpt_seo_error: sections.overview_missing");let s=_(e.sections.overview),n=_(e.descriptionHtml),o=s===n,d=g(s,n);if(!(o||d>=t)){let e=Error("central_gpt_seo_error: sections.overview_must_equal_descriptionHtml");throw e.details={normalizedOverview:s,normalizedDescription:n,tokenSimilarity:d,similarityThreshold:t},e}p("string"==typeof e.sections.specifications&&e.sections.specifications.trim().length>0,"central_gpt_seo_error: sections.specifications_missing"),p(((r=(String(e.sections.specifications)||"").match(/<li\b/gi))?r.length:0)>=1,"central_gpt_seo_error: specifications_has_no_bullets"),p(e.desc_audit&&"object"==typeof e.desc_audit,"central_gpt_seo_error: desc_audit_missing"),p(Array.isArray(e.desc_audit.data_gaps),"central_gpt_seo_error: desc_audit.data_gaps_missing")}(t,.75),Array.isArray(t.data_gaps)||(t.data_gaps=[]),Array.isArray(t.desc_audit?.data_gaps)&&(t.data_gaps=t.desc_audit.data_gaps),{descriptionHtml:t.descriptionHtml,sections:t.sections,seo:t.seo,features:Array.isArray(t.features)?t.features:[],data_gaps:Array.isArray(t.data_gaps)?t.data_gaps:[],desc_audit:t.desc_audit,_meta:{model:n,instructionsSource:y,iterations:e,autoFixedOverview:x}}}catch(t){if(A=t?.message||String(t),3===e){let e=Error(A.startsWith("central_gpt_")?A:`central_gpt_seo_error: ${A}`);throw e.raw=t?.raw??O??null,t?.details&&(e.details=t.details),t?.stack&&(e.innerStack=t.stack),e}continue}}let N=Error("central_gpt_seo_error: exhausted_iterations");throw N.raw=O,N}async function h(e){var r;let i,s,n,o,a=(0,t.getServiceSupabaseClient)(),{data:l,error:c}=await a.from("product_ingestions").select("id, tenant_id, source_url, normalized_payload, correlation_id, diagnostics").eq("id",e).maybeSingle();if(c)throw Error(`ingestion_load_failed: ${c.message||String(c)}`);if(!l)throw Error("ingestion_not_found");let u=l.normalized_payload;if(!u)throw Error("missing_required_ingestion_payload");let p=u?.name;if(!("string"==typeof p&&p.trim().length>0)||(i=String(p).toLowerCase()).includes("http://")||i.includes("https://")||i.includes("www.")||i.includes("product for "))throw Error("ingestion_not_ready: normalized_payload.name is missing or url-derived (re-ingest with proper name extraction)");if(!((r=u?.specs)&&(Array.isArray(r)?r.length>0:"object"==typeof r&&Object.keys(r).length>0)))throw Error("ingestion_not_ready: normalized_payload.specs empty (re-ingest with includeSpecs=true)");let d=new Date().toISOString(),_=await m(u,l.correlation_id||null,l.source_url||null,l.tenant_id||null),g=new Date().toISOString(),f=l.diagnostics||{},h={...f,seo:{...f.seo||{},status:"completed",started_at:d,last_run_at:g,instruction_source:_?._meta?.instructionsSource??null,model:_?._meta?.model??null,iterations:_?._meta?.iterations??null,data_gaps:_.data_gaps??[],audit_score:"number"==typeof _?.desc_audit?.score?_.desc_audit.score:null,audit_conflicts:Array.isArray(_?.desc_audit?.conflicts)?_.desc_audit.conflicts:[]}},y=(s=_&&_.seo?_.seo:_??{},n=(...e)=>{for(let t of e)if(t){if("string"==typeof t){let e=t.split("."),r=_;for(let t of e){if(null==r){r=void 0;break}r=r[t]}if(void 0!==r)return r}else if(Array.isArray(t)){let e=_;for(let r of t){if(null==e){e=void 0;break}e=e[r]}if(void 0!==e)return e}}},!(o={..._,seo:s,_meta:_?._meta??null,h1:n("seo.h1","h1")??null,pageTitle:n("seo.pageTitle","seo.title","pageTitle","title")??null,title:n("seo.title","seo.pageTitle","title","pageTitle")??null,metaDescription:n("seo.metaDescription","seo.meta_description","metaDescription","meta_description")??null,meta_description:n("seo.meta_description","seo.metaDescription","meta_description","metaDescription")??null,shortDescription:n("seo.shortDescription","seo.seoShortDescription","shortDescription","seoShortDescription")??null,seoShortDescription:n("seo.seoShortDescription","seo.shortDescription","seoShortDescription","shortDescription")??null}).pageTitle&&o.title&&(o.pageTitle=o.title),!o.title&&o.pageTitle&&(o.title=o.pageTitle),!o.metaDescription&&o.meta_description&&(o.metaDescription=o.meta_description),!o.meta_description&&o.metaDescription&&(o.meta_description=o.metaDescription),o),{data:v,error:S}=await a.from("product_ingestions").update({seo_payload:y,description_html:_.descriptionHtml,features:_.features,seo_generated_at:g,diagnostics:h,updated_at:g}).eq("id",e).select("id, seo_payload, description_html, features").maybeSingle();if(S)throw Error(`seo_persist_failed: ${S.message||String(S)}`);let E=v?.seo_payload??y,w=v?.description_html??_.descriptionHtml,R=v?.features??_.features;return{ingestionId:e,descriptionHtml:w,sections:_.sections??null,seo:_.seo??null,features:R??[],data_gaps:_.data_gaps??[],desc_audit:_.desc_audit??null,_meta:_._meta??null,seo_payload:E,description_html:w}}e.s(["runSeoForIngestion",()=>h],6167)},79622,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),s=e.i(59756),n=e.i(61916),o=e.i(14444),a=e.i(37092),l=e.i(69741),c=e.i(16795),u=e.i(87718),p=e.i(95169),d=e.i(47587),_=e.i(66012),g=e.i(70101),f=e.i(26937),m=e.i(10372),h=e.i(93695);e.i(52474);var y=e.i(5232),v=e.i(89171),S=e.i(87914),E=e.i(6167);async function w(e){try{let t=(0,S.safeGetAuth)(e);if(!t?.userId)return v.NextResponse.json({error:"unauthenticated"},{status:401});let r=await e.json().catch(()=>({})),i=r?.ingestionId?.toString()||"";if(!i)return v.NextResponse.json({error:"missing_ingestionId"},{status:400});let s=await (0,E.runSeoForIngestion)(i);return v.NextResponse.json({ingestionId:s.ingestionId,descriptionHtml:s.descriptionHtml,sections:s.sections,seo:s.seo,features:s.features,data_gaps:s.data_gaps,seo_payload:s.seo,description_html:s.descriptionHtml},{status:200})}catch(r){let e=r?.message||"internal_error",t=r?.code;if("ingestion_not_found"===e)return v.NextResponse.json({error:"ingestion_not_found"},{status:404});if("missing_required_ingestion_payload"===e)return v.NextResponse.json({error:"missing_required_ingestion_payload"},{status:400});if(e.startsWith("ingestion_load_failed:"))return v.NextResponse.json({error:"ingestion_load_failed",detail:e},{status:500});if(e.startsWith("seo_persist_failed:"))return v.NextResponse.json({error:"seo_persist_failed",detail:e},{status:500});if("OPENAI_API_KEY not configured"===e)return v.NextResponse.json({error:"openai_not_configured"},{status:500});if("seo_invalid_model_output"===t||e.startsWith("seo_invalid_model_output:")||e.startsWith("seo_missing_custom_instructions:"))return v.NextResponse.json({error:"seo_invalid_model_output",detail:e,debug:r?.debug??null},{status:500});return v.NextResponse.json({error:e},{status:500})}}e.s(["POST",()=>w],19878);var R=e.i(19878);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/seo/route",pathname:"/api/v1/seo",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/seo/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:O,workUnitAsyncStorage:x,serverHooks:N}=A;function b(){return(0,i.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:x})}async function C(e,t,i){A.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/v1/seo/route";v=v.replace(/\/index$/,"")||"/";let S=await A.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!S)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:E,params:w,nextConfig:R,parsedUrl:O,isDraftMode:x,prerenderManifest:N,routerServerContext:b,isOnDemandRevalidate:C,revalidateOnlyGenerated:T,resolvedPathname:I,clientReferenceManifest:D,serverActionsManifest:P}=S,U=(0,l.normalizeAppPath)(v),j=!!(N.dynamicRoutes[U]||N.routes[I]),H=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,O,!1):t.end("This page could not be found"),null);if(j&&!x){let e=!!N.routes[I],t=N.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await H();throw new h.NoFallbackError}}let k=null;!j||A.isDev||x||(k="/index"===(k=I)?"/":k);let M=!0===A.isDev||!j,L=j&&!M;P&&D&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:D,serverActionsManifest:P,serverModuleMap:(0,a.createServerModuleMap)({serverActionsManifest:P})});let q=e.method||"GET",$=(0,n.getTracer)(),K=$.getActiveScopeSpan(),B={params:w,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>A.onRequestError(e,t,i,b)},sharedContext:{buildId:E}},F=new c.NodeNextRequest(e),z=new c.NodeNextResponse(t),Y=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let o=async e=>A.handle(Y,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${q} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${v}`)}),a=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let c=async({previousCacheEntry:r})=>{try{if(!a&&C&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(s);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let c=B.renderOpts.collectedTags;if(!j)return await (0,_.sendResponse)(F,z,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,i=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:C})},b),t}},u=await A.handleResponse({req:e,nextConfig:R,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:T,responseGenerator:c,waitUntil:i.waitUntil,isMinimalMode:a});if(!j)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",C?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return a&&j||p.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,_.sendResponse)(F,z,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};K?await l(K):await $.withPropagatedContext(e.headers,()=>$.trace(p.BaseServerSpan.handleRequest,{spanName:`${q} ${v}`,kind:n.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:C})}),j)throw t;return await (0,_.sendResponse)(F,z,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>b,"routeModule",()=>A,"serverHooks",()=>N,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>x],79622)},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))},75499,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__f3d1b51d._.js"].map(t=>e.l(t))).then(()=>t(5575)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__36c724c6._.js.map