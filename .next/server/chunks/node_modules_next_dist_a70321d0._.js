module.exports=[97953,(e,t,r)=>{"use strict";t.exports=e.r(42315).vendored["react-rsc"].ReactServerDOMTurbopackServer},45015,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"registerServerReference",{enumerable:!0,get:function(){return n.registerServerReference}});let n=e.r(97953)},95975,(e,t,r)=>{"use strict";function n(e){for(let t=0;t<e.length;t++){let r=e[t];if("function"!=typeof r)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof r}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ensureServerEntryExports",{enumerable:!0,get:function(){return n}})},84774,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),a=e.i(59756),s=e.i(61916),o=e.i(14444),i=e.i(37092),l=e.i(69741),c=e.i(16795),u=e.i(87718),d=e.i(95169),p=e.i(47587),f=e.i(66012),h=e.i(70101),g=e.i(26937),m=e.i(10372),v=e.i(93695);e.i(52474);var R=e.i(5232),E=e.i(89171),_=e.i(45015),w=e.i(72195),y=e.i(54799);let S=process.env.INTEGRATIONS_ENCRYPTION_KEY||"";function b(){if(!S)throw Error("INTEGRATIONS_ENCRYPTION_KEY is not set");return/^[0-9a-fA-F]+$/.test(S)&&64===S.length?Buffer.from(S,"hex"):Buffer.from(S,"base64")}function A(e){let t=b(),r=Buffer.from(e,"base64"),n=r.slice(0,12),a=r.slice(12,28),s=r.slice(28),o=y.default.createDecipheriv("aes-256-gcm",t,n);return o.setAuthTag(a),JSON.parse(Buffer.concat([o.update(s),o.final()]).toString("utf8"))}var x=e.i(95975);let C=process.env.SUPABASE_URL,N=process.env.SUPABASE_SERVICE_ROLE_KEY,O=(0,w.createClient)(C,N,{auth:{persistSession:!1}});async function T({orgId:e,provider:t,name:r,config:n={},secrets:a={},createdBy:s}){let o,i,l,c,u,d,p=(o=b(),i=y.default.randomBytes(12),l=y.default.createCipheriv("aes-256-gcm",o,i),c=JSON.stringify(a),u=Buffer.concat([l.update(c,"utf8"),l.final()]),d=l.getAuthTag(),Buffer.concat([i,d,u]).toString("base64")),{data:f,error:h}=await O.from("integrations").insert({org_id:e,provider:t,name:r??t,config:n,encrypted_secrets:p,created_by:s??null}).select("*").single();if(h)throw h;return f}async function P(e){let{data:t,error:r}=await O.from("integrations").select("*").eq("org_id",e).order("created_at",{ascending:!1});if(r)throw r;return t}async function k(e){let{data:t,error:r}=await O.from("integrations").select("*").eq("id",e).single();if(r)throw r;return t}async function j(e){let t=e.provider,r=e.config??{},n=e.encrypted_secrets?A(e.encrypted_secrets):{};try{if("bigcommerce"===t){let e=r.store_hash,t=n.access_token;if(!e||!t)throw Error("Missing store_hash or access token");let a=await fetch(`https://api.bigcommerce.com/stores/${e}/v3/catalog/products?limit=1`,{headers:{"X-Auth-Token":t,Accept:"application/json"}});if(!a.ok){let e=await a.text().catch(()=>"");throw Error(`BigCommerce test failed: ${a.status} ${e}`)}return{ok:!0}}if(r.test_url){let e=await fetch(r.test_url,{method:"GET",headers:{}});if(!e.ok)throw Error(`Test URL failed: ${e.status}`)}return{ok:!0}}catch(e){return{ok:!1,error:String(e?.message??e)}}}async function I(e,t,r){let n=r.encrypted_secrets?A(r.encrypted_secrets):{},a=r.provider;if("bigcommerce"===a){let a=r.config?.store_hash,s=n.access_token;if(!a||!s)throw Error("Missing BigCommerce credentials");let o=await fetch(`https://api.bigcommerce.com/stores/${a}/v3/catalog/products?limit=100`,{headers:{"X-Auth-Token":s,Accept:"application/json"}});if(!o.ok){let e=await o.text().catch(()=>"");throw Error(`BigCommerce fetch failed: ${o.status} ${e}`)}let i=await o.json(),l=i.data??i,c=l.map((e,r)=>({job_id:t,row_number:r+1,data:e,status:"success"}));if(c.length)for(let t=0;t<c.length;t+=200){let r=c.slice(t,t+200),{error:n}=await e.from("import_rows").insert(r);if(n)throw n}await e.from("import_jobs").update({total_rows:l.length,processed_rows:c.length,status:"complete",result_summary:{successes:c.length,failures:0}}).eq("id",t);return}throw await e.from("import_jobs").update({status:"failed",errors:JSON.stringify([`sync for provider ${a} is not implemented`])}).eq("id",t),Error(`sync for provider ${a} is not implemented`)}(0,x.ensureServerEntryExports)([T,P,k,j]),(0,_.registerServerReference)(T,"40f605855db79c2c7287d3af70129a17fb5aaa151f",null),(0,_.registerServerReference)(P,"40557077887d4b0f796e0db4900a14096c6549a221",null),(0,_.registerServerReference)(k,"40211730231494f14a497df9127c1b005e8426693a",null),(0,_.registerServerReference)(j,"4024388cfc9fa7068fed63b5678e278fd82710c205",null),(0,x.ensureServerEntryExports)([I]),(0,_.registerServerReference)(I,"70b3335904c22adba67d4ff4e309bcf34c504f258f",null);let U=process.env.SUPABASE_URL,q=process.env.SUPABASE_SERVICE_ROLE_KEY,M=(0,w.createClient)(U,q,{auth:{persistSession:!1}});async function $(e,t){try{let r=t?.params;r&&"function"==typeof r?.then&&(r=await r);let n=r?.id;if(!n)return E.NextResponse.json({ok:!1,error:"id required"},{status:400});let a=await e.json().catch(()=>({})),s=a.org_id,o=a.created_by??null;if(!s)return E.NextResponse.json({ok:!1,error:"org_id required"},{status:400});let i=await k(n);if(!i)return E.NextResponse.json({ok:!1,error:"integration not found"},{status:404});let{data:l,error:c}=await M.from("import_jobs").insert({org_id:s,created_by:o,file_path:null,file_name:null,file_format:null,status:"processing",source_type:"connector",connector_id:n,meta:{provider:i.provider}}).select("*").single();if(c)throw c;try{return await I(M,String(l.id),i),E.NextResponse.json({ok:!0,jobId:l.id})}catch(e){return await M.from("import_jobs").update({status:"failed",errors:JSON.stringify([String(e?.message||e)])}).eq("id",l.id),E.NextResponse.json({ok:!1,error:String(e?.message||e)},{status:500})}}catch(e){return E.NextResponse.json({ok:!1,error:e?.message??String(e)},{status:500})}}e.s(["POST",()=>$],3448);var B=e.i(3448);let H=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/integrations/[id]/sync/route",pathname:"/api/v1/integrations/[id]/sync",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/integrations/[id]/sync/route.ts",nextConfigOutput:"",userland:B}),{workAsyncStorage:D,workUnitAsyncStorage:K,serverHooks:L}=H;function F(){return(0,n.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:K})}async function G(e,t,n){H.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/v1/integrations/[id]/sync/route";E=E.replace(/\/index$/,"")||"/";let _=await H.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:w,params:y,nextConfig:S,parsedUrl:b,isDraftMode:A,prerenderManifest:x,routerServerContext:C,isOnDemandRevalidate:N,revalidateOnlyGenerated:O,resolvedPathname:T,clientReferenceManifest:P,serverActionsManifest:k}=_,j=(0,l.normalizeAppPath)(E),I=!!(x.dynamicRoutes[j]||x.routes[T]),U=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,b,!1):t.end("This page could not be found"),null);if(I&&!A){let e=!!x.routes[T],t=x.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await U();throw new v.NoFallbackError}}let q=null;!I||H.isDev||A||(q="/index"===(q=T)?"/":q);let M=!0===H.isDev||!I,$=I&&!M;k&&P&&(0,o.setReferenceManifestsSingleton)({page:E,clientReferenceManifest:P,serverActionsManifest:k,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:k})});let B=e.method||"GET",D=(0,s.getTracer)(),K=D.getActiveScopeSpan(),L={params:y,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>H.onRequestError(e,t,n,C)},sharedContext:{buildId:w}},F=new c.NodeNextRequest(e),G=new c.NodeNextResponse(t),X=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let o=async e=>H.handle(X,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=D.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${B} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${B} ${E}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var s,l;let c=async({previousCacheEntry:r})=>{try{if(!i&&N&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(a);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!I)return await (0,f.sendResponse)(F,G,s,L.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await H.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})},C),t}},u=await H.handleResponse({req:e,nextConfig:S,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:i});if(!I)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&I||d.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)(F,G,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};K?await l(K):await D.withPropagatedContext(e.headers,()=>D.trace(d.BaseServerSpan.handleRequest,{spanName:`${B} ${E}`,kind:s.SpanKind.SERVER,attributes:{"http.method":B,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await H.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})}),I)throw t;return await (0,f.sendResponse)(F,G,new Response(null,{status:500})),null}}e.s(["handler",()=>G,"patchFetch",()=>F,"routeModule",()=>H,"serverHooks",()=>L,"workAsyncStorage",()=>D,"workUnitAsyncStorage",()=>K],84774)}];

//# sourceMappingURL=node_modules_next_dist_a70321d0._.js.map