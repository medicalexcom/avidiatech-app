module.exports=[78500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},72836,e=>{"use strict";var t=e.i(24389);async function r(e){let{clerkOrgId:r,clerkUserId:a,tenantName:s}=e;if(!r)throw Error("missing_org");if(!a)throw Error("missing_user");let n=function(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL");if(!r)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY");return(0,t.createClient)(e,r,{auth:{persistSession:!1,autoRefreshToken:!1}})}(),i=await n.from("tenants").select("id").eq("clerk_org_id",r).maybeSingle();if(i.error)throw Error(`tenant_lookup_failed:${i.error.message}`);let o=i.data?.id;if(!o){let e=await n.from("tenants").insert({clerk_org_id:r,name:s??null}).select("id").single();if(e.error)throw Error(`tenant_create_failed:${e.error.message}`);o=e.data.id}let l=await n.from("tenant_members").upsert({tenant_id:o,clerk_user_id:a,role:"member"},{onConflict:"tenant_id,clerk_user_id"});if(l.error)throw Error(`tenant_membership_failed:${l.error.message}`);return o}e.s(["getOrCreateTenantIdFromClerkOrg",()=>r])},67404,e=>{"use strict";e.i(78417);var t=e.i(51564),r=e.i(15484);e.i(79640);var a=e.i(39184);e.i(10698),e.i(52119),e.i(1618),e.i(39345),e.i(87442),e.i(31112);var s=e.i(31293),n=e.i(62790),i=class{#e;#t=864e5;constructor(e){this.#e=e}isEventThrottled(e){let t=Date.now(),r=this.#r(e),a=this.#e.getItem(r);return!!a&&!(t-a>this.#t)||(this.#e.setItem(r,t),!1)}#r(e){let{sk:t,pk:r,payload:a,...s}=e,n={...a,...s};return JSON.stringify(Object.keys({...a,...s}).sort().map(e=>n[e]))}},o=class{#a="clerk_telemetry_throttler";getItem(e){return this.#s()[e]}setItem(e,t){try{let r=this.#s();r[e]=t,localStorage.setItem(this.#a,JSON.stringify(r))}catch(e){e instanceof DOMException&&("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&localStorage.length>0&&localStorage.removeItem(this.#a)}}removeItem(e){try{let t=this.#s();delete t[e],localStorage.setItem(this.#a,JSON.stringify(t))}catch{}}#s(){try{let e=localStorage.getItem(this.#a);if(!e)return{};return JSON.parse(e)}catch{return{}}}static isSupported(){return!1}},l=class{#e=new Map;#n=1e4;getItem(e){return this.#e.size>this.#n?void this.#e.clear():this.#e.get(e)}setItem(e,t){this.#e.set(e,t)}removeItem(e){this.#e.delete(e)}};let c=new Set(["error","warn","info","debug","trace"]);var d=class{#i;#o;#l={};#c=[];#d=null;constructor(e){this.#i={maxBufferSize:e.maxBufferSize??5,samplingRate:e.samplingRate??1,perEventSampling:e.perEventSampling??!0,disabled:e.disabled??!1,debug:e.debug??!1,endpoint:"https://clerk-telemetry.com"},e.clerkVersion?this.#l.clerkVersion=e.clerkVersion??"":this.#l.clerkVersion="",this.#l.sdk=e.sdk,this.#l.sdkVersion=e.sdkVersion,this.#l.publishableKey=e.publishableKey??"";const t=(0,s.parsePublishableKey)(e.publishableKey);t&&(this.#l.instanceType=t.instanceType),e.secretKey&&(this.#l.secretKey=e.secretKey.substring(0,16)),this.#o=new i(o.isSupported()?new o:new l)}get isEnabled(){return!("development"!==this.#l.instanceType||this.#i.disabled||"undefined"!=typeof process&&process.env&&(0,n.isTruthy)(process.env.CLERK_TELEMETRY_DISABLED))}get isDebug(){return this.#i.debug||"undefined"!=typeof process&&process.env&&(0,n.isTruthy)(process.env.CLERK_TELEMETRY_DEBUG)}record(e){try{let t=this.#u(e.event,e.payload);if(this.#h(t.event,t),!this.#p(t,e.eventSamplingRate))return;this.#c.push({kind:"event",value:t}),this.#g()}catch(e){console.error("[clerk/telemetry] Error recording telemetry event",e)}}recordLog(e){try{if(!this.#m(e))return;let t="string"==typeof e?.level&&c.has(e.level),r="string"==typeof e?.message&&e.message.trim().length>0,a=null,s=e?.timestamp;if("number"==typeof s||"string"==typeof s){let e=new Date(s);Number.isNaN(e.getTime())||(a=e)}if(!t||!r||null===a){this.isDebug&&"undefined"!=typeof console&&console.warn("[clerk/telemetry] Dropping invalid telemetry log entry",{levelIsValid:t,messageIsValid:r,timestampIsValid:null!==a});return}let n=this.#f(),i={sdk:n.name,sdkv:n.version,cv:this.#l.clerkVersion??"",lvl:e.level,msg:e.message,ts:a.toISOString(),pk:this.#l.publishableKey||null,payload:this.#E(e.context)};this.#c.push({kind:"log",value:i}),this.#g()}catch(e){console.error("[clerk/telemetry] Error recording telemetry log entry",e)}}#p(e,t){return this.isEnabled&&!this.isDebug&&this.#v(e,t)}#m(e){return!0}#v(e,t){let r=Math.random();return!!(r<=this.#i.samplingRate&&(!1===this.#i.perEventSampling||void 0===t||r<=t))&&!this.#o.isEventThrottled(e)}#g(){this.#y()}#y(){let e=[...this.#c];if(this.#c=[],this.#d=null,0===e.length)return;let t=e.filter(e=>"event"===e.kind).map(e=>e.value),r=e.filter(e=>"log"===e.kind).map(e=>e.value);t.length>0&&fetch(new URL("/v1/event",this.#i.endpoint),{headers:{"Content-Type":"application/json"},keepalive:!0,method:"POST",body:JSON.stringify({events:t})}).catch(()=>void 0),r.length>0&&fetch(new URL("/v1/logs",this.#i.endpoint),{headers:{"Content-Type":"application/json"},keepalive:!0,method:"POST",body:JSON.stringify({logs:r})}).catch(()=>void 0)}#h(e,t){this.isDebug&&(void 0!==console.groupCollapsed?(console.groupCollapsed("[clerk/telemetry]",e),console.log(t),console.groupEnd()):console.log("[clerk/telemetry]",e,t))}#f(){return{name:this.#l.sdk,version:this.#l.sdkVersion}}#u(e,t){let r=this.#f();return{event:e,cv:this.#l.clerkVersion??"",it:this.#l.instanceType??"",sdk:r.name,sdkv:r.version,...this.#l.publishableKey?{pk:this.#l.publishableKey}:{},...this.#l.secretKey?{sk:this.#l.secretKey}:{},payload:t}}#E(e){if(null==e||"object"!=typeof e)return null;try{let t=JSON.parse(JSON.stringify(e));if(t&&"object"==typeof t&&!Array.isArray(t))return t;return null}catch{return null}}};(0,a.withLegacyReturn)(t.verifyToken);var u=e.i(57594);let h={secretKey:u.SECRET_KEY,publishableKey:u.PUBLISHABLE_KEY,apiUrl:u.API_URL,apiVersion:u.API_VERSION,userAgent:"@clerk/nextjs@6.36.2",proxyUrl:u.PROXY_URL,domain:u.DOMAIN,isSatellite:u.IS_SATELLITE,machineSecretKey:u.MACHINE_SECRET_KEY,sdkMetadata:u.SDK_METADATA,telemetry:{disabled:u.TELEMETRY_DISABLED,debug:u.TELEMETRY_DEBUG}},p=e=>{let r,a,s,n;return r={...h,...e},a=(0,t.createBackendApiClient)(r),s=(0,t.createAuthenticateRequest)({options:r,apiClient:a}),n=new d({publishableKey:r.publishableKey,secretKey:r.secretKey,samplingRate:.1,...r.sdkMetadata?{sdk:r.sdkMetadata.name,sdkVersion:r.sdkMetadata.version}:{},...r.telemetry||{}}),{...a,...s,telemetry:n}};var g=e.i(73271);let m=new(e.i(78500)).AsyncLocalStorage;var f=e.i(13832);let E=async()=>{var e,a;let s;try{let e=await (0,r.buildRequestLike)(),a=(0,g.getHeader)(e,t.constants.Headers.ClerkRequestData);s=(0,f.decryptClerkRequestData)(a)}catch(e){if(e&&(0,r.isPrerenderingBailout)(e))throw e}let n=null!=(a=null==(e=m.getStore())?void 0:e.get("requestData"))?a:s;return(null==n?void 0:n.secretKey)||(null==n?void 0:n.publishableKey)?p(n):p({})};e.s(["clerkClient",()=>E],67404)},47616,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),s=e.i(59756),n=e.i(61916),i=e.i(14444),o=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),h=e.i(47587),p=e.i(66012),g=e.i(70101),m=e.i(26937),f=e.i(10372),E=e.i(93695);e.i(52474);var v=e.i(5232),y=e.i(89171),R=e.i(7218),_=e.i(67404),S=e.i(24389),b=e.i(72836);async function k(e){if(!process.env.INTEGRATIONS_ENCRYPTION_KEY)throw Error("missing_encryption_key");return Buffer.from(JSON.stringify({accessToken:e}),"utf8").toString("base64")}async function w(e){try{let{userId:t,orgId:r}=await (0,R.auth)();if(!t)return y.NextResponse.json({error:"unauthorized"},{status:401});if(!r)return y.NextResponse.json({error:"missing_tenant"},{status:400});let a=await e.json().catch(()=>({})),s=a.storeHash??a.store_hash,n=a.accessToken??a.access_token;if(!s||!n)return y.NextResponse.json({error:"missing_fields",missing:{storeHash:!s,accessToken:!n}},{status:400});let i=null;try{let e=await (0,_.clerkClient)(),t=await e.organizations.getOrganization({organizationId:r});i=t?.name??null}catch{}let o=await (0,b.getOrCreateTenantIdFromClerkOrg)({clerkOrgId:r,clerkUserId:t,tenantName:i}),l=function(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL");if(!t)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY");return(0,S.createClient)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1}})}(),c=await k(n),d=await l.from("ecommerce_connections").insert({tenant_id:o,platform:"bigcommerce",status:"active",config:{store_hash:s},secrets_enc:c}).select("id, tenant_id, platform, status, config, created_at").single();if(d.error)return y.NextResponse.json({error:"db_insert_failed",detail:d.error.message},{status:500});return y.NextResponse.json({ok:!0,connection:d.data},{status:200})}catch(t){let e=t instanceof Error?t.message:String(t);return y.NextResponse.json({error:e},{status:500})}}e.s(["POST",()=>w],79134);var C=e.i(79134);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/integrations/ecommerce/bigcommerce/route",pathname:"/api/v1/integrations/ecommerce/bigcommerce",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/integrations/ecommerce/bigcommerce/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:A,workUnitAsyncStorage:I,serverHooks:O}=T;function N(){return(0,a.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:I})}async function x(e,t,a){T.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/v1/integrations/ecommerce/bigcommerce/route";y=y.replace(/\/index$/,"")||"/";let R=await T.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:_,params:S,nextConfig:b,parsedUrl:k,isDraftMode:w,prerenderManifest:C,routerServerContext:A,isOnDemandRevalidate:I,revalidateOnlyGenerated:O,resolvedPathname:N,clientReferenceManifest:x,serverActionsManifest:K}=R,P=(0,l.normalizeAppPath)(y),U=!!(C.dynamicRoutes[P]||C.routes[N]),L=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,k,!1):t.end("This page could not be found"),null);if(U&&!w){let e=!!C.routes[N],t=C.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await L();throw new E.NoFallbackError}}let D=null;!U||T.isDev||w||(D="/index"===(D=N)?"/":D);let M=!0===T.isDev||!U,B=U&&!M;K&&x&&(0,i.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:x,serverActionsManifest:K,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:K})});let H=e.method||"GET",j=(0,n.getTracer)(),q=j.getActiveScopeSpan(),V={params:S,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>T.onRequestError(e,t,a,A)},sharedContext:{buildId:_}},F=new c.NodeNextRequest(e),Y=new c.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let i=async e=>T.handle(z,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${y}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let c=async({previousCacheEntry:r})=>{try{if(!o&&I&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=V.renderOpts.fetchMetrics;let l=V.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=V.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(F,Y,n,V.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,a=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:I})},A),t}},d=await T.handleResponse({req:e,nextConfig:b,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:o});if(!U)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",I?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&U||u.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(F,Y,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};q?await l(q):await j.withPropagatedContext(e.headers,()=>j.trace(u.BaseServerSpan.handleRequest,{spanName:`${H} ${y}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof E.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:I})}),U)throw t;return await (0,p.sendResponse)(F,Y,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>N,"routeModule",()=>T,"serverHooks",()=>O,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>I],47616)},29652,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__e438751d._.js"].map(t=>e.l(t))).then(()=>t(26445)))},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__81c90be1._.js.map