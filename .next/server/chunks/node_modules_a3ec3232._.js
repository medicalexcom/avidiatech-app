module.exports=[36065,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),a=e.i(59756),o=e.i(61916),s=e.i(14444),i=e.i(37092),u=e.i(69741),l=e.i(16795),d=e.i(87718),p=e.i(95169),c=e.i(47587),R=e.i(66012),h=e.i(70101),_=e.i(26937),m=e.i(10372),f=e.i(93695);e.i(52474);var E=e.i(5232),v=e.i(89171),x=e.i(7218),g=e.i(24389);async function w(e,t){try{let r,n,a=String(e.headers.get("x-pipeline-secret")||""),o=String(process.env.PIPELINE_INTERNAL_SECRET||"");if(!(o&&a&&a===o)){let{userId:e}=await (0,x.auth)();if(!e)return v.NextResponse.json({ok:!1,error:"unauthorized"},{status:401})}let s=(r=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL||"",n=process.env.SUPABASE_SERVICE_ROLE_KEY||"",r&&n?(0,g.createClient)(r,n,{auth:{persistSession:!1}}):null);if(!s)return v.NextResponse.json({ok:!1,error:"supabase_not_configured",detail:"Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY"},{status:503});let i=t?.params&&"function"==typeof t.params.then?await t.params:t?.params,u=i?.id,l=i?.moduleIndex;if(!u)return v.NextResponse.json({ok:!1,error:"pipelineRunId required"},{status:400});let d=Number(l);if(!Number.isInteger(d)||d<0||d>1e3)return v.NextResponse.json({ok:!1,error:"invalid_module_index"},{status:400});let{data:p,error:c}=await s.from("module_runs").select("id, module_index, module_name, status, output_ref").eq("pipeline_run_id",u).eq("module_index",d).maybeSingle();if(c)return v.NextResponse.json({ok:!1,error:"module_query_failed",detail:c.message},{status:500});if(!p)return v.NextResponse.json({ok:!1,error:"not_found"},{status:404});if(!p.output_ref)return v.NextResponse.json({ok:!1,error:"output_not_ready",status:p.status},{status:409});let R=process.env.PIPELINE_OUTPUTS_BUCKET||"pipeline-outputs",{data:h,error:_}=await s.storage.from(R).download(p.output_ref);if(_||!h)return v.NextResponse.json({ok:!1,error:"output_download_failed",detail:String(_?.message??_??"unknown"),bucket:R,output_ref:p.output_ref},{status:500});let m=await h.text();try{let e=JSON.parse(m);return v.NextResponse.json({ok:!0,pipelineRunId:u,module:{index:p.module_index,name:p.module_name,status:p.status},output_ref:p.output_ref,output:e},{status:200})}catch{return v.NextResponse.json({ok:!0,pipelineRunId:u,module:{index:p.module_index,name:p.module_name,status:p.status},output_ref:p.output_ref,error:"output_not_json",raw:m},{status:200})}}catch(e){return v.NextResponse.json({ok:!1,error:"internal_error",detail:String(e?.message||e)},{status:500})}}e.s(["GET",()=>w],98284);var N=e.i(98284);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/pipeline/run/[id]/output/[moduleIndex]/route",pathname:"/api/v1/pipeline/run/[id]/output/[moduleIndex]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/pipeline/run/[id]/output/[moduleIndex]/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:S,workUnitAsyncStorage:A,serverHooks:P}=C;function y(){return(0,n.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:A})}async function T(e,t,n){C.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/v1/pipeline/run/[id]/output/[moduleIndex]/route";v=v.replace(/\/index$/,"")||"/";let x=await C.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:g,params:w,nextConfig:N,parsedUrl:S,isDraftMode:A,prerenderManifest:P,routerServerContext:y,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,resolvedPathname:U,clientReferenceManifest:k,serverActionsManifest:b}=x,O=(0,u.normalizeAppPath)(v),j=!!(P.dynamicRoutes[O]||P.routes[U]),q=async()=>((null==y?void 0:y.render404)?await y.render404(e,t,S,!1):t.end("This page could not be found"),null);if(j&&!A){let e=!!P.routes[U],t=P.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(N.experimental.adapterPath)return await q();throw new f.NoFallbackError}}let H=null;!j||C.isDev||A||(H="/index"===(H=U)?"/":H);let M=!0===C.isDev||!j,L=j&&!M;b&&k&&(0,s.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:k,serverActionsManifest:b,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:b})});let D=e.method||"GET",B=(0,o.getTracer)(),K=B.getActiveScopeSpan(),$={params:w,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!N.experimental.authInterrupts},cacheComponents:!!N.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:N.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>C.onRequestError(e,t,n,y)},sharedContext:{buildId:g}},F=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let s=async e=>C.handle(G,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${D} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${v}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),u=async a=>{var o,u;let l=async({previousCacheEntry:r})=>{try{if(!i&&T&&I&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(a);e.fetchMetrics=$.renderOpts.fetchMetrics;let u=$.renderOpts.pendingWaitUntil;u&&n.waitUntil&&(n.waitUntil(u),u=void 0);let l=$.renderOpts.collectedTags;if(!j)return await (0,R.sendResponse)(F,V,o,$.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,n=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:T})},y),t}},d=await C.handleResponse({req:e,nextConfig:N,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,responseGenerator:l,waitUntil:n.waitUntil,isMinimalMode:i});if(!j)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&j||p.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,_.getCacheControlHeader)(d.cacheControl)),await (0,R.sendResponse)(F,V,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};K?await u(K):await B.withPropagatedContext(e.headers,()=>B.trace(p.BaseServerSpan.handleRequest,{spanName:`${D} ${v}`,kind:o.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},u))}catch(t){if(t instanceof f.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:T})}),j)throw t;return await (0,R.sendResponse)(F,V,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>y,"routeModule",()=>C,"serverHooks",()=>P,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>A],36065)},29652,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__e438751d._.js"].map(t=>e.l(t))).then(()=>t(26445)))},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))}];

//# sourceMappingURL=node_modules_a3ec3232._.js.map