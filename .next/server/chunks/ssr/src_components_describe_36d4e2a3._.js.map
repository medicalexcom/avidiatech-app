{"version":3,"sources":["../../../../src/components/describe/DescribeForm.tsx","../../../../src/hooks/useDescribe.ts","../../../../src/components/describe/DescribeOutput.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { DescribeRequest, DescribeFormat } from \"./types\";\nimport useDescribe from \"@/hooks/useDescribe\";\n\n/**\n * Left-side form for AvidiaDescribe\n * - Validates required fields\n * - Converts specs text area to key:value object (optional)\n * - Calls the generate function from useDescribe\n */\n\nconst FORMATS: { label: string; value: DescribeFormat }[] = [\n  { label: \"Avidia Standard\", value: \"avidia_standard\" },\n  { label: \"Shopify Conversion\", value: \"shopify\" },\n  { label: \"General E-commerce\", value: \"ecommerce\" },\n  { label: \"Technical / Industrial\", value: \"technical\" },\n  { label: \"Lifestyle / Marketing\", value: \"lifestyle\" },\n];\n\nfunction parseSpecsText(text: string) {\n  const lines = text.split(/\\r?\\n/).map((l) => l.trim()).filter(Boolean);\n  const obj: Record<string, string> = {};\n  for (const line of lines) {\n    const [k, ...rest] = line.split(\":\");\n    if (!k) continue;\n    obj[k.trim()] = rest.join(\":\").trim();\n  }\n  return obj;\n}\n\nexport default function DescribeForm() {\n  const { generate, loading, error } = useDescribe();\n  const [name, setName] = useState(\"\");\n  const [shortDescription, setShortDescription] = useState(\"\");\n  const [brand, setBrand] = useState(\"\");\n  const [specsText, setSpecsText] = useState(\"\");\n  const [format, setFormat] = useState<DescribeFormat>(\"avidia_standard\");\n  const [lastPayloadId, setLastPayloadId] = useState<string | null>(null);\n\n  async function onSubmit(e?: React.FormEvent) {\n    if (e) e.preventDefault();\n    if (!name.trim() || !shortDescription.trim()) {\n      alert(\"Please provide product name and a short description.\");\n      return;\n    }\n\n    const specs = parseSpecsText(specsText);\n    const payload: DescribeRequest = {\n      name: name.trim(),\n      shortDescription: shortDescription.trim(),\n      brand: brand.trim() || undefined,\n      specs: Object.keys(specs).length ? specs : undefined,\n      format,\n    };\n\n    const res = await generate(payload);\n    if (res?.normalizedPayload?.id) setLastPayloadId(res.normalizedPayload.id);\n    // The DescribeOutput subscribes to the shared result via sessionStorage (see hook)\n  }\n\n  return (\n    <form onSubmit={onSubmit} className=\"space-y-4 bg-white dark:bg-slate-900 border rounded-lg p-4 shadow-sm\">\n      <div>\n        <label className=\"text-xs font-medium\">Product name</label>\n        <input value={name} onChange={(e) => setName(e.target.value)} className=\"mt-1 w-full border rounded px-3 py-2\" placeholder=\"e.g. Portable Folding Ramp\" />\n      </div>\n\n      <div>\n        <label className=\"text-xs font-medium\">Short manufacturer description</label>\n        <textarea value={shortDescription} onChange={(e) => setShortDescription(e.target.value)} rows={3} className=\"mt-1 w-full border rounded px-3 py-2\" placeholder=\"One or two lines describing the product\" />\n      </div>\n\n      <div>\n        <label className=\"text-xs font-medium\">Brand (optional)</label>\n        <input value={brand} onChange={(e) => setBrand(e.target.value)} className=\"mt-1 w-full border rounded px-3 py-2\" placeholder=\"Brand name\" />\n      </div>\n\n      <div>\n        <label className=\"text-xs font-medium\">Specs (optional — key: value per line)</label>\n        <textarea value={specsText} onChange={(e) => setSpecsText(e.target.value)} rows={4} className=\"mt-1 w-full border rounded px-3 py-2\" placeholder=\"Weight: 12 kg\\nWidth: 80 cm\" />\n        <p className=\"text-xs text-slate-500 mt-1\">Tip: use key:value per line to give the generator structured info.</p>\n      </div>\n\n      <div className=\"flex items-center gap-3\">\n        <div className=\"flex-1\">\n          <label className=\"text-xs font-medium\">Description format</label>\n          <select value={format} onChange={(e) => setFormat(e.target.value as DescribeFormat)} className=\"mt-1 w-full border rounded px-3 py-2\">\n            {FORMATS.map((f) => (\n              <option key={f.value} value={f.value}>\n                {f.label}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <div className=\"w-44\">\n          <button type=\"submit\" disabled={loading} className=\"mt-6 w-full px-3 py-2 bg-indigo-600 text-white rounded\">\n            {loading ? \"Generating…\" : \"Generate Description\"}\n          </button>\n        </div>\n      </div>\n\n      {error && <div className=\"text-sm text-red-600\">Error: {error.message || String(error)}</div>}\n      {lastPayloadId && <div className=\"text-xs text-slate-500\">Last generated id: {lastPayloadId}</div>}\n    </form>\n  );\n}\n","\"use client\";\n\nimport { useState } from \"react\";\nimport type { DescribeRequest, DescribeResponse } from \"@/components/describe/types\";\n\n/**\n * Client hook to call /api/v1/describe\n * - handles loading/error state\n * - stores last result in sessionStorage so DescribeOutput can consume it\n *\n * Update:\n * - On non-OK responses, include server-provided `detail` and `debug` fields in the Error message.\n *   This is important now that Describe can return structured debug context when the model\n *   output is invalid (e.g. JSON schema / parsing issues).\n */\n\nconst STORAGE_KEY = \"avidia:describe:lastResult\";\n\nfunction safeStringify(v: any) {\n  try {\n    if (typeof v === \"string\") return v;\n    return JSON.stringify(v);\n  } catch {\n    return String(v);\n  }\n}\n\nexport default function useDescribe() {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  async function generate(\n    payload: DescribeRequest\n  ): Promise<DescribeResponse | null> {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const res = await fetch(\"/api/v1/describe\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(payload),\n      });\n\n      // Some failures might not return JSON; handle defensively.\n      let json: any = null;\n      try {\n        json = await res.json();\n      } catch (e) {\n        json = null;\n      }\n\n      if (!res.ok) {\n        const parts: string[] = [];\n\n        // Primary error\n        parts.push(json?.error || `Status ${res.status}`);\n\n        // Optional detail/debug from server\n        if (json?.detail) parts.push(`detail=${safeStringify(json.detail)}`);\n        if (json?.debug) parts.push(`debug=${safeStringify(json.debug)}`);\n\n        // If server returned nothing JSON-like, include status text\n        if (!json && res.statusText) parts.push(res.statusText);\n\n        const err = new Error(parts.filter(Boolean).join(\" | \"));\n        setError(err);\n        setLoading(false);\n        return null;\n      }\n\n      // store in sessionStorage for the output panel\n      try {\n        sessionStorage.setItem(STORAGE_KEY, JSON.stringify(json));\n        // dispatch a storage event for other windows / listeners\n        window.dispatchEvent(new Event(\"storage\"));\n      } catch {\n        // ignore\n      }\n\n      setLoading(false);\n      return json as DescribeResponse;\n    } catch (err: any) {\n      setError(err);\n      setLoading(false);\n      return null;\n    }\n  }\n\n  return { generate, loading, error };\n}\n","// DescribeOutput.tsx\n\"use client\";\n\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport type { DescribeResponse } from \"./types\";\n\nconst STORAGE_KEY = \"avidia:describe:lastResult\";\n\nfunction useLastResult() {\n  const [result, setResult] = useState<DescribeResponse | null>(null);\n\n  useEffect(() => {\n    function load() {\n      try {\n        const raw = sessionStorage.getItem(STORAGE_KEY);\n        if (!raw) return setResult(null);\n        setResult(JSON.parse(raw));\n      } catch {\n        setResult(null);\n      }\n    }\n    load();\n    window.addEventListener(\"storage\", load);\n    return () => window.removeEventListener(\"storage\", load);\n  }, []);\n\n  return { result, setResult };\n}\n\nfunction stripScripts(html: string) {\n  if (!html) return \"\";\n  return html.replace(/<script[\\s\\S]*?>[\\s\\S]*?<\\/script>/gi, \"\");\n}\n\nfunction htmlDoc(innerHtml: string, token: string) {\n  // iframe doc that reports its *content* height to parent (postMessage).\n  // Parent sizes iframe so ONLY ONE vertical scroll exists: the outer content area.\n  const safe = stripScripts(innerHtml || \"\");\n\n  return `<!doctype html>\n<html>\n<head>\n<meta charset=\"utf-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<meta name=\"color-scheme\" content=\"light dark\" />\n<style>\n  html, body { margin:0; padding:0; }\n  /* Hide iframe-internal scrollbars (prevents \"2 scrolls\") */\n  html, body { overflow: hidden; }\n\n  body {\n    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;\n    padding: 16px;\n    padding-bottom: 40px; /* small safety so last line never kisses the edge */\n    line-height: 1.5;\n    background: transparent;\n    color: #0f172a;\n  }\n\n  /* Document-like layout (no visible frame) */\n  .page {\n    max-width: 920px;\n    margin: 0 auto;\n    padding-bottom: 16px; /* extra safety for margin-collapse / final elements */\n  }\n\n  h1,h2,h3 { margin: 0.9em 0 0.4em; }\n  p { margin: 0.55em 0; }\n  ul,ol { margin: 0.4em 0 0.8em 1.2em; padding: 0; }\n  li { margin: 0.25em 0; }\n  hr { border: 0; border-top: 1px solid rgba(226,232,240,0.9); margin: 1.25em 0; }\n  table { border-collapse: collapse; width: 100%; }\n  td, th { border: 1px solid rgba(226,232,240,0.9); padding: 8px; vertical-align: top; }\n  a { color: #0ea5e9; text-decoration: underline; }\n\n  @media (prefers-color-scheme: dark) {\n    body { color: #e2e8f0; }\n    hr { border-top-color: rgba(51,65,85,0.9); }\n    td, th { border-color: rgba(51,65,85,0.9); }\n    a { color: #38bdf8; }\n  }\n</style>\n</head>\n<body>\n  <div class=\"page\">\n    ${safe}\n  </div>\n\n<script>\n(function(){\n  var TOKEN = ${JSON.stringify(token)};\n\n  function computeContentHeight(){\n    // ✅ Measure only the actual content wrapper.\n    // Avoid documentElement/body scrollHeight unless page is missing,\n    // because those can \"floor\" to viewport height and cause blank space.\n    var page = document.querySelector('.page');\n    if (page) {\n      var h = 0;\n      try {\n        h = Math.max(h, page.scrollHeight || 0);\n        h = Math.max(h, page.offsetHeight || 0);\n        var rect = page.getBoundingClientRect ? page.getBoundingClientRect() : null;\n        if (rect && rect.height) h = Math.max(h, rect.height);\n      } catch(e) {}\n\n      // buffer for rounding + fonts + last margin\n      h = Math.ceil(h) + 24;\n      return Math.max(120, h);\n    }\n\n    // Fallback (only if .page missing)\n    var fb = 0;\n    try {\n      fb = Math.max(\n        document.body ? document.body.scrollHeight : 0,\n        document.body ? document.body.offsetHeight : 0\n      );\n    } catch(e) {}\n    fb = Math.ceil(fb) + 24;\n    return Math.max(120, fb);\n  }\n\n  function postHeight(){\n    try {\n      parent.postMessage(\n        { type: \"avidia:describe:iframeHeight\", token: TOKEN, height: computeContentHeight() },\n        \"*\"\n      );\n    } catch(e) {}\n  }\n\n  function burst(){\n    postHeight();\n    requestAnimationFrame(postHeight);\n    setTimeout(postHeight, 60);\n    setTimeout(postHeight, 180);\n    setTimeout(postHeight, 360);\n    setTimeout(postHeight, 700);\n  }\n\n  window.addEventListener(\"load\", function(){ burst(); });\n\n  // Observe DOM changes to keep height accurate\n  try {\n    var mo = new MutationObserver(function(){ postHeight(); });\n    mo.observe(document.body, { childList:true, subtree:true, characterData:true });\n  } catch(e) {}\n\n  // ResizeObserver catches font reflow / images etc.\n  try {\n    var ro = new ResizeObserver(function(){ postHeight(); });\n    ro.observe(document.body);\n    ro.observe(document.documentElement);\n  } catch(e) {}\n\n  window.addEventListener(\"resize\", postHeight);\n\n  // Kick once ASAP\n  burst();\n})();\n</script>\n</body>\n</html>`;\n}\n\nexport default function DescribeOutput() {\n  const { result } = useLastResult();\n\n  const [tab, setTab] = useState<\n    | \"overview\"\n    | \"hook\"\n    | \"main\"\n    | \"features\"\n    | \"specs\"\n    | \"links\"\n    | \"why\"\n    | \"manuals\"\n    | \"faqs\"\n    | \"seo\"\n    | \"json\"\n  >(\"overview\");\n\n  // ✅ HTML Viewer default\n  const [viewMode, setViewMode] = useState<\"styled\" | \"iframe\">(\"iframe\");\n\n  // iframe auto-height\n  const iframeTokenRef = useRef<string>(\n    `t_${Math.random().toString(36).slice(2)}_${Date.now()}`\n  );\n  const iframeRef = useRef<HTMLIFrameElement | null>(null);\n  const [iframeHeight, setIframeHeight] = useState<number>(520);\n\n  useEffect(() => {\n    setTab(\"overview\");\n  }, [result]);\n\n  const descriptionHtml = result?.descriptionHtml ?? \"\";\n  const sections = result?.sections ?? {};\n  const seo = result?.seo ?? {};\n\n  const tabHtml = useMemo(() => {\n    switch (tab) {\n      case \"overview\":\n        // IMPORTANT: overview tab should show the FULL HTML (not sections.overview)\n        return descriptionHtml || sections.overview || \"\";\n      case \"hook\":\n        return sections.hook || \"\";\n      case \"main\":\n        return sections.mainDescription || \"\";\n      case \"features\":\n        return sections.featuresBenefits || \"\";\n      case \"specs\":\n        return sections.specifications || \"\";\n      case \"links\":\n        return sections.internalLinks || \"\";\n      case \"why\":\n        return sections.whyChoose || \"\";\n      case \"manuals\":\n        return sections.manuals || sections.manualsSectionHtml || \"\";\n      case \"faqs\":\n        return sections.faqs || \"\";\n      default:\n        return \"\";\n    }\n  }, [tab, descriptionHtml, sections]);\n\n  // When HTML content changes, reset height small so it can shrink immediately,\n  // then let iframe report the correct content height.\n  useEffect(() => {\n    if (viewMode !== \"iframe\") return;\n    setIframeHeight(520);\n  }, [viewMode, tab, tabHtml]);\n\n  function copyCurrentHtml() {\n    const toCopy = tabHtml || \"\";\n    navigator.clipboard\n      .writeText(toCopy)\n      .then(() => alert(\"Tab HTML copied to clipboard\"));\n  }\n\n  function copyFullHtml() {\n    navigator.clipboard\n      .writeText(descriptionHtml || \"\")\n      .then(() => alert(\"Full HTML copied to clipboard\"));\n  }\n\n  function copySeoMeta() {\n    const h1 = seo.h1 ?? \"\";\n    const title = seo.pageTitle ?? seo.title ?? \"\";\n    const metaDescription = seo.metaDescription ?? \"\";\n    const keywords = Array.isArray(seo.keywords)\n      ? seo.keywords.join(\", \")\n      : seo.keywords ?? \"\";\n\n    const text = [\n      `H1: ${h1}`,\n      `Page Title: ${title}`,\n      `Meta Description: ${metaDescription}`,\n      `Search Keywords: ${keywords}`,\n    ].join(\"\\n\");\n\n    navigator.clipboard\n      .writeText(text)\n      .then(() => alert(\"SEO metadata copied to clipboard\"));\n  }\n\n  function downloadJSON() {\n    const data = result ?? {};\n    const blob = new Blob([JSON.stringify(data, null, 2)], {\n      type: \"application/json\",\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `describe-${Date.now()}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  function sendToImport() {\n    sessionStorage.setItem(\"avidia:import:payload\", JSON.stringify(result ?? {}));\n    window.location.href = \"/dashboard/import\";\n  }\n\n  const tabs = [\n    { id: \"overview\", label: \"Overview\" },\n    { id: \"features\", label: \"Features\" },\n    { id: \"specs\", label: \"Specs\" },\n    { id: \"links\", label: \"Links\" },\n    { id: \"manuals\", label: \"Manuals\" },\n    { id: \"seo\", label: \"SEO\" },\n    { id: \"json\", label: \"Raw JSON\" },\n  ] as const;\n\n  // Listen for iframe height reports (one vertical scroll = content area only)\n  useEffect(() => {\n    function onMsg(e: MessageEvent) {\n      const d: any = e.data;\n      if (!d || d.type !== \"avidia:describe:iframeHeight\") return;\n      if (d.token !== iframeTokenRef.current) return;\n\n      const next = Number(d.height);\n      if (!Number.isFinite(next) || next <= 0) return;\n\n      // ✅ Keep it tight (no blank), but still safe from clipping\n      const buffered = Math.max(120, Math.ceil(next));\n\n      setIframeHeight((prev) => {\n        // avoid jitter\n        if (Math.abs(prev - buffered) < 6) return prev;\n        return buffered;\n      });\n    }\n\n    window.addEventListener(\"message\", onMsg);\n    return () => window.removeEventListener(\"message\", onMsg);\n  }, []);\n\n  if (!result) {\n    return (\n      <div className=\"bg-white dark:bg-slate-900 border rounded-lg p-6 shadow-sm\">\n        <div className=\"text-sm text-slate-500\">\n          No generated description yet. Fill the form and click Generate.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className=\"bg-white dark:bg-slate-900 border rounded-lg shadow-sm flex flex-col overflow-hidden\"\n      style={{ height: \"clamp(600px, 80vh, 980px)\" }}\n    >\n      {/* ✅ BAND (never scrolls) */}\n      <div className=\"shrink-0 p-4 border-b bg-white/90 dark:bg-slate-900/70 backdrop-blur\">\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n          <div className=\"flex items-center gap-3 min-w-0\">\n            <h2 className=\"text-lg font-semibold\">Preview</h2>\n            <div className=\"text-xs text-slate-500 truncate\">\n              Source: {result?.normalizedPayload?.source ?? \"Describe\"}\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <button onClick={copyCurrentHtml} className=\"px-3 py-1 border rounded text-sm\">\n              Copy Tab HTML\n            </button>\n            <button onClick={copyFullHtml} className=\"px-3 py-1 border rounded text-sm\">\n              Copy Full HTML\n            </button>\n            <button onClick={copySeoMeta} className=\"px-3 py-1 border rounded text-sm\">\n              Copy SEO Meta\n            </button>\n            <button onClick={downloadJSON} className=\"px-3 py-1 border rounded text-sm\">\n              Download JSON\n            </button>\n            <button\n              onClick={sendToImport}\n              className=\"px-3 py-1 bg-indigo-600 text-white rounded text-sm\"\n            >\n              Send to Import\n            </button>\n          </div>\n        </div>\n\n        {/* Tabs + View (still in the non-scrolling band) */}\n        <div className=\"mt-3 flex flex-wrap gap-3 items-center border-t pt-3\">\n          <div className=\"flex flex-wrap gap-3\">\n            {tabs.map((t) => (\n              <button\n                key={t.id}\n                onClick={() => setTab(t.id as any)}\n                className={`text-sm ${\n                  tab === t.id\n                    ? \"font-semibold text-slate-900 dark:text-slate-50\"\n                    : \"text-slate-500\"\n                }`}\n              >\n                {t.label}\n              </button>\n            ))}\n          </div>\n\n          <div className=\"ml-auto flex items-center gap-2\">\n            <span className=\"text-xs text-slate-500\">View:</span>\n            <button\n              onClick={() => setViewMode(\"styled\")}\n              className={`text-xs px-2 py-1 border rounded ${\n                viewMode === \"styled\" ? \"font-semibold\" : \"\"\n              }`}\n            >\n              Styled\n            </button>\n            <button\n              onClick={() => setViewMode(\"iframe\")}\n              className={`text-xs px-2 py-1 border rounded ${\n                viewMode === \"iframe\" ? \"font-semibold\" : \"\"\n              }`}\n            >\n              HTML Viewer\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* ✅ CONTENT (the ONLY vertical scroll) */}\n      <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">\n        {tab === \"seo\" ? (\n          <div className=\"space-y-3 text-sm\">\n            <div>\n              <strong>H1:</strong>{\" \"}\n              {seo.h1 || <em className=\"text-slate-500\">Not available</em>}\n            </div>\n            <div>\n              <strong>Page Title:</strong>{\" \"}\n              {(seo.pageTitle ?? seo.title) || (\n                <em className=\"text-slate-500\">Not available</em>\n              )}\n            </div>\n            <div>\n              <strong>Meta Description:</strong>\n              <div className=\"mt-1 text-slate-600 dark:text-slate-300 whitespace-pre-wrap\">\n                {seo.metaDescription || (\n                  <em className=\"text-slate-500\">Not available</em>\n                )}\n              </div>\n            </div>\n            <div>\n              <strong>Search Keywords:</strong>\n              <div className=\"mt-1 text-slate-600 dark:text-slate-300\">\n                {Array.isArray(seo.keywords)\n                  ? seo.keywords.join(\", \")\n                  : seo.keywords ?? <em className=\"text-slate-500\">Not available</em>}\n              </div>\n            </div>\n          </div>\n        ) : tab === \"json\" ? (\n          <pre className=\"text-xs bg-slate-50 dark:bg-slate-800 p-3 rounded overflow-x-auto\">\n            {JSON.stringify(result, null, 2)}\n          </pre>\n        ) : viewMode === \"iframe\" ? (\n          <iframe\n            ref={iframeRef}\n            title=\"HTML Preview\"\n            className=\"w-full block border-0 shadow-none rounded-none bg-transparent\"\n            style={{ height: iframeHeight }}\n            sandbox=\"allow-scripts\"\n            scrolling=\"no\"\n            srcDoc={htmlDoc(tabHtml, iframeTokenRef.current)}\n          />\n        ) : (\n          <div\n            className=\"prose prose-slate max-w-none dark:prose-invert prose-h2:mt-5 prose-h3:mt-4 prose-li:my-0.5\"\n            dangerouslySetInnerHTML={{\n              __html: tabHtml || \"<em>No content available for this tab yet.</em>\",\n            }}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}