{"version":3,"sources":["../../../../src/components/imports/ImportUploader.tsx","../../../../src/components/imports/MappingModal.tsx","../../../../src/app/imports/new/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport MappingModal from \"@/components/imports/MappingModal\";\nimport { useToast } from \"@/components/ui/toast\";\n\n/**\n * ImportUploader\n *\n * - Uploads files to the server endpoint /api/upload-to-supabase (server will store to Supabase storage\n *   with the service role and create a product_ingestions row when possible).\n * - Sends optional mapping & platform metadata so the ingestion row can be updated/created with them.\n * - If the upload endpoint returns a jobId, the uploader calls onCreated(jobId).\n * - If the upload endpoint only returns a file path, the uploader POSTs to /api/imports to create the import job.\n *\n * Drop this file in place of your existing ImportUploader. It is defensive and reports helpful errors.\n */\n\ntype Props = {\n  bucket?: string; // informational - server controls actual bucket\n  maxRows?: number;\n  maxCols?: number;\n  onCreated?: (jobId: string) => void;\n  className?: string;\n  platform?: string | null;\n};\n\nexport default function ImportUploader({\n  bucket = \"imports\",\n  maxRows = 5000,\n  maxCols = 50,\n  onCreated,\n  className,\n  platform = null,\n}: Props) {\n  const toast = useToast();\n\n  const [file, setFile] = useState<File | null>(null);\n  const [headers, setHeaders] = useState<string[]>([]);\n  const [previewRows, setPreviewRows] = useState<any[]>([]);\n  const [loadingPreview, setLoadingPreview] = useState(false);\n  const [previewError, setPreviewError] = useState<string | null>(null);\n  const [uploading, setUploading] = useState(false);\n\n  const [mappingOpen, setMappingOpen] = useState(false);\n  const [mapping, setMapping] = useState<Record<string, string> | null>(null);\n\n  useEffect(() => {\n    // Reset preview error when file changes\n    if (!file) {\n      setHeaders([]);\n      setPreviewRows([]);\n      setPreviewError(null);\n    }\n  }, [file]);\n\n  async function readPreview(f: File) {\n    setPreviewError(null);\n    setLoadingPreview(true);\n    setHeaders([]);\n    setPreviewRows([]);\n    setMapping(null);\n\n    try {\n      const ext = f.name.split(\".\").pop()?.toLowerCase();\n      if (ext === \"csv\" || ext === \"txt\") {\n        const PapaMod = await import(\"papaparse\");\n        const Papa = (PapaMod && (PapaMod.default ?? PapaMod)) as any;\n        await new Promise<void>((resolve, reject) => {\n          Papa.parse(f, {\n            header: true,\n            preview: 50,\n            skipEmptyLines: true,\n            complete: (res: any) => {\n              setHeaders(res.meta?.fields ?? []);\n              setPreviewRows(res.data ?? []);\n              resolve();\n            },\n            error: (err: any) => reject(err),\n          });\n        });\n      } else if (ext === \"xlsx\" || ext === \"xls\") {\n        const XLSX = (await import(\"xlsx\")) as any;\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          try {\n            const ab = e.target?.result as ArrayBuffer;\n            const wb = XLSX.read(ab, { type: \"array\" });\n            const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { defval: \"\" }) as any[];\n            setHeaders(rows.length ? Object.keys(rows[0]) : []);\n            setPreviewRows(rows.slice(0, 50));\n          } catch (err: any) {\n            setPreviewError(err?.message ?? String(err));\n          } finally {\n            setLoadingPreview(false);\n          }\n        };\n        reader.onerror = () => {\n          setPreviewError(\"Failed to read file for preview\");\n          setLoadingPreview(false);\n        };\n        reader.readAsArrayBuffer(f);\n        return;\n      } else {\n        // Not a tabular format we can preview — bail gracefully\n        setPreviewError(\"Preview unavailable for this file type\");\n      }\n    } catch (err: any) {\n      setPreviewError(err?.message ?? String(err));\n    } finally {\n      setLoadingPreview(false);\n    }\n  }\n\n  async function handleUpload() {\n    setPreviewError(null);\n    if (!file) {\n      setPreviewError(\"No file selected\");\n      return;\n    }\n\n    if (headers.length > maxCols) {\n      setPreviewError(`Too many columns (max ${maxCols}). Please reduce columns.`);\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const fd = new FormData();\n      fd.append(\"file\", file, file.name);\n\n      // Include mapping & platform as optional fields - server may use them to populate the ingestion row\n      if (mapping) {\n        try {\n          fd.append(\"mapping\", JSON.stringify(mapping));\n        } catch (e) {\n          // ignore mapping serialization errors\n        }\n      }\n      if (platform) fd.append(\"platform\", String(platform));\n\n      const uploadResp = await fetch(\"/api/upload-to-supabase\", {\n        method: \"POST\",\n        body: fd,\n      });\n\n      const uploadJson = await uploadResp.json().catch(() => null);\n\n      if (!uploadResp.ok || !uploadJson?.ok) {\n        const msg = uploadJson?.error ?? `Upload failed: ${uploadResp.status}`;\n        setPreviewError(msg);\n        toast?.error?.(msg);\n        return;\n      }\n\n      // If server route created the ingestion row and returned jobId, use it\n      const jobIdFromUpload: string | null = uploadJson?.jobId ?? uploadJson?.data?.id ?? uploadJson?.inserted?.id ?? null;\n\n      // The server should return canonical file_path (e.g. \"imports/12345-name.xlsx\") or relative path in uploadJson.data.path\n      const returnedPath: string | null = uploadJson?.file_path ?? uploadJson?.data?.path ?? uploadJson?.data?.raw?.fullPath ?? uploadJson?.data?.raw?.path ?? null;\n\n      // If jobId returned, optionally patch mapping to the ingestion record (best-effort) and finish\n      if (jobIdFromUpload) {\n        // Best-effort: update mapping via PATCH to PostgREST /api/v1/ingest/{id} if mapping exists\n        if (mapping) {\n          try {\n            await fetch(`/api/v1/ingest/${encodeURIComponent(jobIdFromUpload)}`, {\n              method: \"PATCH\",\n              headers: { \"content-type\": \"application/json\" },\n              body: JSON.stringify({ mapping }),\n            });\n          } catch {\n            // ignore patch failures — mapping is best-effort\n          }\n        }\n\n        toast?.success?.(`Upload succeeded — job ${jobIdFromUpload}`);\n        onCreated?.(jobIdFromUpload);\n        return;\n      }\n\n      // If no jobId returned but we have returnedPath, call /api/imports to create an import job (old behavior)\n      const effectivePath = returnedPath ? String(returnedPath) : null;\n      if (!jobIdFromUpload && effectivePath) {\n        // Normalize file_path to include bucket if server returned relative path\n        const filePath =\n          effectivePath.startsWith(`${bucket}/`) || effectivePath.startsWith(\"/\") ? effectivePath.replace(/^\\/+/, \"\") : `${bucket}/${effectivePath}`;\n\n        // Create import job by calling /api/imports (server route will create DB row and return jobId)\n        try {\n          const createResp = await fetch(\"/api/imports\", {\n            method: \"POST\",\n            headers: { \"content-type\": \"application/json\" },\n            body: JSON.stringify({\n              file_path: filePath,\n              file_name: file.name,\n              file_format: file.name.split(\".\").pop()?.toLowerCase() ?? null,\n              mapping: mapping ?? null,\n              platform: platform ?? null,\n            }),\n          });\n          const createJson = await createResp.json().catch(() => null);\n          if (!createResp.ok || !createJson?.ok) {\n            const msg = createJson?.error ?? `Create import job failed: ${createResp.status}`;\n            setPreviewError(msg);\n            toast?.error?.(msg);\n            return;\n          }\n          const jobId = createJson.jobId ?? createJson.id ?? createJson.data?.id ?? null;\n          if (jobId) {\n            toast?.success?.(`Import job created: ${jobId}`);\n            onCreated?.(jobId);\n            return;\n          } else {\n            // create succeeded but no job id returned — fallback to telling user upload succeeded\n            toast?.info?.(\"Upload succeeded; import job created (no id returned).\");\n            onCreated?.(\"\");\n            return;\n          }\n        } catch (err: any) {\n          const msg = String(err?.message ?? err);\n          setPreviewError(msg);\n          toast?.error?.(msg);\n          return;\n        }\n      }\n\n      // If we reach here, upload succeeded but we couldn't determine job id or path\n      toast?.info?.(\"Upload succeeded but no job id/path returned from server. Check server logs.\");\n      onCreated?.(\"\");\n    } catch (err: any) {\n      const msg = String(err?.message ?? err);\n      setPreviewError(msg);\n      toast?.error?.(msg);\n    } finally {\n      setUploading(false);\n    }\n  }\n\n  return (\n    <div className={className}>\n      <div>\n        <input\n          type=\"file\"\n          accept=\"*/*\"\n          onChange={(e) => {\n            const f = e.target.files?.[0] ?? null;\n            setFile(f);\n            if (f) readPreview(f);\n          }}\n        />\n      </div>\n\n      {loadingPreview && <div className=\"mt-3 text-sm\">Loading preview…</div>}\n      {previewError && <div className=\"mt-3 text-sm text-rose-700\">{previewError}</div>}\n\n      {headers.length > 0 && (\n        <div className=\"mt-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"text-xs text-slate-500\">Preview headers</div>\n            <div>\n              <button onClick={() => setMappingOpen(true)} className=\"text-xs px-2 py-1 border rounded mr-2\">\n                Open mapping\n              </button>\n              <button\n                onClick={() => {\n                  setHeaders([]);\n                  setPreviewRows([]);\n                  setFile(null);\n                  setMapping(null);\n                }}\n                className=\"text-xs px-2 py-1 border rounded\"\n              >\n                Clear\n              </button>\n            </div>\n          </div>\n\n          <pre className=\"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded\">{JSON.stringify(headers)}</pre>\n\n          <div className=\"mt-3 text-xs text-slate-500\">Preview rows</div>\n          <pre className=\"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded\">{JSON.stringify(previewRows.slice(0, 5), null, 2)}</pre>\n\n          <div className=\"mt-4 flex gap-2\">\n            <button\n              onClick={handleUpload}\n              disabled={uploading}\n              className=\"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60\"\n            >\n              {uploading ? \"Uploading…\" : \"Upload & Create Import\"}\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* If headers not available (non-tabular file), still allow upload */}\n      {!headers.length && !loadingPreview && (\n        <div className=\"mt-3\">\n          <div className=\"text-xs text-slate-500 mb-2\">No preview available for this file type. You can still upload.</div>\n          <div className=\"flex gap-2\">\n            <button\n              onClick={handleUpload}\n              disabled={uploading}\n              className=\"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60\"\n            >\n              {uploading ? \"Uploading…\" : \"Upload & Create Import\"}\n            </button>\n            <button\n              onClick={() => {\n                setFile(null);\n                setPreviewError(null);\n              }}\n              className=\"inline-flex items-center rounded px-3 py-2 border text-sm\"\n            >\n              Clear\n            </button>\n          </div>\n        </div>\n      )}\n\n      <MappingModal\n        open={mappingOpen}\n        headers={headers}\n        initialMapping={mapping ?? {}}\n        onSave={(m) => {\n          setMapping(m);\n          setMappingOpen(false);\n        }}\n        onClose={() => setMappingOpen(false)}\n      />\n    </div>\n  );\n}\n","\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\n\ntype MappingModalProps = {\n  open: boolean;\n  headers: string[];\n  initialMapping?: Record<string, string>;\n  onSave: (mapping: Record<string, string>) => void;\n  onClose: () => void;\n};\n\nconst TARGET_FIELDS = [\n  \"\",\n  \"sku\",\n  \"title\",\n  \"description\",\n  \"price\",\n  \"inventory\",\n  \"weight\",\n  \"brand\",\n  \"image\",\n  \"category\",\n];\n\nexport default function MappingModal({ open, headers, initialMapping = {}, onSave, onClose }: MappingModalProps) {\n  const [mapping, setMapping] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    // initialize auto-mapping heuristics\n    const m: Record<string, string> = {};\n    for (const h of headers) {\n      if (initialMapping[h]) {\n        m[h] = initialMapping[h];\n        continue;\n      }\n      const k = h.toLowerCase();\n      if (k.includes(\"sku\")) m[h] = \"sku\";\n      else if (k.includes(\"title\") || k.includes(\"name\")) m[h] = \"title\";\n      else if (k.includes(\"desc\")) m[h] = \"description\";\n      else if (k.includes(\"price\")) m[h] = \"price\";\n      else if (k.includes(\"qty\") || k.includes(\"inventory\") || k.includes(\"stock\")) m[h] = \"inventory\";\n      else m[h] = \"\";\n    }\n    setMapping(m);\n  }, [headers, initialMapping]);\n\n  function update(h: string, v: string) {\n    setMapping((s) => ({ ...s, [h]: v }));\n  }\n\n  if (!open) return null;\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4\">\n      <div className=\"w-full max-w-3xl rounded-lg bg-white p-4\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold\">Map source columns to product fields</h3>\n          <button onClick={onClose} className=\"px-2 py-1 text-sm\">Close</button>\n        </div>\n\n        <div className=\"mt-3 max-h-[60vh] overflow-auto\">\n          <table className=\"w-full table-auto\">\n            <thead>\n              <tr>\n                <th className=\"text-left text-xs text-slate-500 pb-2\">Source column</th>\n                <th className=\"text-left text-xs text-slate-500 pb-2\">Map to field</th>\n              </tr>\n            </thead>\n            <tbody>\n              {headers.map((h) => (\n                <tr key={h}>\n                  <td className=\"py-2 text-sm\">{h}</td>\n                  <td className=\"py-2\">\n                    <select value={mapping[h] ?? \"\"} onChange={(e) => update(h, e.target.value)} className=\"rounded border px-2 py-1 text-sm\">\n                      {TARGET_FIELDS.map((f) => (\n                        <option key={f} value={f}>{f === \"\" ? \"-- ignore --\" : f}</option>\n                      ))}\n                    </select>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        <div className=\"mt-4 flex items-center justify-end gap-2\">\n          <button onClick={() => { onSave(mapping); }} className=\"px-3 py-2 rounded bg-emerald-500 text-white\">Save mapping</button>\n          <button onClick={onClose} className=\"px-3 py-2 rounded border\">Cancel</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","\"use client\";\n\nimport React from \"react\";\nimport ImportUploader from \"@/components/imports/ImportUploader\";\n\n/**\n * /imports/new\n * Minimal page that renders only the canonical ImportUploader component so users can upload CSV/XLSX\n * and create an import job.\n */\n\nexport default function NewImportPage() {\n  return (\n    <main className=\"flex min-h-screen items-center justify-center bg-gray-50 px-4 py-12\">\n      <div className=\"w-full max-w-xl\">\n        <div className=\"rounded-lg bg-white p-6 shadow-sm\">\n          <h1 className=\"text-xl font-semibold mb-3\">Create import</h1>\n          <p className=\"text-sm text-slate-500 mb-4\">\n            Upload a CSV or Excel file. Max rows: 5000, Max columns: 50.\n          </p>\n\n          <ImportUploader\n            bucket=\"imports\"\n            onCreated={(jobId) => {\n              // optional: navigate to job page or show toast\n              if (jobId) {\n                // prefer to use the ingestion/job id as the canonical ingestion id\n                window.location.href = `/imports/${jobId}`;\n              } else {\n                // fallback: reload\n                window.location.reload();\n              }\n            }}\n          />\n        </div>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}