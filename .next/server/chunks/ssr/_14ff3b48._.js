module.exports=[70157,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(79858);let e=["","sku","title","description","price","inventory","weight","brand","image","category"];function f({open:a,headers:d,initialMapping:f={},onSave:g,onClose:h}){let[i,j]=(0,c.useState)({});return((0,c.useEffect)(()=>{let a={};for(let b of d){if(f[b]){a[b]=f[b];continue}let c=b.toLowerCase();c.includes("sku")?a[b]="sku":c.includes("title")||c.includes("name")?a[b]="title":c.includes("desc")?a[b]="description":c.includes("price")?a[b]="price":c.includes("qty")||c.includes("inventory")||c.includes("stock")?a[b]="inventory":a[b]=""}j(a)},[d,f]),a)?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,b.jsxs)("div",{className:"w-full max-w-3xl rounded-lg bg-white p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Map source columns to product fields"}),(0,b.jsx)("button",{onClick:h,className:"px-2 py-1 text-sm",children:"Close"})]}),(0,b.jsx)("div",{className:"mt-3 max-h-[60vh] overflow-auto",children:(0,b.jsxs)("table",{className:"w-full table-auto",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Source column"}),(0,b.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Map to field"})]})}),(0,b.jsx)("tbody",{children:d.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"py-2 text-sm",children:a}),(0,b.jsx)("td",{className:"py-2",children:(0,b.jsx)("select",{value:i[a]??"",onChange:b=>{var c;return c=b.target.value,void j(b=>({...b,[a]:c}))},className:"rounded border px-2 py-1 text-sm",children:e.map(a=>(0,b.jsx)("option",{value:a,children:""===a?"-- ignore --":a},a))})})]},a))})]})}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,b.jsx)("button",{onClick:()=>{g(i)},className:"px-3 py-2 rounded bg-emerald-500 text-white",children:"Save mapping"}),(0,b.jsx)("button",{onClick:h,className:"px-3 py-2 rounded border",children:"Cancel"})]})]})}):null}let g=process.env.NEXT_PUBLIC_SUPABASE_URL||"",h=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",i=g&&h?(0,d.createClient)(g,h):null;function j({bucket:d="imports",maxRows:e=5e3,maxCols:g=50,onCreated:h,className:j,platform:k}){let[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null);async function B(b){u(null),s(!0),o([]),q([]),A(null);try{let c=b.name.split(".").pop()?.toLowerCase();if("csv"===c||"txt"===c){let c=await a.A(86674),d=c&&(c.default??c);await new Promise((a,c)=>{d.parse(b,{header:!0,preview:50,skipEmptyLines:!0,complete:b=>{o(b.meta?.fields??[]),q(b.data??[]),a()},error:a=>c(a)})})}else{let c=await a.A(98516),d=new FileReader;d.onload=a=>{try{let b=a.target?.result,d=c.read(b,{type:"array"}),e=c.utils.sheet_to_json(d.Sheets[d.SheetNames[0]],{defval:""});o(e.length?Object.keys(e[0]):[]),q(e.slice(0,50))}catch(a){u(a?.message??String(a))}finally{s(!1)}},d.onerror=()=>{u("Failed to read file for preview"),s(!1)},d.readAsArrayBuffer(b);return}}catch(a){u(a?.message??String(a))}finally{s(!1)}}async function C(){if(u(null),!l)return void u("No file selected");if(!i)return void u("Supabase client not configured (missing env vars)");if(n.length>g)return void u(`Too many columns (max ${g}). Please reduce columns.`);w(!0);try{let a=`${Date.now()}-${l.name}`,{error:b}=await i.storage.from(d).upload(a,l,{upsert:!1});if(b)return void u(`Upload failed: ${b.message}`);let c={file_path:`${d}/${a}`,file_name:l.name,file_format:l.name.split(".").pop()?.toLowerCase(),mapping:z??null,platform:k??null},e=await fetch("/api/imports",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(c)}),f=await e.json().catch(()=>null);if(!e.ok||!f?.ok)return void u(f?.error??`Create import job failed: ${e.status}`);let g=f.jobId??f.id??null;h?.(g??"")}catch(a){u(String(a?.message||a))}finally{w(!1)}}return(0,b.jsxs)("div",{className:j,children:[(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"file",accept:".csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:a=>{let b=a.target.files?.[0]??null;m(b),b&&B(b)}})}),r&&(0,b.jsx)("div",{className:"mt-3 text-sm",children:"Loading preview…"}),t&&(0,b.jsx)("div",{className:"mt-3 text-sm text-rose-700",children:t}),n.length>0&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Preview headers"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("button",{onClick:()=>y(!0),className:"text-xs px-2 py-1 border rounded mr-2",children:"Open mapping"}),(0,b.jsx)("button",{onClick:()=>{o([]),q([]),m(null),A(null)},className:"text-xs px-2 py-1 border rounded",children:"Clear"})]})]}),(0,b.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(n)}),(0,b.jsx)("div",{className:"mt-3 text-xs text-slate-500",children:"Preview rows"}),(0,b.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(p.slice(0,5),null,2)}),(0,b.jsx)("div",{className:"mt-4 flex gap-2",children:(0,b.jsx)("button",{onClick:C,disabled:v,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:v?"Uploading…":"Upload & Create Import"})})]}),(0,b.jsx)(f,{open:x,headers:n,initialMapping:z??{},onSave:a=>{A(a),y(!1)},onClose:()=>y(!1)})]})}a.s(["default",()=>j],70157)},98516,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_xlsx_xlsx_mjs_959e58f3._.js"].map(b=>a.l(b))).then(()=>b(75750)))},86674,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_papaparse_papaparse_82baccab.js"].map(b=>a.l(b))).then(()=>b(85231)))}];

//# sourceMappingURL=_14ff3b48._.js.map