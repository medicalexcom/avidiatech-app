module.exports=[98899,a=>{"use strict";var b=a.i(87924),c=a.i(72131);function d(){let[a,d]=(0,c.useState)(null),[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)("any"),[k,l]=(0,c.useState)("any"),[m,n]=(0,c.useState)("any"),[o,p]=(0,c.useState)("last_check_at"),[q,r]=(0,c.useState)("desc"),[s,t]=(0,c.useState)(1);async function u(){f(!0);try{let a=await fetch("/api/monitor/watches"),b=await a.json().catch(()=>null);a.ok&&b?.ok?d(b.watches??[]):d([])}finally{f(!1)}}(0,c.useEffect)(()=>{u()},[]);let v=(0,c.useMemo)(()=>{let b=a??[],c=String(g||"").trim().toLowerCase(),d=b.filter(a=>("any"===i||(a.last_status??"unknown")===i)&&("any"===k||("yes"!==k||!!a.auto_watch)&&("no"!==k||!a.auto_watch))&&("any"===m||("yes"!==m||!!a.product_id)&&("no"!==m||!a.product_id))&&(!c||!!String(a.source_url??"").toLowerCase().includes(c)));return d.sort((a,b)=>{let c=a[o],d=b[o];return("last_check_at"===o||"created_at"===o?(c=a[o]?new Date(a[o]).getTime():0,d=b[o]?new Date(b[o]).getTime():0):(c=Number(c??0),d=Number(d??0)),c===d)?0:"asc"===q?c<d?-1:1:c>d?-1:1}),d},[a,g,i,k,m,o,q]),w=v.length,x=Math.max(1,Math.ceil(w/50)),y=v.slice((s-1)*50,50*s),z=(0,c.useMemo)(()=>{let b=a??[],c=b.length;if(0===c)return{total:0,failing:0,avgFrequencyDays:"—",productLinkedPct:"—",autoWatchPct:"—"};let d=b.filter(a=>a.last_status&&"ok"!==String(a.last_status)||Number(a.retry_count??0)>0).length,e=Math.round(b.reduce((a,b)=>a+Number(b.frequency_seconds??86400),0)/c/86400*10)/10,f=Math.round(b.filter(a=>!!a.product_id).length/c*100),g=Math.round(b.filter(a=>!!a.auto_watch).length/c*100);return{total:c,failing:d,avgFrequencyDays:e,productLinkedPct:f,autoWatchPct:g}},[a]);async function A(a){try{let b=await fetch("/api/monitor/check",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({watchId:a})});await b.json().catch(()=>null),u()}catch(a){console.warn(a)}}async function B(a,b){await fetch(`/api/monitor/watches/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({frequency_seconds:Math.max(1,Math.round(24*b*3600))})}),u()}async function C(a,b){let c={muted_until:b?null:new Date(Date.now()+864e5).toISOString()};await fetch(`/api/monitor/watches/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(c)}),u()}async function D(a){confirm("Delete this watch? This cannot be undone.")&&(await fetch(`/api/monitor/watches/${encodeURIComponent(a)}`,{method:"DELETE"}),u())}return(0,b.jsx)("main",{className:"p-6",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,b.jsxs)("header",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"All Watches"}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Full list of watches with sorting, filtering, and bulk-friendly controls."})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("a",{href:"/dashboard",className:"px-3 py-2 rounded border",children:"Back"}),(0,b.jsx)("a",{href:"#top",className:"px-3 py-2 rounded bg-amber-500 text-white",children:"Open Monitor"})]})]}),(0,b.jsxs)("section",{className:"grid grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Total watches"}),(0,b.jsx)("div",{className:"mt-2 text-2xl font-semibold",children:z.total})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Failing watches"}),(0,b.jsx)("div",{className:"mt-2 text-2xl font-semibold",children:z.failing})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Avg frequency (days)"}),(0,b.jsx)("div",{className:"mt-2 text-2xl font-semibold",children:z.avgFrequencyDays})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Linked to product / Auto-watch"}),(0,b.jsxs)("div",{className:"mt-2 text-lg font-semibold",children:[z.productLinkedPct,"% · ",z.autoWatchPct,"%"]})]})]}),(0,b.jsx)("section",{className:"rounded-lg border bg-white p-4",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("input",{value:g,onChange:a=>h(a.target.value),placeholder:"Search URL...",className:"border rounded px-3 py-2 w-80"}),(0,b.jsxs)("select",{value:i,onChange:a=>j(a.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,b.jsx)("option",{value:"any",children:"All statuses"}),(0,b.jsx)("option",{value:"ok",children:"ok"}),(0,b.jsx)("option",{value:"changed",children:"changed"}),(0,b.jsx)("option",{value:"scrape_failed",children:"scrape_failed"}),(0,b.jsx)("option",{value:"error",children:"error"})]}),(0,b.jsxs)("select",{value:k,onChange:a=>l(a.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,b.jsx)("option",{value:"any",children:"Auto watch (any)"}),(0,b.jsx)("option",{value:"yes",children:"Auto only"}),(0,b.jsx)("option",{value:"no",children:"Manual only"})]}),(0,b.jsxs)("select",{value:m,onChange:a=>n(a.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,b.jsx)("option",{value:"any",children:"Product link (any)"}),(0,b.jsx)("option",{value:"yes",children:"Linked"}),(0,b.jsx)("option",{value:"no",children:"Unlinked"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("label",{className:"text-xs text-slate-500",children:"Sort"}),(0,b.jsxs)("select",{value:o,onChange:a=>p(a.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,b.jsx)("option",{value:"last_check_at",children:"Last check"}),(0,b.jsx)("option",{value:"frequency_seconds",children:"Frequency (sec)"}),(0,b.jsx)("option",{value:"retry_count",children:"Retry count"}),(0,b.jsx)("option",{value:"created_at",children:"Created"})]}),(0,b.jsxs)("select",{value:q,onChange:a=>r(a.target.value),className:"rounded border px-2 py-1 text-sm",children:[(0,b.jsx)("option",{value:"desc",children:"desc"}),(0,b.jsx)("option",{value:"asc",children:"asc"})]}),(0,b.jsx)("button",{onClick:()=>{t(1),u()},className:"px-3 py-1 rounded border text-sm",children:"Reload"})]})]})}),(0,b.jsxs)("section",{className:"rounded-lg border bg-white p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Watches"}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:["Showing ",Math.min(50,w)," of ",w," (page ",s,"/",x,")"]})]}),(0,b.jsx)("div",{className:"space-y-3",children:e&&!a?(0,b.jsx)("div",{children:"Loading…"}):0===y.length?(0,b.jsx)("div",{className:"text-sm text-slate-500",children:"No watches"}):y.map(a=>(0,b.jsxs)("div",{className:"p-3 border rounded-lg flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"font-medium truncate",children:a.source_url}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:a.product_id?"linked":"unlinked"})]}),(0,b.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["Last: ",a.last_check_at?new Date(a.last_check_at).toLocaleString():"never"," · Status: ",(0,b.jsx)("span",{className:"font-medium",children:a.last_status??"unknown"})," · Retries: ",a.retry_count??0]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>A(a.id),className:"px-2 py-1 text-xs border rounded",children:"Check"}),(0,b.jsx)("button",{onClick:()=>C(a.id,a.muted_until),className:"px-2 py-1 text-xs border rounded",children:a.muted_until?"Unmute":"Mute"}),(0,b.jsx)("button",{onClick:()=>D(a.id),className:"px-2 py-1 text-xs border rounded text-red-600",children:"Delete"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("label",{className:"text-xs text-slate-500",children:"Freq days"}),(0,b.jsx)("input",{type:"number",defaultValue:Math.max(1,Math.round((a.frequency_seconds??86400)/86400)),onBlur:b=>B(a.id,Number(b.currentTarget.value)),className:"w-20 rounded border px-2 py-1 text-sm"})]})]})})]},a.id))}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:["Page ",s," of ",x]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>t(1),disabled:1===s,className:"px-3 py-1 border rounded text-sm",children:"First"}),(0,b.jsx)("button",{onClick:()=>t(a=>Math.max(1,a-1)),disabled:1===s,className:"px-3 py-1 border rounded text-sm",children:"Prev"}),(0,b.jsx)("button",{onClick:()=>t(a=>Math.min(x,a+1)),disabled:s===x,className:"px-3 py-1 border rounded text-sm",children:"Next"}),(0,b.jsx)("button",{onClick:()=>t(x),disabled:s===x,className:"px-3 py-1 border rounded text-sm",children:"Last"})]})]})]})]})})}a.s(["default",()=>d])}];

//# sourceMappingURL=src_app_dashboard_monitor_watches_page_tsx_30e9bd88._.js.map