{"version":3,"sources":["../../../../src/app/dashboard/import/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\n\n/**\n * AvidiaImport workspace (client)\n *\n * Now that Import is a real pipeline module, this page is a real operations workspace:\n *\n * - Connect BigCommerce securely (store hash + access token) via server route.\n *   Tokens are never persisted client-side after save.\n *\n * - Run pipeline import for an ingestionId:\n *   - Recommended: extract → seo → audit → import\n *   - Or import-only after an ingestion has already passed audit\n *\n * - Live pipeline telemetry (module_runs) + durable artifact viewer.\n * - Safe-gated upsert:\n *   - If SKU exists and allowOverwriteExisting=false → action=needs_review (no updates performed)\n *   - If allowOverwriteExisting=true → update allowed\n *   - If audit fails, runner skips import (soft gate); this page will show it in module status/output.\n */\n\ntype AnyObj = Record<string, any>;\n\ntype PipelineRunStatus = \"queued\" | \"running\" | \"succeeded\" | \"failed\";\ntype ModuleRunStatus = \"queued\" | \"running\" | \"succeeded\" | \"failed\" | \"skipped\";\n\ntype PipelineModule = {\n  id?: string;\n  module_index: number;\n  module_name: string;\n  status: ModuleRunStatus;\n  started_at?: string | null;\n  finished_at?: string | null;\n  output_ref?: string | null;\n  error?: any;\n};\n\ntype PipelineSnapshot = {\n  run?: { id: string; status: PipelineRunStatus; created_at?: string; started_at?: string; finished_at?: string } & AnyObj;\n  modules?: PipelineModule[];\n};\n\ntype ImportMode = \"full\" | \"import_only\";\n\nfunction sleep(ms: number) {\n  return new Promise((r) => setTimeout(r, ms));\n}\n\nfunction fmtMs(ms: number | null) {\n  if (ms == null || Number.isNaN(ms)) return \"—\";\n  if (ms < 1000) return `${ms}ms`;\n  const s = Math.round(ms / 100) / 10;\n  return `${s}s`;\n}\n\nfunction statusChipClass(status?: string | null) {\n  const s = (status || \"\").toLowerCase();\n  if (s === \"running\") return \"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-950/40 dark:text-amber-100 dark:border-amber-500/40\";\n  if (s === \"failed\") return \"bg-rose-100 text-rose-800 border-rose-200 dark:bg-rose-950/40 dark:text-rose-100 dark:border-rose-500/40\";\n  if (s === \"succeeded\" || s === \"completed\") return \"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950/40 dark:text-emerald-100 dark:border-emerald-500/40\";\n  if (s === \"skipped\") return \"bg-slate-100 text-slate-700 border-slate-200 dark:bg-slate-950/40 dark:text-slate-300 dark:border-slate-800\";\n  return \"bg-slate-100 text-slate-700 border-slate-200 dark:bg-slate-950/40 dark:text-slate-300 dark:border-slate-800\";\n}\n\nfunction moduleLabel(name: string) {\n  switch (name) {\n    case \"extract\":\n      return \"Extract\";\n    case \"seo\":\n      return \"SEO\";\n    case \"audit\":\n      return \"Audit\";\n    case \"import\":\n      return \"Import\";\n    case \"monitor\":\n      return \"Monitor\";\n    case \"price\":\n      return \"Price\";\n    default:\n      return name;\n  }\n}\n\nfunction downloadJson(filename: string, data: any) {\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: \"application/json\" });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n\nexport default function ImportPage() {\n  const params = useSearchParams();\n  const router = useRouter();\n\n  const ingestionIdParam = params?.get(\"ingestionId\") || \"\";\n  const pipelineRunIdParam = params?.get(\"pipelineRunId\") || \"\";\n\n  // BigCommerce connection UI state\n  const [connName, setConnName] = useState(\"BigCommerce Store\");\n  const [storeHash, setStoreHash] = useState(\"\");\n  const [accessToken, setAccessToken] = useState(\"\");\n  const [connections, setConnections] = useState<any[]>([]);\n  const [connSaving, setConnSaving] = useState(false);\n  const [connStatus, setConnStatus] = useState<string | null>(null);\n\n  // Pipeline controls\n  const [ingestionIdInput, setIngestionIdInput] = useState(ingestionIdParam || \"\");\n  const [importMode, setImportMode] = useState<ImportMode>(\"full\");\n  const [allowOverwriteExisting, setAllowOverwriteExisting] = useState(false);\n\n  // Runtime states\n  const [job, setJob] = useState<any | null>(null);\n  const [pipelineRunId, setPipelineRunId] = useState<string>(pipelineRunIdParam || \"\");\n  const [pipelineSnapshot, setPipelineSnapshot] = useState<PipelineSnapshot | null>(null);\n  const [importArtifact, setImportArtifact] = useState<any | null>(null);\n\n  const [loading, setLoading] = useState(false);\n  const [running, setRunning] = useState(false);\n  const [statusMessage, setStatusMessage] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  async function refreshConnections() {\n    const res = await fetch(\"/api/v1/integrations/ecommerce/bigcommerce\");\n    const json = await res.json().catch(() => null);\n    if (res.ok) {\n      setConnections(json?.connections ?? []);\n      // Pre-fill store hash from most recent connection config (token never returned)\n      const latest = (json?.connections ?? [])[0];\n      if (latest?.config?.store_hash) setStoreHash(String(latest.config.store_hash));\n    }\n  }\n\n  async function saveConnection() {\n    setConnSaving(true);\n    setConnStatus(null);\n    try {\n      const res = await fetch(\"/api/v1/integrations/ecommerce/bigcommerce\", {\n        method: \"POST\",\n        headers: { \"content-type\": \"application/json\" },\n        body: JSON.stringify({\n          name: connName,\n          store_hash: storeHash,\n          access_token: accessToken,\n        }),\n      });\n      const json = await res.json().catch(() => null);\n      if (!res.ok) {\n        setConnStatus(json?.error || `Save failed: ${res.status}`);\n        return;\n      }\n      setConnStatus(\"Saved BigCommerce connection.\");\n      setAccessToken(\"\"); // never keep token in UI after save\n      await refreshConnections();\n    } finally {\n      setConnSaving(false);\n    }\n  }\n\n  async function fetchIngestion(id: string) {\n    setLoading(true);\n    try {\n      const res = await fetch(`/api/v1/ingest/${encodeURIComponent(id)}`);\n      const json = await res.json().catch(() => null);\n      if (!res.ok) throw new Error(json?.error?.message || json?.error || `Ingest fetch failed: ${res.status}`);\n      const row = json?.data ?? json;\n      setJob(row);\n      return row;\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function fetchPipelineSnapshot(runId: string) {\n    const res = await fetch(`/api/v1/pipeline/run/${encodeURIComponent(runId)}`);\n    const json = await res.json().catch(() => null);\n    if (!res.ok) throw new Error(json?.error?.message || json?.error || `Pipeline fetch failed: ${res.status}`);\n    return json as PipelineSnapshot;\n  }\n\n  async function pollPipeline(runId: string, timeoutMs = 300_000, intervalMs = 2000) {\n    const start = Date.now();\n    while (Date.now() - start < timeoutMs) {\n      const snap = await fetchPipelineSnapshot(runId);\n      setPipelineSnapshot(snap);\n      const s = snap?.run?.status;\n      if (s === \"succeeded\" || s === \"failed\") return snap;\n      await sleep(intervalMs);\n    }\n    throw new Error(\"Pipeline did not complete within timeout\");\n  }\n\n  async function fetchImportArtifact(runId: string, modules?: PipelineModule[]) {\n    const importMod = (modules ?? []).find((m) => m.module_name === \"import\");\n    if (!importMod) return null;\n\n    const res = await fetch(`/api/v1/pipeline/run/${encodeURIComponent(runId)}/output/${importMod.module_index}`);\n    const json = await res.json().catch(() => null);\n    if (!res.ok) throw new Error(json?.error?.message || json?.error || `Import artifact fetch failed: ${res.status}`);\n\n    setImportArtifact(json);\n    return json;\n  }\n\n  async function runImport() {\n    if (running) return;\n    setError(null);\n    setStatusMessage(null);\n    setPipelineSnapshot(null);\n    setImportArtifact(null);\n\n    const id = ingestionIdInput.trim();\n    if (!id) {\n      setError(\"Enter an ingestionId first.\");\n      return;\n    }\n\n    setRunning(true);\n    try {\n      setStatusMessage(\"Loading ingestion\");\n      await fetchIngestion(id);\n\n      const steps =\n        importMode === \"import_only\"\n          ? [\"import\"] // assumes audit already passed\n          : [\"extract\", \"seo\", \"audit\", \"import\"];\n\n      setStatusMessage(\"Starting pipeline run\");\n      const res = await fetch(\"/api/v1/pipeline/run\", {\n        method: \"POST\",\n        headers: { \"content-type\": \"application/json\" },\n        body: JSON.stringify({\n          ingestionId: id,\n          triggerModule: \"import\",\n          steps,\n          options: {\n            import: {\n              platform: \"bigcommerce\",\n              allowOverwriteExisting,\n            },\n          },\n        }),\n      });\n\n      const json = await res.json().catch(() => null);\n      if (!res.ok) throw new Error(json?.error?.message || json?.error || `Pipeline start failed: ${res.status}`);\n\n      const runId = String(json?.pipelineRunId ?? \"\");\n      if (!runId) throw new Error(\"Pipeline start did not return pipelineRunId\");\n\n      setPipelineRunId(runId);\n      router.push(`/dashboard/import?ingestionId=${encodeURIComponent(id)}&pipelineRunId=${encodeURIComponent(runId)}`);\n\n      setStatusMessage(\"Pipeline running\");\n      const snap = await pollPipeline(runId, 300_000, 2000);\n\n      setStatusMessage(\"Refreshing ingestion\");\n      await fetchIngestion(id);\n\n      setStatusMessage(\"Loading import artifact\");\n      await fetchImportArtifact(runId, snap?.modules ?? []);\n\n      setStatusMessage(\"Import run completed\");\n    } catch (e: any) {\n      setError(String(e?.message || e));\n      setStatusMessage(null);\n    } finally {\n      setRunning(false);\n    }\n  }\n\n  // Initial loads\n  useEffect(() => {\n    refreshConnections().catch(() => null);\n  }, []);\n\n  useEffect(() => {\n    if (ingestionIdParam) {\n      fetchIngestion(ingestionIdParam).catch((e) => setError(String((e as any)?.message || e)));\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ingestionIdParam]);\n\n  useEffect(() => {\n    if (pipelineRunIdParam) {\n      (async () => {\n        try {\n          const snap = await fetchPipelineSnapshot(pipelineRunIdParam);\n          setPipelineSnapshot(snap);\n          setPipelineRunId(pipelineRunIdParam);\n\n          // best-effort load import artifact\n          await fetchImportArtifact(pipelineRunIdParam, snap?.modules ?? []);\n        } catch (e: any) {\n          setError(String(e?.message || e));\n        }\n      })();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pipelineRunIdParam]);\n\n  const jobData = useMemo(() => {\n    if (!job) return null;\n    if ((job as any)?.data?.data) return (job as any).data.data;\n    if ((job as any)?.data) return (job as any).data;\n    return job;\n  }, [job]);\n\n  const auditDiag = jobData?.diagnostics?.audit ?? null;\n  const auditStatus = typeof auditDiag?.status === \"string\" ? auditDiag.status : null;\n  const auditScore = typeof auditDiag?.score === \"number\" ? auditDiag.score : null;\n\n  const importDiag = jobData?.diagnostics?.import ?? null;\n  const importResult = importDiag?.result ?? null;\n\n  const runStatus = pipelineSnapshot?.run?.status ?? null;\n\n  const moduleRuntime = useMemo(() => {\n    const map = new Map<string, number>();\n    for (const m of pipelineSnapshot?.modules ?? []) {\n      if (m.started_at && m.finished_at) {\n        const ms = new Date(m.finished_at).getTime() - new Date(m.started_at).getTime();\n        if (!Number.isNaN(ms) && ms >= 0) map.set(m.module_name, ms);\n      }\n    }\n    return map;\n  }, [pipelineSnapshot]);\n\n  const progress = useMemo(() => {\n    const mods = pipelineSnapshot?.modules ?? [];\n    if (!mods.length) return 0;\n    const done = mods.filter((m) => [\"succeeded\", \"failed\", \"skipped\"].includes(m.status)).length;\n    return Math.round((done / mods.length) * 100);\n  }, [pipelineSnapshot]);\n\n  const importAction = importResult?.action ?? importArtifact?.output?.import?.result?.action ?? null;\n  const importNeedsReview = Boolean(importResult?.needs_review ?? importArtifact?.output?.import?.result?.needs_review);\n\n  const topInfo = (() => {\n    if (!pipelineRunId) return \"Idle\";\n    if (running || runStatus === \"running\") return \"Running…\";\n    return `Run ${pipelineRunId.slice(0, 8)}…`;\n  })();\n\n  return (\n    <main className=\"min-h-screen bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-50\">\n      {/* Background gradients + subtle grid */}\n      <div className=\"pointer-events-none fixed inset-0 -z-10\">\n        <div className=\"absolute -top-32 -left-24 h-72 w-72 rounded-full bg-sky-300/25 blur-3xl dark:bg-sky-500/15\" />\n        <div className=\"absolute -bottom-40 right-[-10rem] h-80 w-80 rounded-full bg-cyan-300/25 blur-3xl dark:bg-cyan-500/12\" />\n        <div className=\"absolute inset-0 opacity-[0.04] dark:opacity-[0.08]\">\n          <div className=\"h-full w-full bg-[linear-gradient(to_right,#e5e7eb_1px,transparent_1px),linear-gradient(to_bottom,#e5e7eb_1px,transparent_1px)] bg-[size:46px_46px] dark:bg-[linear-gradient(to_right,#1f2937_1px,transparent_1px),linear-gradient(to_bottom,#1f2937_1px,transparent_1px)]\" />\n        </div>\n      </div>\n\n      <div className=\"mx-auto max-w-7xl px-4 py-5 lg:px-8 lg:py-6 space-y-4\">\n        {/* Top bar */}\n        <section className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"inline-flex items-center gap-2 rounded-full border border-sky-300/60 bg-white/90 px-3 py-1.5 text-[10px] font-medium uppercase tracking-[0.18em] text-slate-600 shadow-sm dark:border-sky-500/40 dark:bg-slate-950/70 dark:text-sky-100\">\n              <span className=\"inline-flex h-3 w-3 items-center justify-center rounded-full bg-slate-100 border border-sky-300 dark:bg-slate-900 dark:border-sky-400/60\">\n                <span className=\"h-1.5 w-1.5 rounded-full bg-sky-400 animate-pulse\" />\n              </span>\n              AvidiaImport\n              {(jobData?.id || ingestionIdInput) && (\n                <>\n                  <span className=\"h-3 w-px bg-slate-300/70 dark:bg-slate-700/70\" />\n                  <span className=\"font-mono text-[10px]\">\n                    {(jobData?.id || ingestionIdInput).slice(0, 8)}…\n                  </span>\n                </>\n              )}\n              {pipelineRunId && (\n                <>\n                  <span className=\"h-3 w-px bg-slate-300/70 dark:bg-slate-700/70\" />\n                  <span className=\"font-mono text-[10px]\">run:{pipelineRunId.slice(0, 8)}…</span>\n                </>\n              )}\n            </div>\n\n            <div className=\"hidden sm:block text-xs text-slate-500 dark:text-slate-400\">{topInfo}</div>\n          </div>\n\n          {statusMessage && (\n            <div className=\"inline-flex items-center gap-2 rounded-full bg-slate-100 border border-sky-200 px-3 py-1.5 text-[11px] text-sky-700 shadow-sm dark:bg-slate-950/70 dark:border-sky-500/40 dark:text-sky-100\">\n              <span className=\"h-1.5 w-1.5 rounded-full bg-sky-400 animate-pulse\" />\n              {statusMessage}\n            </div>\n          )}\n        </section>\n\n        {/* Above the fold: Connect + Run + Score */}\n        <section className=\"grid grid-cols-1 lg:grid-cols-12 gap-4\">\n          {/* Connection */}\n          <div className=\"lg:col-span-5 rounded-2xl border border-slate-200 bg-white/95 shadow-sm dark:bg-slate-950/60 dark:border-slate-800\">\n            <div className=\"p-4 lg:p-5\">\n              <div className=\"flex items-center justify-between gap-3\">\n                <div>\n                  <h1 className=\"text-lg font-semibold text-slate-900 dark:text-slate-50\">\n                    BigCommerce connection\n                  </h1>\n                  <p className=\"text-xs text-slate-600 dark:text-slate-300 mt-1\">\n                    Store hash is saved as config. Token is encrypted server-side and never shown again.\n                  </p>\n                </div>\n                <span className=\"inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-[10px] text-slate-600 dark:border-slate-800 dark:bg-slate-950/60 dark:text-slate-300\">\n                  v3 Catalog\n                </span>\n              </div>\n\n              {connStatus && (\n                <div className=\"mt-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm dark:border-slate-800 dark:bg-slate-950/40\">\n                  {connStatus}\n                </div>\n              )}\n\n              <div className=\"mt-4 space-y-3\">\n                <div>\n                  <label className=\"block text-[11px] font-medium uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                    Connection name\n                  </label>\n                  <input\n                    value={connName}\n                    onChange={(e) => setConnName(e.target.value)}\n                    className=\"mt-1 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm dark:border-slate-700 dark:bg-slate-950/60\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-[11px] font-medium uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                    Store hash\n                  </label>\n                  <input\n                    value={storeHash}\n                    onChange={(e) => setStoreHash(e.target.value)}\n                    placeholder=\"abcd1234\"\n                    className=\"mt-1 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm dark:border-slate-700 dark:bg-slate-950/60\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-[11px] font-medium uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                    Access token\n                  </label>\n                  <input\n                    value={accessToken}\n                    onChange={(e) => setAccessToken(e.target.value)}\n                    placeholder=\"x-auth-token...\"\n                    type=\"password\"\n                    className=\"mt-1 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm dark:border-slate-700 dark:bg-slate-950/60\"\n                  />\n                  <p className=\"mt-1 text-[11px] text-slate-500 dark:text-slate-400\">\n                    Stored encrypted using <span className=\"font-mono\">INTEGRATIONS_ENCRYPTION_KEY</span>.\n                  </p>\n                </div>\n\n                <button\n                  onClick={saveConnection}\n                  disabled={connSaving || !storeHash || !accessToken}\n                  className=\"w-full rounded-xl bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-950 hover:bg-emerald-400 disabled:opacity-60\"\n                >\n                  {connSaving ? \"Saving…\" : \"Save BigCommerce connection\"}\n                </button>\n\n                <div className=\"pt-2\">\n                  <button\n                    type=\"button\"\n                    onClick={() => refreshConnections()}\n                    className=\"text-[11px] text-sky-700 hover:text-sky-600 underline underline-offset-4 dark:text-sky-300 dark:hover:text-sky-200\"\n                  >\n                    Refresh connections\n                  </button>\n                </div>\n\n                <div className=\"mt-2 space-y-2 text-xs\">\n                  {(connections ?? []).slice(0, 3).map((c) => (\n                    <div\n                      key={c.id}\n                      className=\"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 dark:border-slate-800 dark:bg-slate-950/40\"\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"font-semibold text-slate-900 dark:text-slate-50\">\n                          {c.name || \"BigCommerce\"}\n                        </div>\n                        <div className=\"text-[11px] text-slate-500 dark:text-slate-400\">{c.status}</div>\n                      </div>\n                      <div className=\"mt-1 text-[11px] text-slate-600 dark:text-slate-300\">\n                        store_hash: <span className=\"font-mono\">{c.config?.store_hash ?? \"—\"}</span>\n                      </div>\n                      <div className=\"mt-1 text-[10px] text-slate-500 dark:text-slate-400\">\n                        updated: {c.updated_at ? new Date(c.updated_at).toLocaleString() : \"—\"}\n                      </div>\n                    </div>\n                  ))}\n                  {(!connections || connections.length === 0) && (\n                    <div className=\"text-[11px] text-slate-500 dark:text-slate-400\">\n                      No connections saved yet for this tenant.\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Run import */}\n          <div className=\"lg:col-span-7 rounded-2xl border border-slate-200 bg-white/95 shadow-sm dark:bg-slate-950/60 dark:border-slate-800\">\n            <div className=\"p-4 lg:p-5\">\n              <div className=\"flex items-start justify-between gap-3\">\n                <div>\n                  <h2 className=\"text-lg font-semibold text-slate-900 dark:text-slate-50\">\n                    Run Import (pipeline)\n                  </h2>\n                  <p className=\"text-xs text-slate-600 dark:text-slate-300 mt-1\">\n                    Safe-gated upsert: SKU match will require manual overwrite approval unless you enable overwrite.\n                    If audit fails, import is skipped automatically.\n                  </p>\n                </div>\n                <span className={`inline-flex items-center rounded-full border px-2.5 py-1 text-[11px] ${statusChipClass(runStatus ?? \"idle\")}`}>\n                  {runStatus ?? \"idle\"}\n                </span>\n              </div>\n\n              {error && (\n                <div className=\"mt-3 rounded-2xl border border-rose-300 bg-rose-50 text-rose-800 px-4 py-3 text-sm shadow-sm dark:border-rose-500/40 dark:bg-rose-950/60 dark:text-rose-50\">\n                  {error}\n                </div>\n              )}\n\n              <div className=\"mt-4 grid grid-cols-1 md:grid-cols-12 gap-4\">\n                <div className=\"md:col-span-7 space-y-2\">\n                  <label className=\"text-[11px] font-medium uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                    ingestionId\n                  </label>\n                  <input\n                    value={ingestionIdInput}\n                    onChange={(e) => setIngestionIdInput(e.target.value)}\n                    placeholder=\"b0324634-1593-4fad-a9de-70215a2deb38\"\n                    className=\"w-full px-3 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 placeholder:text-slate-400 focus:border-sky-400 focus:ring-2 focus:ring-sky-500/30 text-sm dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-50 dark:placeholder:text-slate-500\"\n                  />\n\n                  <div className=\"flex flex-wrap items-center gap-3 pt-1 text-[11px] text-slate-600 dark:text-slate-300\">\n                    <div className=\"inline-flex items-center gap-2\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">Mode:</span>\n                      <select\n                        value={importMode}\n                        onChange={(e) => setImportMode(e.target.value as ImportMode)}\n                        className=\"rounded-lg border border-slate-200 bg-white px-2 py-1 text-[11px] dark:border-slate-800 dark:bg-slate-950/60\"\n                      >\n                        <option value=\"full\">extract + seo + audit + import</option>\n                        <option value=\"import_only\">import only</option>\n                      </select>\n                    </div>\n\n                    <label className=\"inline-flex items-center gap-2\">\n                      <input\n                        type=\"checkbox\"\n                        checked={allowOverwriteExisting}\n                        onChange={(e) => setAllowOverwriteExisting(e.target.checked)}\n                      />\n                      <span className=\"text-[11px]\">\n                        Allow overwrite existing SKU (unsafe)\n                      </span>\n                    </label>\n                  </div>\n                </div>\n\n                <div className=\"md:col-span-5 space-y-2\">\n                  <button\n                    type=\"button\"\n                    onClick={runImport}\n                    disabled={running}\n                    className=\"w-full px-4 py-3 rounded-xl bg-sky-500 text-slate-950 text-sm font-semibold shadow-sm hover:bg-sky-400 disabled:opacity-60\"\n                  >\n                    {running ? \"Running…\" : \"Run Import\"}\n                  </button>\n\n                  <button\n                    type=\"button\"\n                    onClick={async () => {\n                      try {\n                        setError(null);\n                        if (!ingestionIdInput.trim()) throw new Error(\"Enter an ingestionId first.\");\n                        await fetchIngestion(ingestionIdInput.trim());\n                        setStatusMessage(\"Loaded ingestion\");\n                      } catch (e: any) {\n                        setError(String(e?.message || e));\n                      }\n                    }}\n                    className=\"w-full px-4 py-3 rounded-xl bg-slate-900 text-slate-50 text-sm font-semibold shadow-sm hover:bg-slate-800 dark:bg-white/10 dark:hover:bg-white/15\"\n                  >\n                    Load ingestion (no run)\n                  </button>\n\n                  <div className=\"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] dark:border-slate-800 dark:bg-slate-950/40\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">Audit</span>\n                      <span className={`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] ${statusChipClass(auditStatus ?? \"unknown\")}`}>\n                        {auditStatus ?? \"unknown\"}\n                      </span>\n                    </div>\n                    <div className=\"mt-1 flex items-center justify-between\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">Score</span>\n                      <span className=\"font-mono text-slate-700 dark:text-slate-200\">\n                        {typeof auditScore === \"number\" ? `${auditScore}/100` : \"—\"}\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] dark:border-slate-800 dark:bg-slate-950/40\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-slate-500 dark:text-slate-400\">Import action</span>\n                      <span className=\"font-semibold text-slate-900 dark:text-slate-50\">\n                        {importAction ?? \"—\"}\n                      </span>\n                    </div>\n                    {importNeedsReview && (\n                      <div className=\"mt-1 text-amber-700 dark:text-amber-200\">\n                        Needs review: SKU exists and overwrite is disabled.\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {/* Progress */}\n              {pipelineSnapshot?.modules?.length ? (\n                <div className=\"mt-4\">\n                  <div className=\"flex items-center justify-between text-[11px] text-slate-500 dark:text-slate-400\">\n                    <span>Pipeline progress</span>\n                    <span>{progress}%</span>\n                  </div>\n                  <div className=\"mt-1 h-2 w-full rounded-full bg-slate-200 dark:bg-slate-800 overflow-hidden\">\n                    <div\n                      className=\"h-full bg-gradient-to-r from-sky-400 via-cyan-300 to-emerald-300\"\n                      style={{ width: `${progress}%` }}\n                    />\n                  </div>\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </section>\n\n        {/* Live pipeline + results */}\n        <section className=\"grid grid-cols-1 lg:grid-cols-12 gap-4\">\n          {/* Live pipeline status */}\n          <div className=\"lg:col-span-5 rounded-2xl bg-white border border-slate-200 shadow-sm p-4 dark:bg-slate-900/70 dark:border-slate-800\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-sm font-semibold text-slate-900 dark:text-slate-50\">Live pipeline</h3>\n              <span className={`inline-flex items-center rounded-full border px-2.5 py-1 text-[11px] ${statusChipClass(runStatus ?? \"idle\")}`}>\n                {runStatus ?? \"idle\"}\n              </span>\n            </div>\n\n            <div className=\"mt-3 space-y-2\">\n              {(pipelineSnapshot?.modules ?? [])\n                .slice()\n                .sort((a, b) => a.module_index - b.module_index)\n                .map((m) => (\n                  <div\n                    key={`${m.module_index}-${m.module_name}`}\n                    className=\"flex items-start justify-between gap-3 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 dark:border-slate-800 dark:bg-slate-950/40\"\n                  >\n                    <div className=\"min-w-0\">\n                      <div className=\"font-semibold text-slate-900 dark:text-slate-50 truncate\">\n                        {m.module_index}. {moduleLabel(m.module_name)}\n                      </div>\n                      <div className=\"mt-1 text-[11px] text-slate-500 dark:text-slate-400 truncate\">\n                        output_ref: <span className=\"font-mono\">{m.output_ref ?? \"—\"}</span>\n                      </div>\n                      {m.error ? (\n                        <div className=\"mt-1 text-[11px] text-rose-700 dark:text-rose-200 truncate\">\n                          error: {typeof m.error === \"string\" ? m.error : JSON.stringify(m.error)}\n                        </div>\n                      ) : null}\n                    </div>\n\n                    <div className=\"text-right shrink-0\">\n                      <span className={`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] ${statusChipClass(m.status)}`}>\n                        {m.status}\n                      </span>\n                      <div className=\"mt-1 text-[11px] text-slate-500 dark:text-slate-400\">\n                        {fmtMs(moduleRuntime.get(m.module_name) ?? null)}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n\n              {!(pipelineSnapshot?.modules ?? []).length && (\n                <div className=\"text-[11px] text-slate-500 dark:text-slate-400\">\n                  No pipeline run selected yet. Run import to see module telemetry.\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Results / artifact viewer */}\n          <div className=\"lg:col-span-7 space-y-4\">\n            <div className=\"rounded-2xl bg-white border border-slate-200 shadow-sm p-4 dark:bg-slate-900/70 dark:border-slate-800\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <h3 className=\"text-sm font-semibold text-slate-900 dark:text-slate-50\">Import result</h3>\n                <div className=\"flex gap-2\">\n                  <button\n                    type=\"button\"\n                    onClick={() =>\n                      downloadJson(\n                        `import-result-${jobData?.id ?? ingestionIdInput ?? \"unknown\"}.json`,\n                        {\n                          ingestionId: jobData?.id ?? ingestionIdInput ?? null,\n                          pipelineRunId: pipelineRunId || null,\n                          diagnostics_import: importDiag ?? null,\n                          import_artifact: importArtifact ?? null,\n                        }\n                      )\n                    }\n                    className=\"px-3 py-2 rounded-lg bg-slate-900 text-xs text-slate-50 border border-slate-900 shadow-sm hover:bg-slate-800 dark:bg-white/5 dark:border-white/20 dark:hover:bg-white/10\"\n                  >\n                    Export JSON\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3 text-xs\">\n                <div className=\"rounded-xl border border-slate-200 bg-slate-50 p-3 dark:border-slate-800 dark:bg-slate-950/40\">\n                  <div className=\"text-[11px] uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                    Status\n                  </div>\n                  <div className=\"mt-1 font-semibold text-slate-900 dark:text-slate-50\">\n                    {importDiag?.status ?? \"—\"}\n                  </div>\n                </div>\n                <div className=\"rounded-xl border border-slate-200 bg-slate-50 p-3 dark:border-slate-800 dark:bg-slate-950/40\">\n                  <div className=\"text-[11px] uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                    Action\n                  </div>\n                  <div className=\"mt-1 font-semibold text-slate-900 dark:text-slate-50\">\n                    {importAction ?? \"—\"}\n                  </div>\n                </div>\n                <div className=\"rounded-xl border border-slate-200 bg-slate-50 p-3 dark:border-slate-800 dark:bg-slate-950/40\">\n                  <div className=\"text-[11px] uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                    Product ID\n                  </div>\n                  <div className=\"mt-1 font-mono text-slate-900 dark:text-slate-50\">\n                    {importResult?.product_id ??\n                      importArtifact?.output?.import?.result?.product_id ??\n                      \"—\"}\n                  </div>\n                </div>\n              </div>\n\n              {importNeedsReview && (\n                <div className=\"mt-3 rounded-xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800 dark:border-amber-500/40 dark:bg-amber-950/40 dark:text-amber-100\">\n                  SKU already exists in BigCommerce. Import is in <strong>needs_review</strong>{\" \"}\n                  mode and did not update anything. If you intend to overwrite, check{\" \"}\n                  <strong>Allow overwrite existing SKU</strong> and re-run.\n                </div>\n              )}\n\n              <div className=\"mt-3\">\n                <div className=\"text-[11px] font-medium uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400\">\n                  Raw artifact (durable output)\n                </div>\n                <pre className=\"mt-2 max-h-[380px] overflow-auto rounded-xl border border-slate-200 bg-slate-900 p-3 text-[11px] text-slate-100 dark:border-slate-800\">\n                  {importArtifact ? JSON.stringify(importArtifact, null, 2) : \"Run an import to see output_ref JSON.\"}\n                </pre>\n              </div>\n            </div>\n\n            {/* Ingestion viewer */}\n            <div className=\"rounded-2xl bg-white border border-slate-200 shadow-sm p-4 dark:bg-slate-900/70 dark:border-slate-800\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-sm font-semibold text-slate-900 dark:text-slate-50\">Ingestion (context)</h3>\n                <span className=\"text-[11px] text-slate-500 dark:text-slate-400\">\n                  product_ingestions\n                </span>\n              </div>\n              <pre className=\"mt-3 max-h-[340px] overflow-auto rounded-xl border border-slate-200 bg-slate-900 p-3 text-[11px] text-slate-100 dark:border-slate-800\">\n                {jobData ? JSON.stringify(jobData, null, 2) : \"Load an ingestion to view persisted diagnostics.\"}\n              </pre>\n            </div>\n          </div>\n        </section>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}