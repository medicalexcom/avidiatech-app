module.exports=[70157,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=["","sku","title","description","price","inventory","weight","brand","image","category"];function e({open:a,headers:e,initialMapping:f={},onSave:g,onClose:h}){let[i,j]=(0,c.useState)({});return((0,c.useEffect)(()=>{let a={};for(let b of e){if(f[b]){a[b]=f[b];continue}let c=b.toLowerCase();c.includes("sku")?a[b]="sku":c.includes("title")||c.includes("name")?a[b]="title":c.includes("desc")?a[b]="description":c.includes("price")?a[b]="price":c.includes("qty")||c.includes("inventory")||c.includes("stock")?a[b]="inventory":a[b]=""}j(a)},[e,f]),a)?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,b.jsxs)("div",{className:"w-full max-w-3xl rounded-lg bg-white p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Map source columns to product fields"}),(0,b.jsx)("button",{onClick:h,className:"px-2 py-1 text-sm",children:"Close"})]}),(0,b.jsx)("div",{className:"mt-3 max-h-[60vh] overflow-auto",children:(0,b.jsxs)("table",{className:"w-full table-auto",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Source column"}),(0,b.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Map to field"})]})}),(0,b.jsx)("tbody",{children:e.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"py-2 text-sm",children:a}),(0,b.jsx)("td",{className:"py-2",children:(0,b.jsx)("select",{value:i[a]??"",onChange:b=>{var c;return c=b.target.value,void j(b=>({...b,[a]:c}))},className:"rounded border px-2 py-1 text-sm",children:d.map(a=>(0,b.jsx)("option",{value:a,children:""===a?"-- ignore --":a},a))})})]},a))})]})}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,b.jsx)("button",{onClick:()=>{g(i)},className:"px-3 py-2 rounded bg-emerald-500 text-white",children:"Save mapping"}),(0,b.jsx)("button",{onClick:h,className:"px-3 py-2 rounded border",children:"Cancel"})]})]})}):null}var f=a.i(69769);function g({bucket:d="imports",maxRows:g=5e3,maxCols:h=50,onCreated:i,className:j,platform:k=null}){let l=(0,f.useToast)(),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null);async function C(b){v(null),t(!0),p([]),r([]),B(null);try{let c=b.name.split(".").pop()?.toLowerCase();if("csv"===c||"txt"===c){let c=await a.A(86674),d=c&&(c.default??c);await new Promise((a,c)=>{d.parse(b,{header:!0,preview:50,skipEmptyLines:!0,complete:b=>{p(b.meta?.fields??[]),r(b.data??[]),a()},error:a=>c(a)})})}else if("xlsx"===c||"xls"===c){let c=await a.A(98516),d=new FileReader;d.onload=a=>{try{let b=a.target?.result,d=c.read(b,{type:"array"}),e=c.utils.sheet_to_json(d.Sheets[d.SheetNames[0]],{defval:""});p(e.length?Object.keys(e[0]):[]),r(e.slice(0,50))}catch(a){v(a?.message??String(a))}finally{t(!1)}},d.onerror=()=>{v("Failed to read file for preview"),t(!1)},d.readAsArrayBuffer(b);return}else v("Preview unavailable for this file type")}catch(a){v(a?.message??String(a))}finally{t(!1)}}async function D(){if(v(null),!m)return void v("No file selected");if(o.length>h)return void v(`Too many columns (max ${h}). Please reduce columns.`);x(!0);try{let a=new FormData;if(a.append("file",m,m.name),A)try{a.append("mapping",JSON.stringify(A))}catch(a){}k&&a.append("platform",String(k));let b=await fetch("/api/upload-to-supabase",{method:"POST",body:a}),c=await b.json().catch(()=>null);if(!b.ok||!c?.ok){let a=c?.error??`Upload failed: ${b.status}`;v(a),l?.error?.(a);return}let e=c?.jobId??c?.data?.id??c?.inserted?.id??null,f=c?.file_path??c?.data?.path??c?.data?.raw?.fullPath??c?.data?.raw?.path??null;if(e){if(A)try{await fetch(`/api/v1/ingest/${encodeURIComponent(e)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({mapping:A})})}catch{}l?.success?.(`Upload succeeded — job ${e}`),i?.(e);return}let g=f?String(f):null;if(!e&&g){let a=g.startsWith(`${d}/`)||g.startsWith("/")?g.replace(/^\/+/,""):`${d}/${g}`;try{let b=await fetch("/api/imports",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({file_path:a,file_name:m.name,file_format:m.name.split(".").pop()?.toLowerCase()??null,mapping:A??null,platform:k??null})}),c=await b.json().catch(()=>null);if(!b.ok||!c?.ok){let a=c?.error??`Create import job failed: ${b.status}`;v(a),l?.error?.(a);return}let d=c.jobId??c.id??c.data?.id??null;if(d){l?.success?.(`Import job created: ${d}`),i?.(d);return}l?.info?.("Upload succeeded; import job created (no id returned)."),i?.("");return}catch(b){let a=String(b?.message??b);v(a),l?.error?.(a);return}}l?.info?.("Upload succeeded but no job id/path returned from server. Check server logs."),i?.("")}catch(b){let a=String(b?.message??b);v(a),l?.error?.(a)}finally{x(!1)}}return(0,c.useEffect)(()=>{m||(p([]),r([]),v(null))},[m]),(0,b.jsxs)("div",{className:j,children:[(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"file",accept:"*/*",onChange:a=>{let b=a.target.files?.[0]??null;n(b),b&&C(b)}})}),s&&(0,b.jsx)("div",{className:"mt-3 text-sm",children:"Loading preview…"}),u&&(0,b.jsx)("div",{className:"mt-3 text-sm text-rose-700",children:u}),o.length>0&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Preview headers"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("button",{onClick:()=>z(!0),className:"text-xs px-2 py-1 border rounded mr-2",children:"Open mapping"}),(0,b.jsx)("button",{onClick:()=>{p([]),r([]),n(null),B(null)},className:"text-xs px-2 py-1 border rounded",children:"Clear"})]})]}),(0,b.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(o)}),(0,b.jsx)("div",{className:"mt-3 text-xs text-slate-500",children:"Preview rows"}),(0,b.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(q.slice(0,5),null,2)}),(0,b.jsx)("div",{className:"mt-4 flex gap-2",children:(0,b.jsx)("button",{onClick:D,disabled:w,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:w?"Uploading…":"Upload & Create Import"})})]}),!o.length&&!s&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"No preview available for this file type. You can still upload."}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:D,disabled:w,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:w?"Uploading…":"Upload & Create Import"}),(0,b.jsx)("button",{onClick:()=>{n(null),v(null)},className:"inline-flex items-center rounded px-3 py-2 border text-sm",children:"Clear"})]})]}),(0,b.jsx)(e,{open:y,headers:o,initialMapping:A??{},onSave:a=>{B(a),z(!1)},onClose:()=>z(!1)})]})}a.s(["default",()=>g],70157)},51142,a=>{"use strict";var b=a.i(87924),c=a.i(70157);function d(){return(0,b.jsx)("main",{className:"flex min-h-screen items-center justify-center bg-gray-50 px-4 py-12",children:(0,b.jsx)("div",{className:"w-full max-w-xl",children:(0,b.jsxs)("div",{className:"rounded-lg bg-white p-6 shadow-sm",children:[(0,b.jsx)("h1",{className:"text-xl font-semibold mb-3",children:"Create import"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mb-4",children:"Upload a CSV or Excel file. Max rows: 5000, Max columns: 50."}),(0,b.jsx)(c.default,{bucket:"imports",onCreated:a=>{a?window.location.href=`/imports/${a}`:window.location.reload()}})]})})})}a.s(["default",()=>d])},98516,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_xlsx_xlsx_mjs_959e58f3._.js"].map(b=>a.l(b))).then(()=>b(75750)))},86674,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_papaparse_papaparse_82baccab.js"].map(b=>a.l(b))).then(()=>b(85231)))}];

//# sourceMappingURL=_59aecd67._.js.map