module.exports=[51261,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246);function e({count:a}){return!a||a<=0?null:(0,b.jsx)("span",{className:"inline-flex items-center justify-center text-xs font-semibold px-2 py-0.5 rounded-full bg-rose-600 text-white",children:a})}function f({status:a}){return(0,b.jsx)("span",{className:`text-xs px-2 py-0.5 rounded-full ${{open:"bg-emerald-100 text-emerald-800",pending:"bg-amber-100 text-amber-800",closed:"bg-slate-100 text-slate-600"}[a]??"bg-slate-100 text-slate-700"}`,children:a})}function g({priority:a}){return(0,b.jsx)("span",{className:`text-xs px-2 py-0.5 rounded-full ${{high:"bg-rose-100 text-rose-800",normal:"bg-sky-100 text-sky-800",low:"bg-slate-100 text-slate-600"}[a??"normal"]}`,children:(a??"normal").toUpperCase()})}function h({thread:a,onClick:c,focused:d}){return(0,b.jsx)("button",{onClick:c,className:`w-full text-left p-3 rounded-lg bg-white border border-slate-100 shadow-sm hover:shadow-md transition-shadow flex items-start gap-3 ${d?"ring-2 ring-sky-300":""}`,children:(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-700 text-sm font-medium",children:a.tenant_id?String(a.tenant_id).charAt(0).toUpperCase():"T"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-slate-900 truncate",children:a.subject||"No subject"}),(0,b.jsx)("div",{className:"text-xs text-slate-500 truncate mt-0.5",children:a.last_message_preview??""})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g,{priority:a.priority}),(0,b.jsx)(f,{status:a.status})]})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs text-slate-500",children:[(0,b.jsx)("div",{className:"truncate",children:a.tenant_id??"Unknown tenant"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["number"==typeof a.unread_count&&(0,b.jsx)(e,{count:a.unread_count}),(0,b.jsx)("div",{children:a.last_message_at?new Date(a.last_message_at).toLocaleString():""})]})]})]})})}function i({threads:a,onSelect:d}){let[e,f]=(0,c.useState)(-1),g=(0,c.useRef)(null);return(0,c.useEffect)(()=>{function b(b){a&&0!==a.length&&("ArrowDown"===b.key||"j"===b.key?(b.preventDefault(),f(b=>Math.min(-1===b?0:b+1,a.length-1))):"ArrowUp"===b.key||"k"===b.key?(b.preventDefault(),f(a=>Math.max(-1===a?0:a-1,0))):"Enter"===b.key&&e>=0&&e<a.length&&d(a[e].id))}return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[a,e,d]),(0,c.useEffect)(()=>{let a=g.current?.children[e];a?.scrollIntoView({block:"nearest",behavior:"smooth"})},[e]),(0,b.jsxs)("div",{className:"p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-slate-800",children:"Conversation Queue"}),(0,b.jsx)("button",{className:"text-xs px-2 py-1 rounded bg-slate-100 border border-slate-200 text-slate-700",children:"Filters"})]}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Tip: use ↑/↓ or j/k to navigate, Enter to open"}),(0,b.jsxs)("ul",{ref:g,className:"mt-3 space-y-2",children:[0===a.length&&(0,b.jsx)("li",{className:"text-sm text-slate-500 mt-3",children:"No threads yet"}),a.map((a,c)=>(0,b.jsx)("li",{children:(0,b.jsx)(h,{thread:a,onClick:()=>d(a.id),focused:c===e})},a.id))]})]})}function j({open:a,onClose:c,onInsert:d,canned:e=k}){return a?(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:c}),(0,b.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg w-[min(720px,95%)] max-h-[80vh] overflow-auto p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Canned replies"}),(0,b.jsx)("button",{onClick:c,className:"text-slate-500 text-sm",children:"Close"})]}),(0,b.jsx)("div",{className:"mt-3 space-y-3",children:e.map(a=>(0,b.jsx)("div",{className:"p-3 border rounded hover:bg-slate-50",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-slate-800",children:a.title}),(0,b.jsx)("div",{className:"text-sm text-slate-600 mt-1 whitespace-pre-wrap",children:a.body})]}),(0,b.jsx)("div",{className:"ml-3 flex flex-col gap-2",children:(0,b.jsx)("button",{onClick:()=>{d(a.body),c()},className:"text-sm px-3 py-1 rounded bg-sky-600 text-white",children:"Insert"})})]})},a.id))})]})]}):null}let k=[{id:"1",title:"Welcome + Next steps",body:"Thanks for reaching out — here's what to try next: 1) clear cache 2) re-run ingest 3) send logs."},{id:"2",title:"Request more info",body:"Could you share the ingest job ID and the manifest URL? Also send the timestamp of the failure."},{id:"3",title:"Escalate to engineering",body:"I've escalated this to engineering with priority. We'll update you within 24 hours."}];function l({m:a}){let[d,e]=(0,c.useState)(!1);(0,c.useEffect)(()=>{e(!0)},[]);let f="agent"===a.sender_role;return(0,b.jsx)("div",{className:`flex ${f?"justify-end":"justify-start"} transition-transform duration-200 ${d?"transform-none opacity-100":"translate-y-1 opacity-0"}`,children:(0,b.jsxs)("div",{className:`rounded-lg p-3 max-w-[80%] ${f?"bg-sky-600 text-white":"bg-slate-100 text-slate-900"}`,children:[(0,b.jsx)("div",{className:"text-xs opacity-80",children:a.sender_role}),(0,b.jsx)("div",{className:"mt-1 text-sm whitespace-pre-wrap",children:a.content}),a.chat_files&&a.chat_files.length>0&&(0,b.jsx)("div",{className:"mt-2 space-y-1",children:a.chat_files.map(a=>(0,b.jsx)("a",{href:"#",className:"text-xs text-sky-700 underline block",children:a.file_name??"attachment"},a.id))})]})})}function m({threadId:a,onAction:d}){let[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)(""),[i,k]=(0,c.useState)(!1),m=(0,c.useRef)(null);async function n(){if(!a||!g.trim())return;let b=await fetch(`/api/support/admin/threads/${a}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:g,messageType:"text",internal:!1})});if(b.ok){h(""),d?.();let a=await b.json();f(b=>[...b,a.message])}else console.error("send failed",await b.json())}return(0,c.useEffect)(()=>{if(!a)return f([]);fetch(`/api/support/admin/threads/${a}/messages`).then(a=>a.json()).then(a=>f(a.messages||[])).catch(a=>console.error("Failed to fetch admin messages",a))},[a]),(0,c.useEffect)(()=>{setTimeout(()=>m.current?.scrollTo({top:m.current.scrollHeight,behavior:"smooth"}),50)},[e]),(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b bg-white",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:a?`Thread ${a}`:"No thread selected"}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Conversation details & quick actions"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{className:"text-xs bg-slate-100 px-2 py-1 rounded",onClick:()=>k(!0),children:"Canned"}),(0,b.jsx)("button",{className:"text-xs bg-slate-100 px-2 py-1 rounded",children:"Assign"}),(0,b.jsx)("button",{className:"text-xs bg-slate-100 px-2 py-1 rounded",children:"Close"})]})]})}),(0,b.jsx)("div",{ref:m,className:"flex-1 overflow-y-auto p-6 bg-slate-50",children:(0,b.jsx)("div",{className:"max-w-3xl mx-auto space-y-3",children:e.map(a=>(0,b.jsx)(l,{m:a},a.id))})}),(0,b.jsx)("div",{className:"px-6 py-4 border-t bg-white",children:(0,b.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,b.jsx)("textarea",{value:g,onChange:a=>h(a.target.value),className:"w-full p-3 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-200",rows:3,placeholder:"Write a reply or internal note..."}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{className:"text-xs px-3 py-1 rounded bg-slate-100",children:"Attach"}),(0,b.jsx)("button",{onClick:()=>k(!0),className:"text-xs px-3 py-1 rounded bg-slate-100",children:"Insert canned reply"}),(0,b.jsx)("button",{onClick:async()=>{if(!a)return;let b=await fetch("/api/support/admin/ai/draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:a})});if(b.ok){let a=await b.json();h(b=>b?b+"\n\n"+a.draft:a.draft)}},className:"text-xs px-3 py-1 rounded bg-slate-100",children:"AI Draft"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("label",{className:"text-xs text-slate-500",children:"Public"}),(0,b.jsx)("button",{onClick:n,className:"bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md",children:"Send"})]})]})]})}),(0,b.jsx)(j,{open:i,onClose:()=>k(!1),onInsert:function(a){h(b=>b?b+"\n\n"+a:a),k(!1)}})]})}function n({threadId:a}){let[d,e]=(0,c.useState)(null);return((0,c.useEffect)(()=>{if(!a)return e(null);fetch("/api/support/admin/threads?limit=1").then(a=>a.json()).then(b=>{e((b.threads||[]).find(b=>b.id===a)||null)}).catch(a=>console.error("failed to load thread context",a))},[a]),d)?(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"p-3 bg-slate-900 rounded",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Tenant"}),(0,b.jsx)("div",{className:"mt-1 font-medium",children:d.tenant_id})]}),(0,b.jsxs)("div",{className:"p-3 bg-slate-900 rounded",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Status"}),(0,b.jsx)("div",{className:"mt-1",children:d.status})]})]}):(0,b.jsx)("div",{className:"p-4 text-slate-400",children:"Select a thread to see tenant & user context"})}function o({name:a,isAgent:d}){let[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(()=>"Online");return(0,c.useEffect)(()=>{localStorage.setItem("agent_status",g)},[g]),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("button",{onClick:()=>f(a=>!a),className:"h-9 w-9 rounded-full bg-slate-200 flex items-center justify-center text-slate-700 font-medium",children:a?a.charAt(0).toUpperCase():"A"}),e&&(0,b.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white border rounded shadow p-2 z-50",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-slate-800",children:a??"Agent"}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:["Role: ",d?"Support":"User"]}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-slate-600",children:"Status"}),(0,b.jsxs)("select",{value:g,onChange:a=>h(a.target.value),className:"text-xs border rounded px-2 py-1",children:[(0,b.jsx)("option",{children:"Online"}),(0,b.jsx)("option",{children:"Away"}),(0,b.jsx)("option",{children:"Offline"})]})]})}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("a",{href:"/dashboard",className:"block text-sm px-2 py-1 rounded hover:bg-slate-50",children:"Back to dashboard"}),(0,b.jsx)("a",{href:"/sign-out",className:"block text-sm px-2 py-1 rounded text-rose-600 hover:bg-slate-50",children:"Sign out"})]})]})]})}function p(){let[a,e]=(0,c.useState)(null),[f,g]=(0,c.useState)([]),[h,j]=(0,c.useState)(0),[k,l]=(0,c.useState)(null),[p,q]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/support/admin/me");if(a.ok){let b=await a.json();l(b)}else l({isAgent:!1})}catch(a){console.error("failed to fetch agent info",a),l({isAgent:!1})}finally{q(!1)}})()},[]),(0,c.useEffect)(()=>{k&&k.isAgent&&fetch("/api/support/admin/threads").then(a=>a.json()).then(a=>g(a.threads||[])).catch(a=>console.error("Failed to load admin threads",a))},[h,k]),p||k&&k.isAgent)?(0,b.jsxs)("div",{className:"min-h-screen flex flex-col bg-slate-50 text-slate-900",children:[(0,b.jsx)("div",{className:"px-4 py-3 border-b bg-white shadow-sm",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center gap-4",children:[(0,b.jsxs)(d.default,{href:"/dashboard",className:"inline-flex items-center gap-2 text-slate-700 hover:text-slate-900",children:[(0,b.jsx)("svg",{className:"h-5 w-5 text-slate-500",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:(0,b.jsx)("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back to dashboard"]}),(0,b.jsxs)("div",{className:"flex-1 flex items-center gap-3",children:[(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"AvidiaTech Support Console"}),(0,b.jsxs)("div",{className:"ml-4 flex items-center gap-2 bg-slate-100 rounded-full px-3 py-1 text-xs text-slate-600",children:[(0,b.jsx)("span",{className:"w-2 h-2 rounded-full bg-emerald-400 inline-block"}),"Production"]}),(0,b.jsx)("div",{className:"ml-auto max-w-md w-full",children:(0,b.jsxs)("label",{className:"relative block",children:[(0,b.jsx)("input",{"aria-label":"Search threads, tenants, users",placeholder:"Search threads, tenant, user email...",className:"w-full pl-10 pr-3 py-2 rounded-lg border border-slate-200 bg-white text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300"}),(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:(0,b.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",children:[(0,b.jsx)("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("circle",{cx:"11",cy:"11",r:"6",stroke:"currentColor",strokeWidth:"1.5"})]})})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-slate-700",children:k?.name??"Agent"}),(0,b.jsx)(o,{name:k?.name,isAgent:k?.isAgent})]})]})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,b.jsxs)("div",{className:"h-full flex max-w-7xl mx-auto",children:[(0,b.jsx)("aside",{className:"w-80 border-r border-slate-100 bg-slate-50 overflow-y-auto",children:(0,b.jsx)(i,{threads:f,onSelect:a=>e(a)})}),(0,b.jsx)("main",{className:"flex-1 overflow-auto bg-slate-50 p-6",children:(0,b.jsx)("div",{className:"max-w-5xl mx-auto bg-white rounded-2xl shadow h-[calc(100vh-160px)] flex flex-col overflow-hidden",children:(0,b.jsx)(m,{threadId:a,onAction:()=>j(a=>a+1)})})}),(0,b.jsxs)("aside",{className:"w-96 border-l border-slate-100 bg-slate-50 overflow-y-auto p-4",children:[(0,b.jsx)(n,{threadId:a}),(0,b.jsx)("div",{className:"mt-6",children:(0,b.jsx)(d.default,{href:"/dashboard",className:"block w-full text-center rounded-md px-3 py-2 bg-sky-600 text-white font-medium hover:bg-sky-700",children:"Open tenant in Dashboard"})})]})]})})]}):(0,b.jsx)("div",{className:"min-h-screen bg-slate-50 text-slate-900 flex items-center justify-center p-6",children:(0,b.jsxs)("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow p-6 text-center",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Access restricted"}),(0,b.jsx)("p",{className:"mt-2 text-slate-600",children:"This area is for support staff and owners only."}),(0,b.jsxs)("div",{className:"mt-4 flex justify-center gap-3",children:[(0,b.jsx)(d.default,{href:"/dashboard",className:"px-4 py-2 bg-sky-600 text-white rounded",children:"Back to dashboard"}),(0,b.jsx)(d.default,{href:"/sign-in?redirect_url=/internal/support",className:"px-4 py-2 border rounded",children:"Sign in"})]})]})})}a.s(["default",()=>p],51261)}];

//# sourceMappingURL=src_app_internal_support_page_tsx_0fb1c3a9._.js.map