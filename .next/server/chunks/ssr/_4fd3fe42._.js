module.exports=[82722,12171,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69769);function e({open:a,title:d="Confirm",description:e,confirmLabel:f="Confirm",cancelLabel:g="Cancel",onConfirm:h,onCancel:i,onClose:j}){let k=(0,c.useRef)(null),l=(0,c.useRef)(null),m=(0,c.useRef)(null);return((0,c.useEffect)(()=>{if(a)return k.current?.focus(),document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b);function b(a){if("Escape"===a.key)a.preventDefault(),(j??i)?.();else if("Tab"===a.key){let b=k.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!b||0===b.length)return;let c=b[0],d=b[b.length-1];a.shiftKey&&document.activeElement===c?(a.preventDefault(),d.focus()):a.shiftKey||document.activeElement!==d||(a.preventDefault(),c.focus())}}},[a,i,j]),a)?(0,b.jsxs)("div",{role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title",tabIndex:-1,ref:k,className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>(j??i)?.()}),(0,b.jsxs)("div",{className:"bg-white rounded shadow-lg max-w-lg w-full p-6 relative z-10",children:[(0,b.jsx)("h2",{id:"confirm-title",className:"text-lg font-medium",children:d}),e&&(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:e}),(0,b.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,b.jsx)("button",{ref:l,onClick:()=>(j??i)?.(),className:"px-3 py-1 rounded bg-gray-100",children:g}),(0,b.jsx)("button",{ref:m,onClick:h,className:"px-3 py-1 rounded bg-red-600 text-white",children:f})]})]})]}):null}a.s(["default",0,({integrationId:a,isOpen:e,onClose:f})=>{let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),m=(0,c.useRef)(null),n=(0,d.useToast)();return((0,c.useEffect)(()=>{if(!e||!a)return;let b=!0;return h(!0),l(null),fetch(`/api/v1/integrations/${a}`).then(a=>a.json()).then(a=>{b&&(a.ok?j(a.integration??a):(l(a.error??"Failed to load integration"),j(null)))}).catch(a=>{b&&l(String(a))}).finally(()=>{b&&h(!1)}),()=>{b=!1}},[e,a]),(0,c.useEffect)(()=>{e&&setTimeout(()=>m.current?.focus(),0)},[e]),e)?(0,b.jsxs)("div",{className:"fixed inset-0 z-[60] flex",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:f}),(0,b.jsxs)("aside",{ref:m,tabIndex:-1,className:"ml-auto w-full max-w-lg bg-white dark:bg-slate-900 shadow-xl p-6 overflow-auto","aria-label":"Connector details",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Connector details"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Inspect and run actions for this connector."})]}),(0,b.jsx)("button",{onClick:f,"aria-label":"Close",className:"ml-4 rounded p-1 text-gray-600 hover:text-gray-900",children:"✕"})]}),g?(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Loading…"}):k?(0,b.jsxs)("div",{className:"text-sm text-rose-600",children:["Error: ",k]}):i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:["Provider: ",(0,b.jsx)("strong",{className:"text-gray-800",children:i.provider??"—"})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:["Name: ",(0,b.jsx)("strong",{className:"text-gray-800",children:i.name??i.id})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:["Created: ",(0,b.jsx)("strong",{className:"text-gray-800",children:i.created_at??"—"})]})]}),(0,b.jsxs)("section",{className:"mt-4",children:[(0,b.jsx)("h3",{className:"font-medium mb-2",children:"Configuration"}),(0,b.jsx)("pre",{className:"text-xs bg-gray-100 dark:bg-slate-800 p-3 rounded max-h-44 overflow-auto",children:JSON.stringify(i.config??{},null,2)})]}),(0,b.jsxs)("section",{className:"mt-4",children:[(0,b.jsx)("h3",{className:"font-medium mb-2",children:"Schedule"}),i.schedule?(0,b.jsx)("pre",{className:"text-sm bg-gray-50 dark:bg-slate-800 p-2 rounded",children:JSON.stringify(i.schedule,null,2)}):(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"No schedule configured"})]}),i.last_error&&(0,b.jsxs)("div",{className:"mt-4 text-sm text-rose-600",children:["Last error: ",i.last_error]}),(0,b.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,b.jsx)("button",{onClick:async()=>{try{if(!i?.id)return;let a=await fetch(`/api/v1/integrations/${i.id}/sync`,{method:"POST"}),b=await a.json().catch(()=>null);if(!a.ok||!b?.ok)return void n.error(b?.error??"Failed to start sync");n.success("Sync queued")}catch(a){n.error(String(a?.message??a))}},className:"px-4 py-2 rounded bg-blue-600 text-white",children:"Sync now"}),(0,b.jsx)("a",{href:`/integrations/${i.id}/edit`,className:"px-4 py-2 rounded border text-sm text-gray-700 hover:bg-gray-50",children:"Edit"})]})]}):(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"No integration selected"})]})]}):null}],82722),a.s(["ConfirmDialog",()=>e],12171)},70157,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=["","sku","title","description","price","inventory","weight","brand","image","category"];function e({open:a,headers:e,initialMapping:f={},onSave:g,onClose:h}){let[i,j]=(0,c.useState)({});return((0,c.useEffect)(()=>{let a={};for(let b of e){if(f[b]){a[b]=f[b];continue}let c=b.toLowerCase();c.includes("sku")?a[b]="sku":c.includes("title")||c.includes("name")?a[b]="title":c.includes("desc")?a[b]="description":c.includes("price")?a[b]="price":c.includes("qty")||c.includes("inventory")||c.includes("stock")?a[b]="inventory":a[b]=""}j(a)},[e,f]),a)?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,b.jsxs)("div",{className:"w-full max-w-3xl rounded-lg bg-white p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Map source columns to product fields"}),(0,b.jsx)("button",{onClick:h,className:"px-2 py-1 text-sm",children:"Close"})]}),(0,b.jsx)("div",{className:"mt-3 max-h-[60vh] overflow-auto",children:(0,b.jsxs)("table",{className:"w-full table-auto",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Source column"}),(0,b.jsx)("th",{className:"text-left text-xs text-slate-500 pb-2",children:"Map to field"})]})}),(0,b.jsx)("tbody",{children:e.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"py-2 text-sm",children:a}),(0,b.jsx)("td",{className:"py-2",children:(0,b.jsx)("select",{value:i[a]??"",onChange:b=>{var c;return c=b.target.value,void j(b=>({...b,[a]:c}))},className:"rounded border px-2 py-1 text-sm",children:d.map(a=>(0,b.jsx)("option",{value:a,children:""===a?"-- ignore --":a},a))})})]},a))})]})}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,b.jsx)("button",{onClick:()=>{g(i)},className:"px-3 py-2 rounded bg-emerald-500 text-white",children:"Save mapping"}),(0,b.jsx)("button",{onClick:h,className:"px-3 py-2 rounded border",children:"Cancel"})]})]})}):null}var f=a.i(69769);function g({bucket:d="imports",maxRows:g=5e3,maxCols:h=50,onCreated:i,className:j,platform:k=null}){let l=(0,f.useToast)(),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null);async function C(b){v(null),t(!0),p([]),r([]),B(null);try{let c=b.name.split(".").pop()?.toLowerCase();if("csv"===c||"txt"===c){let c=await a.A(86674),d=c&&(c.default??c);await new Promise((a,c)=>{d.parse(b,{header:!0,preview:50,skipEmptyLines:!0,complete:b=>{p(b.meta?.fields??[]),r(b.data??[]),a()},error:a=>c(a)})})}else if("xlsx"===c||"xls"===c){let c=await a.A(98516),d=new FileReader;d.onload=a=>{try{let b=a.target?.result,d=c.read(b,{type:"array"}),e=c.utils.sheet_to_json(d.Sheets[d.SheetNames[0]],{defval:""});p(e.length?Object.keys(e[0]):[]),r(e.slice(0,50))}catch(a){v(a?.message??String(a))}finally{t(!1)}},d.onerror=()=>{v("Failed to read file for preview"),t(!1)},d.readAsArrayBuffer(b);return}else v("Preview unavailable for this file type")}catch(a){v(a?.message??String(a))}finally{t(!1)}}async function D(){if(v(null),!m)return void v("No file selected");if(o.length>h)return void v(`Too many columns (max ${h}). Please reduce columns.`);x(!0);try{let a=new FormData;if(a.append("file",m,m.name),A)try{a.append("mapping",JSON.stringify(A))}catch(a){}k&&a.append("platform",String(k));let b=await fetch("/api/upload-to-supabase",{method:"POST",body:a}),c=await b.json().catch(()=>null);if(!b.ok||!c?.ok){let a=c?.error??`Upload failed: ${b.status}`;v(a),l?.error?.(a);return}let e=c?.jobId??c?.data?.id??c?.inserted?.id??null,f=c?.file_path??c?.data?.path??c?.data?.raw?.fullPath??c?.data?.raw?.path??null;if(e){if(A)try{await fetch(`/api/v1/ingest/${encodeURIComponent(e)}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({mapping:A})})}catch{}l?.success?.(`Upload succeeded — job ${e}`),i?.(e);return}let g=f?String(f):null;if(!e&&g){let a=g.startsWith(`${d}/`)||g.startsWith("/")?g.replace(/^\/+/,""):`${d}/${g}`;try{let b=await fetch("/api/imports",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({file_path:a,file_name:m.name,file_format:m.name.split(".").pop()?.toLowerCase()??null,mapping:A??null,platform:k??null})}),c=await b.json().catch(()=>null);if(!b.ok||!c?.ok){let a=c?.error??`Create import job failed: ${b.status}`;v(a),l?.error?.(a);return}let d=c.jobId??c.id??c.data?.id??null;if(d){l?.success?.(`Import job created: ${d}`),i?.(d);return}l?.info?.("Upload succeeded; import job created (no id returned)."),i?.("");return}catch(b){let a=String(b?.message??b);v(a),l?.error?.(a);return}}l?.info?.("Upload succeeded but no job id/path returned from server. Check server logs."),i?.("")}catch(b){let a=String(b?.message??b);v(a),l?.error?.(a)}finally{x(!1)}}return(0,c.useEffect)(()=>{m||(p([]),r([]),v(null))},[m]),(0,b.jsxs)("div",{className:j,children:[(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"file",accept:"*/*",onChange:a=>{let b=a.target.files?.[0]??null;n(b),b&&C(b)}})}),s&&(0,b.jsx)("div",{className:"mt-3 text-sm",children:"Loading preview…"}),u&&(0,b.jsx)("div",{className:"mt-3 text-sm text-rose-700",children:u}),o.length>0&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Preview headers"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("button",{onClick:()=>z(!0),className:"text-xs px-2 py-1 border rounded mr-2",children:"Open mapping"}),(0,b.jsx)("button",{onClick:()=>{p([]),r([]),n(null),B(null)},className:"text-xs px-2 py-1 border rounded",children:"Clear"})]})]}),(0,b.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(o)}),(0,b.jsx)("div",{className:"mt-3 text-xs text-slate-500",children:"Preview rows"}),(0,b.jsx)("pre",{className:"mt-2 text-xs overflow-auto bg-slate-50 p-2 rounded",children:JSON.stringify(q.slice(0,5),null,2)}),(0,b.jsx)("div",{className:"mt-4 flex gap-2",children:(0,b.jsx)("button",{onClick:D,disabled:w,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:w?"Uploading…":"Upload & Create Import"})})]}),!o.length&&!s&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"No preview available for this file type. You can still upload."}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:D,disabled:w,className:"inline-flex items-center rounded px-3 py-2 bg-slate-900 text-white text-sm disabled:opacity-60",children:w?"Uploading…":"Upload & Create Import"}),(0,b.jsx)("button",{onClick:()=>{n(null),v(null)},className:"inline-flex items-center rounded px-3 py-2 border text-sm",children:"Clear"})]})]}),(0,b.jsx)(e,{open:y,headers:o,initialMapping:A??{},onSave:a=>{B(a),z(!1)},onClose:()=>z(!1)})]})}a.s(["default",()=>g],70157)},98516,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_xlsx_xlsx_mjs_959e58f3._.js"].map(b=>a.l(b))).then(()=>b(75750)))},86674,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_papaparse_papaparse_82baccab.js"].map(b=>a.l(b))).then(()=>b(85231)))}];

//# sourceMappingURL=_4fd3fe42._.js.map