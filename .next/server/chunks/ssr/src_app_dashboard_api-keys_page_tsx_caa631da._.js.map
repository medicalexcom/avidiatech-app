{"version":3,"sources":["../../../../src/app/dashboard/api-keys/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from 'react';\n\ninterface ApiKey {\n  id: string;\n  name: string;\n  prefix: string;\n  created_at: string;\n  revoked_at: string | null;\n  last_used_at?: string | null;\n}\n\nexport default function ApiKeysPage() {\n  const [keys, setKeys] = useState<ApiKey[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [name, setName] = useState('');\n  const [tenantId, setTenantId] = useState('');\n  const [newKey, setNewKey] = useState<string | null>(null);\n\n  // Fetch keys when tenantId changes\n  useEffect(() => {\n    if (!tenantId) return;\n    const fetchKeys = async () => {\n      const res = await fetch(`/api/v1/api-keys?tenant_id=${encodeURIComponent(tenantId)}`);\n      const json = await res.json();\n      setKeys(json.keys || []);\n    };\n    fetchKeys();\n  }, [tenantId]);\n\n  // Handler to create a new key\n  const createKey = async () => {\n    if (!name || !tenantId) return;\n    setLoading(true);\n    const res = await fetch('/api/v1/api-keys', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ tenant_id: tenantId, name }),\n    });\n    const json = await res.json();\n    setLoading(false);\n    if (json.key) {\n      setNewKey(json.key);\n    }\n    // refresh list\n    const listRes = await fetch(`/api/v1/api-keys?tenant_id=${encodeURIComponent(tenantId)}`);\n    const listJson = await listRes.json();\n    setKeys(listJson.keys || []);\n    setName('');\n  };\n\n  const revokeKey = async (id: string) => {\n    await fetch('/api/v1/api-keys', {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ id }),\n    });\n    // refresh list\n    const res = await fetch(`/api/v1/api-keys?tenant_id=${encodeURIComponent(tenantId)}`);\n    const json = await res.json();\n    setKeys(json.keys || []);\n  };\n\n  return (\n    <div className=\"p-4\">\n      <h1 className=\"text-2xl font-semibold mb-4\">API Keys</h1>\n      <p className=\"mb-4 text-sm text-gray-600\">\n        Manage programmatic access to your AvidiaTech tenant.  Only owners and admins can create or revoke keys.\n      </p>\n      <div className=\"mb-4\">\n        <input\n          type=\"text\"\n          value={tenantId}\n          onChange={(e) => setTenantId(e.target.value)}\n          placeholder=\"Tenant ID\"\n          className=\"border rounded px-2 py-1 mr-2 text-sm\"\n        />\n        <input\n          type=\"text\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          placeholder=\"Key name\"\n          className=\"border rounded px-2 py-1 mr-2 text-sm\"\n        />\n        <button\n          onClick={createKey}\n          disabled={!tenantId || !name || loading}\n          className=\"bg-blue-600 hover:bg-blue-700 text-white text-sm px-3 py-1 rounded\"\n        >\n          {loading ? 'Creating…' : 'Create key'}\n        </button>\n      </div>\n      {newKey && (\n        <div className=\"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-gray-800\">\n          <p className=\"font-semibold mb-1\">New key generated</p>\n          <p className=\"break-all\">\n            <code>{newKey}</code>\n          </p>\n          <p className=\"text-red-600 mt-1\">This is the only time you’ll see the full key. Store it securely.</p>\n        </div>\n      )}\n      <table className=\"min-w-full text-sm border-collapse\">\n        <thead>\n          <tr className=\"border-b text-left\">\n            <th className=\"py-2\">Name</th>\n            <th className=\"py-2\">Prefix</th>\n            <th className=\"py-2\">Created</th>\n            <th className=\"py-2\">Revoked</th>\n            <th className=\"py-2\"></th>\n          </tr>\n        </thead>\n        <tbody>\n          {keys.map((key) => (\n            <tr key={key.id} className=\"border-b hover:bg-gray-50\">\n              <td className=\"py-2\">{key.name}</td>\n              <td className=\"py-2\">{key.prefix}</td>\n              <td className=\"py-2\">{key.created_at?.slice(0, 10)}</td>\n              <td className=\"py-2\">{key.revoked_at ? key.revoked_at.slice(0, 10) : '-'}</td>\n              <td className=\"py-2\">\n                {!key.revoked_at && (\n                  <button\n                    onClick={() => revokeKey(key.id)}\n                    className=\"text-red-600 hover:underline\"\n                  >\n                    Revoke\n                  </button>\n                )}\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAWe,SAAS,IACtB,GAAM,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAW,EAAE,EACvC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC3B,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAGpD,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,AAAK,GAML,CANI,AACc,MADH,IAEb,IAAM,EAAM,MAAM,MAAM,CAAC,2BAA2B,EAAE,mBAAmB,GAAA,CAAW,EAEpF,EAAQ,CADK,MAAM,EAAI,IAAI,EAAA,EACd,IAAI,EAAI,EAAE,EACzB,GAEF,EAAG,CAAC,EAAS,EAGb,IAAM,EAAY,UAChB,GAAI,CAAC,GAAQ,CAAC,EAAU,OACxB,GAAW,GACX,IAAM,EAAM,MAAM,MAAM,mBAAoB,CAC1C,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,SAAS,CAAC,CAAE,UAAW,OAAU,CAAK,EACnD,GACM,EAAO,MAAM,EAAI,IAAI,GAC3B,GAAW,GACP,EAAK,GAAG,EAAE,AACZ,EAAU,EAAK,GAAG,EAGpB,IAAM,EAAU,MAAM,MAAM,CAAC,2BAA2B,EAAE,mBAAmB,GAAA,CAAW,EAExF,EAAQ,CADS,MAAM,EAAQ,IAAI,EAAA,EAClB,IAAI,EAAI,EAAE,EAC3B,EAAQ,GACV,EAEM,EAAY,MAAO,IACvB,MAAM,MAAM,mBAAoB,CAC9B,OAAQ,SACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,SAAS,CAAC,IAAE,CAAG,EAC5B,GAEA,IAAM,EAAM,MAAM,MAAM,CAAC,2BAA2B,EAAE,mBAAmB,GAAA,CAAW,EAEpF,EAAQ,CADK,MAAM,EAAI,IAAI,EAAA,EACd,IAAI,EAAI,EAAE,CACzB,EAEA,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,uCAA8B,aAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,6GAG1C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,OACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAY,EAAE,MAAM,CAAC,KAAK,EAC3C,YAAY,YACZ,UAAU,0CAEZ,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,OACL,MAAO,EACP,SAAW,AAAD,GAAO,EAAQ,EAAE,MAAM,CAAC,KAAK,EACvC,YAAY,WACZ,UAAU,0CAEZ,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,EACT,SAAU,CAAC,GAAY,CAAC,GAAQ,EAChC,UAAU,8EAET,EAAU,YAAc,kBAG5B,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yFACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8BAAqB,sBAClC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qBACX,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAM,MAET,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,6BAAoB,yEAGrC,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,+CACf,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,UACC,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAG,UAAU,+BACZ,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAO,SACrB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAO,WACrB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAO,YACrB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAO,YACrB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,cAGlB,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,UACE,EAAK,GAAG,CAAC,AAAC,GACT,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAgB,UAAU,sCACzB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAQ,EAAI,IAAI,GAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAQ,EAAI,MAAM,GAChC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAQ,EAAI,UAAU,EAAE,MAAM,EAAG,MAC/C,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAQ,EAAI,UAAU,CAAG,EAAI,UAAU,CAAC,KAAK,CAAC,EAAG,IAAM,MACrE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBACX,CAAC,EAAI,UAAU,EACd,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IAAM,EAAU,EAAI,EAAE,EAC/B,UAAU,wCACX,eAVE,EAAI,EAAE,UAqB3B"}