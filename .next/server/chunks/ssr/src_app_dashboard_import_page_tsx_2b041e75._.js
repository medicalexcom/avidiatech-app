module.exports=[92968,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(70157);function f({orgId:a}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)("bigcommerce"),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(null);async function z(){if(a){g(!0);try{let b=await fetch(`/api/v1/integrations?orgId=${encodeURIComponent(a)}`),c=await b.json().catch(()=>null);b.ok&&c?.ok?e(c.integrations??[]):y(c?.error??"Failed to load")}catch(a){y(String(a?.message??a))}finally{g(!1)}}}async function A(){i(!0),y(null);try{let b={org_id:a,provider:j,name:l||j,config:{},secrets:{}};if("bigcommerce"===j)b.config={store_hash:n},b.secrets={access_token:p};else if("woocommerce"===j)b.config={},b.secrets={consumer_key:r,consumer_secret:t};else if("magento"===j)b.config={},b.secrets={api_token:v};else if("generic-api-key"===j)b.config={},b.secrets={api_key:v};else if("shopify"===j){let b=`/api/v1/integrations/oauth/shopify/start?orgId=${encodeURIComponent(a)}`;try{let a=await fetch(b),c=await a.json().catch(()=>null);c?.redirectUrl?window.location.href=c.redirectUrl:window.location.href=b}finally{i(!1)}return}let c=await fetch("/api/v1/integrations",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(b)}),d=await c.json().catch(()=>null);if(!c.ok||!d?.ok)return void y(d?.error??"Create failed");await z(),m(""),o(""),q(""),s(""),u(""),w("")}catch(a){y(String(a?.message??a))}finally{i(!1)}}async function B(b){y(null);try{let c=await fetch(`/api/v1/integrations/${b}/sync`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({org_id:a})}),d=await c.json().catch(()=>null);if(!c.ok||!d?.ok)return void y(d?.error??"Sync failed");alert(`Sync started: ${d.jobId}`)}catch(a){y(String(a?.message??a))}}return(0,c.useEffect)(()=>{a&&z()},[a]),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Connectors"}),(0,b.jsx)("div",{className:"mt-3 space-y-2",children:f?(0,b.jsx)("div",{children:"Loading…"}):d.map(a=>(0,b.jsxs)("div",{className:"rounded border p-2 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name??a.provider}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:[a.provider," • ",a.status??"ready"]})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)("button",{onClick:()=>B(a.id),className:"px-2 py-1 rounded bg-sky-500 text-white text-xs",children:"Sync now"})})]},a.id))}),(0,b.jsxs)("div",{className:"mt-4 rounded border p-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"Create connector"}),x&&(0,b.jsx)("div",{className:"text-xs text-rose-600 mb-2",children:x}),(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("label",{className:"text-xs",children:"Provider"}),(0,b.jsxs)("select",{value:j,onChange:a=>k(a.target.value),className:"w-full rounded border px-2 py-1",children:[(0,b.jsx)("option",{value:"bigcommerce",children:"BigCommerce (API token)"}),(0,b.jsx)("option",{value:"shopify",children:"Shopify (OAuth)"}),(0,b.jsx)("option",{value:"woocommerce",children:"WooCommerce (consumer key/secret)"}),(0,b.jsx)("option",{value:"magento",children:"Magento (API token)"}),(0,b.jsx)("option",{value:"generic-api-key",children:"Generic API Key"})]})]}),(0,b.jsx)("input",{placeholder:"Connection name",value:l,onChange:a=>m(a.target.value),className:"w-full mb-2 px-2 py-1 border rounded"}),"bigcommerce"===j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{placeholder:"Store hash",value:n,onChange:a=>o(a.target.value),className:"w-full mb-2 px-2 py-1 border rounded"}),(0,b.jsx)("input",{placeholder:"Access token",value:p,onChange:a=>q(a.target.value),className:"w-full mb-2 px-2 py-1 border rounded"})]}),"woocommerce"===j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{placeholder:"Consumer Key",value:r,onChange:a=>s(a.target.value),className:"w-full mb-2 px-2 py-1 border rounded"}),(0,b.jsx)("input",{placeholder:"Consumer Secret",value:t,onChange:a=>u(a.target.value),className:"w-full mb-2 px-2 py-1 border rounded"})]}),("magento"===j||"generic-api-key"===j)&&(0,b.jsx)("input",{placeholder:"API token / key",value:v,onChange:a=>w(a.target.value),className:"w-full mb-2 px-2 py-1 border rounded"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:A,disabled:h,className:"px-3 py-1 bg-emerald-500 text-white rounded text-sm",children:h?"Creating…":"shopify"===j?"Start Shopify auth":"Create connector"}),(0,b.jsx)("button",{onClick:z,className:"px-3 py-1 bg-slate-50 border rounded text-sm",children:"Refresh"})]})]})]})}function g({open:a,runId:d,moduleIndex:e,onClose:f}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null);return((0,c.useEffect)(()=>{a&&(j(!0),l(null),fetch(`/api/v1/pipeline/run/${encodeURIComponent(d)}/module/${e}/logs`).then(a=>a.json()).then(a=>{if(!a?.ok)throw Error(a?.error??"Failed to load logs");h(a.logs??[])}).catch(a=>l(String(a?.message??a))).finally(()=>j(!1)))},[a,d,e]),a)?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,b.jsxs)("div",{className:"w-full max-w-2xl rounded bg-white p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold",children:["Module logs — run ",d.slice(0,8),"… module ",e]}),(0,b.jsx)("button",{onClick:f,className:"px-2 py-1",children:"Close"})]}),(0,b.jsxs)("div",{className:"mt-3",children:[i&&(0,b.jsx)("div",{children:"Loading logs…"}),k&&(0,b.jsx)("div",{className:"text-rose-600",children:k}),!i&&!k&&(0,b.jsx)("pre",{className:"max-h-[60vh] overflow-auto rounded border bg-black p-3 text-[12px] text-white",children:g.length?g.map((a,b)=>"string"==typeof a?`${b+1}: ${a}
`:JSON.stringify(a,null,2)+"\n").join(""):"No logs available."})]})]})}):null}function h({ingestionId:a}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null);return(0,c.useEffect)(()=>{a&&(g(!0),fetch(`/api/v1/pipeline/runs?ingestionId=${encodeURIComponent(a)}`).then(a=>a.json()).then(a=>{if(!a?.ok)throw Error(a?.error??"Failed to load");e(a.runs??[])}).catch(a=>i(String(a?.message??a))).finally(()=>g(!1)))},[a]),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Recent runs"}),f&&(0,b.jsx)("div",{className:"text-xs",children:"Loading…"}),h&&(0,b.jsx)("div",{className:"text-xs text-rose-600",children:h}),!f&&!h&&0===d.length&&(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"No recent runs"}),(0,b.jsx)("ul",{className:"mt-2 space-y-2 text-xs",children:d.map(a=>(0,b.jsxs)("li",{className:"flex items-center justify-between rounded border p-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium",children:[a.status," — ",new Date(a.created_at).toLocaleString()]}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:["Run id: ",String(a.id).slice(0,8),"… duration: ",a.duration_ms?`${Math.round(a.duration_ms/1e3)}s`:"—"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("a",{href:`/dashboard/import?ingestionId=${encodeURIComponent(a.ingestion_id)}&pipelineRunId=${encodeURIComponent(a.id)}`,className:"text-xs px-2 py-1 border rounded",children:"View"}),(0,b.jsx)("button",{onClick:()=>fetch(`/api/v1/pipeline/run/${encodeURIComponent(a.id)}/retry`,{method:"POST"}).then(()=>alert("Retry requested")),className:"text-xs px-2 py-1 bg-slate-50 border rounded",children:"Retry"})]})]},a.id))})]})}function i(a){let b=(a||"").toLowerCase();return"running"===b?"bg-amber-100 text-amber-800 border-amber-200":"failed"===b?"bg-rose-100 text-rose-800 border-rose-200":"succeeded"===b||"completed"===b?"bg-emerald-100 text-emerald-800 border-emerald-200":"bg-slate-100 text-slate-700 border-slate-200"}async function j(a){if(!a)return void alert("No job id");try{let b=await fetch(`/api/v1/imports/${encodeURIComponent(a)}/errors?format=csv`);if(!b.ok){let a=await b.json().catch(()=>null);alert(a?.error??"Failed to download failed rows");return}let c=await b.blob(),d=URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`failed-rows-${a}.csv`,e.click(),URL.revokeObjectURL(d)}catch(a){alert(String(a?.message??a))}}function k(){let a=(0,d.useSearchParams)(),k=(0,d.useRouter)(),l=a?.get("ingestionId")||"",m=a?.get("pipelineRunId")||"",[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(l||""),[z,A]=(0,c.useState)("full"),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(m||""),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(null),[R,S]=(0,c.useState)(null),T=(0,c.useMemo)(()=>p.find(a=>a.id===r)??null,[p,r]);async function U(){try{let a=await fetch("/api/v1/me"),b=await a.json().catch(()=>null);if(a.ok&&b?.ok&&b.org_id)return o(b.org_id),b.org_id;return o(""),""}catch{return o(""),""}}async function V(){if(!n)return void q([]);try{let a=await fetch(`/api/v1/integrations?orgId=${encodeURIComponent(n)}`),b=await a.json().catch(()=>null);a.ok&&b?.ok?q(b.integrations??[]):q([])}catch{q([])}}async function W(a){try{let b=await fetch(`/api/v1/integrations/${encodeURIComponent(a)}/test`,{method:"POST"}),c=await b.json().catch(()=>null);if(!b.ok||!c?.ok)return void alert(`Test failed: ${c?.error??"unknown"}`);alert("Connection test succeeded"),await V()}catch(a){alert(String(a?.message??a))}}async function X(a){if(!n)return alert("Org ID missing — set DEV_ORG_ID or wire session.");try{let b=await fetch(`/api/v1/integrations/${encodeURIComponent(a)}/sync`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({org_id:n})}),c=await b.json().catch(()=>null);if(!b.ok||!c?.ok)return void alert(c?.error??"Sync failed");let d=c.jobId??c.id??"";y(d),Q(`Connector sync started: ${d}`),d&&await Y(d),await V()}catch(a){alert(String(a?.message??a))}}async function Y(a){try{G(null);let b=await fetch(`/api/v1/ingest/${encodeURIComponent(a)}`),c=await b.json().catch(()=>null);if(!b.ok)throw Error(c?.error?.message||c?.error||`Ingest fetch failed: ${b.status}`);let d=c?.data??c;return G(d),d}catch(a){throw G(null),a}}async function Z(a){let b=await fetch(`/api/v1/pipeline/run/${encodeURIComponent(a)}`),c=await b.json().catch(()=>null);if(!b.ok)throw Error(c?.error?.message||c?.error||`Pipeline fetch failed: ${b.status}`);return c}async function $(a,b=3e5,c=2e3){let d=Date.now();for(;Date.now()-d<b;){let b=await Z(a);K(b);let d=b?.run?.status;if("succeeded"===d||"failed"===d)return b;await function(a){return new Promise(b=>setTimeout(b,a))}(c)}throw Error("Pipeline did not complete within timeout")}async function _(a,b){let c=(b??[]).find(a=>"import"===a.module_name);if(!c)return null;let d=await fetch(`/api/v1/pipeline/run/${encodeURIComponent(a)}/output/${c.module_index}`),e=await d.json().catch(()=>null);if(!d.ok)throw Error(e?.error?.message||e?.error||`Import artifact fetch failed: ${d.status}`);return M(e),e}async function aa(a){if(N)return;S(null),Q(null),K(null),M(null);let b=(a??x).trim();if(!b)return void S("Enter an ingestionId first.");O(!0);try{Q("Loading ingestion"),await Y(b),Q("Starting pipeline run");let a=await fetch("/api/v1/pipeline/run",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({ingestionId:b,triggerModule:"import",steps:"import_only"===z?["import"]:["extract","seo","audit","import"],options:{import:{allowOverwriteExisting:B}}})}),c=await a.json().catch(()=>null);if(!a.ok)throw Error(c?.error?.message||c?.error||`Pipeline start failed: ${a.status}`);let d=String(c?.pipelineRunId??"");if(!d)throw Error("Pipeline start did not return pipelineRunId");I(d),k.push(`/dashboard/import?ingestionId=${encodeURIComponent(b)}&pipelineRunId=${encodeURIComponent(d)}`),Q("Pipeline running");let e=await $(d,3e5,2e3);Q("Refreshing ingestion"),await Y(b),Q("Loading import artifact"),await _(d,e?.modules??[]),Q("Import run completed")}catch(a){S(String(a?.message||a)),Q(null)}finally{O(!1)}}(0,c.useEffect)(()=>{(async()=>{if(await U()&&await V(),l&&Y(l).catch(a=>S(String(a?.message||a))),m)try{let a=await Z(m);K(a),I(m),await _(m,a?.modules??[])}catch(a){S(String(a?.message||a))}})()},[]);let ab=(0,c.useMemo)(()=>F?F?.data?.data?F.data.data:F?.data?F.data:F:null,[F]),ac=ab?.diagnostics?.audit??null;"string"==typeof ac?.status&&ac.status,"number"==typeof ac?.score&&ac.score;let ad=ab?.diagnostics?.import??null,ae=ad?.result??null,af=J?.run?.status??null,ag=(0,c.useMemo)(()=>{let a=new Map;for(let b of J?.modules??[])if(b.started_at&&b.finished_at){let c=new Date(b.finished_at).getTime()-new Date(b.started_at).getTime();!Number.isNaN(c)&&c>=0&&a.set(b.module_name,c)}return a},[J]),ah=(0,c.useMemo)(()=>{let a=J?.modules??[];return a.length?Math.round(a.filter(a=>["succeeded","failed","skipped"].includes(a.status)).length/a.length*100):0},[J]);return ae?.action??L?.output?.import?.result?.action,ae?.needs_review??L?.output?.import?.result?.needs_review,(0,b.jsxs)("main",{className:"min-h-screen bg-slate-50 text-slate-900",children:[(0,b.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"inline-flex items-center gap-2 rounded-full border bg-white px-3 py-1 text-xs font-medium",children:"AvidiaImport"}),(0,b.jsx)("div",{className:"text-lg font-semibold",children:"Import & Connector Workspace"})]}),(0,b.jsxs)("div",{className:"text-xs text-slate-600",children:["Status: ",(0,b.jsx)("span",{className:`ml-2 px-2 py-0.5 rounded ${i(af??"idle")}`,children:af??"idle"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[(0,b.jsxs)("aside",{className:"lg:col-span-4 space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-2xl bg-white p-4 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Connectors"}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Manage store connections"})]}),(0,b.jsx)("div",{className:"mt-3 space-y-3",children:(0,b.jsx)(f,{orgId:n})})]}),(0,b.jsxs)("div",{className:"rounded-2xl bg-white p-4 shadow-sm",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Selected store"}),T?(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:T.name??T.provider}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:["Provider: ",T.provider]}),(0,b.jsxs)("div",{className:"text-xs text-slate-400 mt-1",children:["Last synced: ",T.last_synced_at?new Date(T.last_synced_at).toLocaleString():"—"]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,b.jsx)("div",{className:`px-2 py-0.5 rounded text-xs ${"ready"===T.status?"bg-emerald-100 text-emerald-800":"failed"===T.status?"bg-rose-100 text-rose-800":"bg-slate-100 text-slate-700"}`,children:T.status??"unknown"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>W(T.id),className:"text-xs px-2 py-1 border rounded",children:"Test"}),(0,b.jsx)("button",{onClick:()=>X(T.id),className:"text-xs px-2 py-1 bg-sky-600 text-white rounded",children:"Sync"})]})]})]}),(0,b.jsxs)("div",{className:"mt-3 text-xs text-slate-600",children:["Connection:"," ","ready"===T.status?(0,b.jsx)("span",{className:"text-emerald-700",children:"Connected"}):"failed"===T.status?(0,b.jsxs)("span",{className:"text-rose-700",children:["Failed — ",T.last_error??"see details"]}):(0,b.jsx)("span",{children:"Unknown"})]})]}):(0,b.jsx)("div",{className:"mt-3 text-xs text-slate-500",children:"No store selected. Click a connector from the manager to select it."})]}),(0,b.jsxs)("div",{className:"rounded-2xl bg-white p-4 shadow-sm",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Import guidance"}),(0,b.jsxs)("ul",{className:"mt-2 text-xs text-slate-600 space-y-2",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Limits:"})," server enforces max 5,000 rows and 50 columns."]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Deduplication:"})," SKU is recommended for matching existing products."]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Preview:"})," you can preview up to 50 rows before upload."]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Security:"})," tokens are stored encrypted server-side. Client never sees secret keys."]})]})]})]}),(0,b.jsxs)("section",{className:"lg:col-span-8 space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-2xl bg-white p-4 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Upload or Sync"}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Upload CSV/XLSX or sync from a connected store to create an import job."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>{let a=new Blob([["sku,title,description,price,inventory,weight,brand",...[["SKU-001","Sample product","Desc","19.99","10","0.5","Brand"]].map(a=>a.map(a=>`"${String(a).replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download="import-sample.csv",c.click(),URL.revokeObjectURL(b)},className:"text-xs px-2 py-1 border rounded",children:"Download sample CSV"}),(0,b.jsx)("a",{href:"/imports",className:"text-xs px-2 py-1 border rounded",children:"View import history"})]})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(e.default,{bucket:"imports",onCreated:async a=>{a?(y(a),Q(`Import job created: ${a}.`),D?await aa(a):Y(a).catch(()=>null),await U(),await V()):Q("Import created.")}})}),(0,b.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs font-medium uppercase text-slate-500",children:"Ingestion ID / Job"}),(0,b.jsx)("input",{value:x,onChange:a=>y(a.target.value),className:"w-full mt-1 rounded border px-3 py-2"})]}),(0,b.jsxs)("div",{className:"flex items-end gap-2",children:[(0,b.jsxs)("select",{value:r,onChange:a=>s(a.target.value),className:"rounded border px-2 py-2 text-sm w-full",children:[(0,b.jsx)("option",{value:"",children:"Select connector (optional)"}),p.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name??a.provider},a.id))]}),(0,b.jsx)("button",{onClick:()=>{r?X(r):alert("Select a connector")},className:"px-3 py-2 rounded bg-sky-600 text-white",children:"Sync"})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex items-center gap-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-6",children:[(0,b.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:B,onChange:a=>C(a.target.checked)}),(0,b.jsx)("span",{className:"text-xs",children:"Allow overwrite existing SKU"})]}),(0,b.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm mt-2 sm:mt-0",children:[(0,b.jsx)("input",{type:"checkbox",checked:D,onChange:a=>E(a.target.checked)}),(0,b.jsx)("span",{className:"text-xs",children:"Auto-run pipeline after upload"})]})]}),(0,b.jsx)("div",{className:"ml-auto whitespace-nowrap",children:(0,b.jsx)("button",{onClick:()=>aa(),disabled:N,className:"px-4 py-2 rounded bg-emerald-500 text-white",children:N?"Running…":"Run Import"})})]})]}),(0,b.jsxs)("div",{className:"rounded-2xl bg-white p-4 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Live pipeline & artifact"}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:["Progress: ",ah,"%"]})]}),(0,b.jsxs)("div",{className:"mt-3 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"Pipeline modules"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(J?.modules??[]).slice().sort((a,b)=>a.module_index-b.module_index).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded border p-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium",children:[a.module_index,". ",String(a.module_name)]}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:["output_ref: ",(0,b.jsx)("span",{className:"font-mono",children:a.output_ref??"—"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs ${i(a.status)}`,children:a.status}),(0,b.jsx)("div",{className:"text-xs mt-1",children:function(a){if(null==a||Number.isNaN(a))return"—";if(a<1e3)return`${a}ms`;let b=Math.round(a/100)/10;return`${b}s`}(ag.get(a.module_name)??null)}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)("button",{onClick:()=>(function(a){if(!H)return alert("No pipeline run selected");w({runId:H,index:a}),u(!0)})(a.module_index),className:"text-xs px-2 py-1 border rounded",children:"View logs"})})]})]},`${a.module_index}-${a.module_name}`)),!(J?.modules??[]).length&&(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"No active run selected."})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(h,{ingestionId:x})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"Import artifact"}),(0,b.jsx)("pre",{className:"max-h-[300px] overflow-auto rounded border bg-slate-900 p-3 text-[11px] text-white",children:L?JSON.stringify(L,null,2):"Run an import to see artifact JSON."}),(0,b.jsxs)("div",{className:"mt-2 flex justify-between items-center",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Download results"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>{var a;let b,c,d;return a=`import-result-${ab?.id??x??"unknown"}.json`,b=new Blob([JSON.stringify({ingestionId:ab?.id??x??null,pipelineRunId:H||null,diagnostics_import:ad??null,import_artifact:L??null},null,2)],{type:"application/json"}),c=URL.createObjectURL(b),void((d=document.createElement("a")).href=c,d.download=a,d.click(),URL.revokeObjectURL(c))},className:"text-xs px-2 py-1 bg-slate-900 text-white rounded",children:"Export JSON"}),(0,b.jsx)("button",{onClick:()=>j(x),className:"text-xs px-2 py-1 border rounded",children:"Download failed rows"}),(0,b.jsx)("a",{href:"/imports",className:"text-xs px-2 py-1 border rounded",children:"Import history"})]})]})]})]})]}),(0,b.jsxs)("div",{className:"rounded-2xl bg-white p-4 shadow-sm",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Ingestion (context)"}),(0,b.jsx)("pre",{className:"mt-3 max-h-[340px] overflow-auto rounded border bg-slate-900 p-3 text-[11px] text-white",children:ab?JSON.stringify(ab,null,2):"Load an ingestion to view persisted diagnostics."})]})]})]})]}),v&&(0,b.jsx)(g,{open:t,runId:v.runId,moduleIndex:v.index,onClose:()=>u(!1)})]})}a.s(["default",()=>k],92968)}];

//# sourceMappingURL=src_app_dashboard_import_page_tsx_2b041e75._.js.map