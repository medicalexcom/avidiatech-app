{"version":3,"sources":["../../../../src/app/dashboard/bulk/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\n\n/**\n * Bulk job inspector page\n *\n * - Reads bulkJobId from query param\n * - Shows job summary, counters, progress bar\n * - Pages and lists items with status, ingestionId, pipelineRunId, last error\n * - Offers: refresh, auto-poll, download errors CSV, open item in Extract/Describe/Monitor\n * - Per-item: lightweight \"Retry\" action (POST) — if your backend provides a retry endpoint it will be used.\n *\n * Notes:\n * - Endpoints used:\n *   GET  /api/v1/bulk/:id\n *   GET  /api/v1/bulk/:id/items?limit=...&offset=...\n *   GET  /api/v1/bulk/:id/items/errors     -> CSV\n *   POST /api/v1/bulk/:id/items/:itemId/retry  (optional backend support - UI will surface server error if missing)\n */\n\ntype BulkJob = {\n  id: string;\n  name?: string | null;\n  created_by?: string | null;\n  total_items?: number | null;\n  completed_items?: number | null;\n  failed_items?: number | null;\n  status?: string | null;\n  created_at?: string | null;\n  updated_at?: string | null;\n  options?: any;\n};\n\ntype BulkItem = {\n  id: string;\n  item_index: number;\n  input_url: string;\n  metadata?: any;\n  status?: string;\n  ingestion_id?: string | null;\n  pipeline_run_id?: string | null;\n  last_error?: any;\n  started_at?: string | null;\n  finished_at?: string | null;\n};\n\nfunction fmtDate(s?: string | null) {\n  if (!s) return \"—\";\n  try {\n    return new Date(s).toLocaleString();\n  } catch {\n    return s;\n  }\n}\n\nexport default function BulkJobPage() {\n  const params = useSearchParams();\n  const bulkJobId = params?.get(\"bulkJobId\") || \"\";\n\n  const [job, setJob] = useState<BulkJob | null>(null);\n  const [items, setItems] = useState<BulkItem[]>([]);\n  const [loadingJob, setLoadingJob] = useState(false);\n  const [loadingItems, setLoadingItems] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const [limit] = useState<number>(200);\n  const [offset, setOffset] = useState<number>(0);\n\n  const [autoPoll, setAutoPoll] = useState<boolean>(true);\n  const [pollIntervalMs] = useState<number>(3000);\n\n  const [retryingIds, setRetryingIds] = useState<Record<string, boolean>>({});\n  const [actionMessage, setActionMessage] = useState<string | null>(null);\n\n  const jobApiBase = useMemo(() => `/api/v1/bulk/${encodeURIComponent(bulkJobId)}`, [bulkJobId]);\n\n  async function fetchJob() {\n    if (!bulkJobId) return;\n    setLoadingJob(true);\n    setError(null);\n    try {\n      const res = await fetch(jobApiBase);\n      if (!res.ok) {\n        const j = await res.json().catch(() => null);\n        throw new Error(j?.error ?? `Failed to fetch job (${res.status})`);\n      }\n      const j = await res.json();\n      setJob(j?.data ?? j);\n    } catch (e: any) {\n      setError(String(e?.message || e));\n    } finally {\n      setLoadingJob(false);\n    }\n  }\n\n  async function fetchItems() {\n    if (!bulkJobId) return;\n    setLoadingItems(true);\n    setError(null);\n    try {\n      const url = `${jobApiBase}/items?limit=${limit}&offset=${offset}`;\n      const res = await fetch(url);\n      if (!res.ok) {\n        const j = await res.json().catch(() => null);\n        throw new Error(j?.error ?? `Failed to fetch items (${res.status})`);\n      }\n      const j = await res.json();\n      setItems(j?.data ?? j ?? []);\n    } catch (e: any) {\n      setError(String(e?.message || e));\n    } finally {\n      setLoadingItems(false);\n    }\n  }\n\n  useEffect(() => {\n    if (!bulkJobId) return;\n    // initial load\n    fetchJob();\n    fetchItems();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [bulkJobId, offset]);\n\n  // auto poll when running\n  useEffect(() => {\n    if (!bulkJobId || !autoPoll) return;\n    let mounted = true;\n    const t = setInterval(async () => {\n      if (!mounted) return;\n      await fetchJob();\n      await fetchItems();\n    }, pollIntervalMs);\n    return () => {\n      mounted = false;\n      clearInterval(t);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [bulkJobId, autoPoll, offset, pollIntervalMs]);\n\n  const total = job?.total_items ?? (items?.length ?? 0);\n  const completed = job?.completed_items ?? items.filter((i) => i.status === \"succeeded\").length;\n  const failed = job?.failed_items ?? items.filter((i) => i.status === \"failed\").length;\n  const queued = Math.max(0, (total ?? 0) - (completed ?? 0) - (failed ?? 0));\n  const pct = total ? Math.round(((completed ?? 0) / total) * 100) : 0;\n\n  async function downloadErrors() {\n    if (!bulkJobId) return;\n    const url = `${jobApiBase}/items/errors`;\n    // open in new tab (download)\n    window.open(url, \"_blank\");\n  }\n\n  async function retryItem(itemId: string) {\n    if (!bulkJobId || !itemId) return;\n    setRetryingIds((s) => ({ ...s, [itemId]: true }));\n    setActionMessage(null);\n    try {\n      const url = `${jobApiBase}/items/${encodeURIComponent(itemId)}/retry`;\n      const res = await fetch(url, { method: \"POST\" });\n      if (!res.ok) {\n        const j = await res.json().catch(() => null);\n        throw new Error(j?.error ?? `Retry failed (${res.status})`);\n      }\n      setActionMessage(\"Item re-enqueued\");\n      // refresh\n      await fetchItems();\n      await fetchJob();\n    } catch (e: any) {\n      setActionMessage(String(e?.message || e));\n    } finally {\n      setRetryingIds((s) => {\n        const next = { ...s };\n        delete next[itemId];\n        return next;\n      });\n      // clear message after 4s\n      setTimeout(() => setActionMessage(null), 4000);\n    }\n  }\n\n  async function retryFailedItems() {\n    if (!bulkJobId) return;\n    setActionMessage(null);\n    try {\n      const url = `${jobApiBase}/retry-failed`;\n      const res = await fetch(url, { method: \"POST\" });\n      if (!res.ok) {\n        const j = await res.json().catch(() => null);\n        throw new Error(j?.error ?? `Retry failed (${res.status})`);\n      }\n      setActionMessage(\"Failed items enqueued for retry\");\n      await fetchItems();\n      await fetchJob();\n    } catch (e: any) {\n      setActionMessage(String(e?.message || e));\n    } finally {\n      setTimeout(() => setActionMessage(null), 4000);\n    }\n  }\n\n  function openExtract(ingestionId?: string | null) {\n    if (!ingestionId) return;\n    window.open(`/dashboard/extract?ingestionId=${encodeURIComponent(ingestionId)}`, \"_blank\");\n  }\n  function openDescribe(ingestionId?: string | null) {\n    if (!ingestionId) return;\n    window.open(`/dashboard/describe?ingestionId=${encodeURIComponent(ingestionId)}`, \"_blank\");\n  }\n  function openMonitor(ingestionId?: string | null) {\n    if (!ingestionId) return;\n    window.open(`/dashboard/monitor?ingestionId=${encodeURIComponent(ingestionId)}`, \"_blank\");\n  }\n\n  return (\n    <div className=\"mx-auto max-w-7xl p-4\">\n      <div className=\"flex items-start justify-between gap-4 mb-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Bulk job</h1>\n          <div className=\"mt-1 text-sm text-slate-600\">\n            Job id: <span className=\"font-mono\">{bulkJobId || \"—\"}</span>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={() => {\n              fetchJob();\n              fetchItems();\n            }}\n            className=\"rounded-md border px-3 py-2 text-sm bg-white\"\n            disabled={!bulkJobId || loadingJob || loadingItems}\n          >\n            Refresh\n          </button>\n\n          <label className=\"inline-flex items-center gap-2 text-sm\">\n            <input type=\"checkbox\" checked={autoPoll} onChange={(e) => setAutoPoll(e.target.checked)} />\n            Auto refresh\n          </label>\n\n          <button\n            onClick={downloadErrors}\n            className=\"rounded-md bg-rose-600 px-3 py-2 text-sm text-white\"\n            disabled={!bulkJobId}\n            title=\"Download CSV of failed items\"\n          >\n            Download errors CSV\n          </button>\n        </div>\n      </div>\n\n      {error ? (\n        <div className=\"mb-4 rounded-md border border-rose-300 bg-rose-50 p-3 text-sm text-rose-800\">{error}</div>\n      ) : null}\n\n      <div className=\"grid grid-cols-1 gap-4 lg:grid-cols-12\">\n        {/* Left: main */}\n        <div className=\"lg:col-span-8 space-y-4\">\n          <section className=\"rounded-2xl border bg-white p-4 shadow-sm\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-xs text-slate-500\">Summary</div>\n                <h2 className=\"text-lg font-semibold\">{job?.name ?? \"Bulk job\"}</h2>\n              </div>\n\n              <div className=\"text-right\">\n                <div className=\"text-xs text-slate-500\">Created</div>\n                <div className=\"font-mono text-sm\">{fmtDate(job?.created_at)}</div>\n              </div>\n            </div>\n\n            <div className=\"mt-4\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"rounded-lg border px-3 py-2 text-sm\">\n                  Total: <span className=\"font-semibold ml-2\">{total ?? \"—\"}</span>\n                </div>\n                <div className=\"rounded-lg border px-3 py-2 text-sm\">\n                  Completed: <span className=\"font-semibold ml-2\">{completed ?? 0}</span>\n                </div>\n                <div className=\"rounded-lg border px-3 py-2 text-sm\">\n                  Failed: <span className=\"font-semibold ml-2\">{failed ?? 0}</span>\n                </div>\n                <div className=\"rounded-lg border px-3 py-2 text-sm\">\n                  Queued: <span className=\"font-semibold ml-2\">{queued ?? 0}</span>\n                </div>\n              </div>\n\n              <div className=\"mt-3\">\n                <div className=\"h-3 w-full rounded-full bg-slate-200\">\n                  <div\n                    className=\"h-3 rounded-full bg-gradient-to-r from-sky-400 via-emerald-400 to-amber-400\"\n                    style={{ width: `${Math.min(100, Math.max(0, pct))}%` }}\n                  />\n                </div>\n                <div className=\"mt-2 text-sm text-slate-500\">Progress: {pct}%</div>\n              </div>\n            </div>\n          </section>\n\n          <section className=\"rounded-2xl border bg-white p-4 shadow-sm\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-sm font-semibold\">Items</h3>\n              <div className=\"text-xs text-slate-500\">Showing {items.length} items (offset {offset})</div>\n            </div>\n\n            <div className=\"mt-3 overflow-auto\">\n              <table className=\"min-w-full text-sm\">\n                <thead>\n                  <tr className=\"text-left text-xs text-slate-500\">\n                    <th className=\"py-2 pr-3\">#</th>\n                    <th className=\"py-2 pr-3\">URL</th>\n                    <th className=\"py-2 pr-3\">Status</th>\n                    <th className=\"py-2 pr-3\">Ingestion</th>\n                    <th className=\"py-2 pr-3\">Pipeline</th>\n                    <th className=\"py-2 pr-3\">Error</th>\n                    <th className=\"py-2 pr-3\">Actions</th>\n                  </tr>\n                </thead>\n\n                <tbody>\n                  {loadingItems ? (\n                    <tr>\n                      <td className=\"py-4 text-sm text-slate-500\" colSpan={7}>\n                        Loading items…\n                      </td>\n                    </tr>\n                  ) : items.length === 0 ? (\n                    <tr>\n                      <td className=\"py-4 text-sm text-slate-500\" colSpan={7}>\n                        No items found.\n                      </td>\n                    </tr>\n                  ) : (\n                    items.map((it) => (\n                      <tr key={it.id} className=\"border-t\">\n                        <td className=\"py-2 pr-3 align-top\">{it.item_index + 1}</td>\n                        <td className=\"py-2 pr-3 align-top max-w-[36ch] truncate\">{it.input_url}</td>\n                        <td className=\"py-2 pr-3 align-top\">\n                          <span className={`inline-flex items-center rounded-full px-2 py-0.5 text-xs ${it.status === \"succeeded\" ? \"bg-emerald-50 text-emerald-700\" : it.status === \"failed\" ? \"bg-rose-50 text-rose-700\" : \"bg-slate-100 text-slate-700\"}`}>\n                            {it.status ?? \"—\"}\n                          </span>\n                        </td>\n                        <td className=\"py-2 pr-3 align-top\">\n                          {it.ingestion_id ? (\n                            <button className=\"text-xs text-sky-700 underline\" onClick={() => openExtract(it.ingestion_id)}>{it.ingestion_id.slice(0, 10)}…</button>\n                          ) : (\n                            \"—\"\n                          )}\n                        </td>\n                        <td className=\"py-2 pr-3 align-top\">\n                          {it.pipeline_run_id ? (\n                            <a className=\"text-xs underline\" href={`/api/v1/pipeline/run/${encodeURIComponent(it.pipeline_run_id)}/output/0`} target=\"_blank\" rel=\"noreferrer\">\n                              {it.pipeline_run_id.slice(0, 10)}…\n                            </a>\n                          ) : (\n                            \"—\"\n                          )}\n                        </td>\n                        <td className=\"py-2 pr-3 align-top\">\n                          {it.last_error ? (\n                            <div className=\"max-w-[28ch] truncate text-xs text-rose-700\">{typeof it.last_error === \"string\" ? it.last_error : JSON.stringify(it.last_error)}</div>\n                          ) : (\n                            \"—\"\n                          )}\n                        </td>\n                        <td className=\"py-2 pr-3 align-top\">\n                          <div className=\"flex flex-wrap gap-2\">\n                            <button\n                              className=\"rounded px-2 py-1 text-xs border bg-white\"\n                              onClick={() => openExtract(it.ingestion_id)}\n                              disabled={!it.ingestion_id}\n                            >\n                              Open Extract\n                            </button>\n                            <button\n                              className=\"rounded px-2 py-1 text-xs border bg-white\"\n                              onClick={() => openDescribe(it.ingestion_id)}\n                              disabled={!it.ingestion_id}\n                            >\n                              Open Describe\n                            </button>\n                            <button\n                              className=\"rounded px-2 py-1 text-xs border bg-white\"\n                              onClick={() => openMonitor(it.ingestion_id)}\n                              disabled={!it.ingestion_id}\n                            >\n                              Open Monitor\n                            </button>\n\n                            <button\n                              className=\"rounded px-2 py-1 text-xs bg-amber-400 text-slate-900\"\n                              disabled={retryingIds[it.id] || it.status !== \"failed\"}\n                              onClick={() => retryItem(it.id)}\n                            >\n                              {retryingIds[it.id] ? \"Retrying…\" : \"Retry\"}\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))\n                  )}\n                </tbody>\n              </table>\n            </div>\n\n            <div className=\"mt-4 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-sm\">\n                <button\n                  className=\"rounded px-2 py-1 border\"\n                  onClick={() => setOffset(Math.max(0, offset - limit))}\n                  disabled={offset === 0}\n                >\n                  Prev\n                </button>\n                <button className=\"rounded px-2 py-1 border\" onClick={() => setOffset(offset + limit)} disabled={items.length < limit}>\n                  Next\n                </button>\n                <div className=\"text-xs text-slate-500\">offset {offset}</div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <button className=\"rounded px-3 py-2 bg-sky-600 text-white text-sm\" onClick={retryFailedItems} disabled={failed === 0}>\n                  Retry failed items\n                </button>\n                {actionMessage ? <div className=\"text-sm text-slate-600\">{actionMessage}</div> : null}\n              </div>\n            </div>\n          </section>\n        </div>\n\n        {/* Right rail */}\n        <aside className=\"lg:col-span-4 space-y-4\">\n          <section className=\"rounded-2xl border bg-white p-4 shadow-sm\">\n            <h3 className=\"text-sm font-semibold\">Job details</h3>\n            <div className=\"mt-3 text-sm text-slate-700\">\n              <div><strong>Name:</strong> {job?.name ?? \"—\"}</div>\n              <div><strong>Created by:</strong> <span className=\"font-mono\">{job?.created_by ?? \"—\"}</span></div>\n              <div><strong>Created:</strong> {fmtDate(job?.created_at)}</div>\n              <div><strong>Updated:</strong> {fmtDate(job?.updated_at)}</div>\n            </div>\n          </section>\n\n          <section className=\"rounded-2xl border bg-white p-4 shadow-sm\">\n            <h3 className=\"text-sm font-semibold\">Quick actions</h3>\n            <div className=\"mt-3 space-y-2\">\n              <button className=\"w-full rounded px-3 py-2 bg-sky-600 text-white\" onClick={downloadErrors} disabled={!bulkJobId}>\n                Download failed rows CSV\n              </button>\n              <button\n                className=\"w-full rounded px-3 py-2 bg-white border text-sm\"\n                onClick={() => {\n                  fetchJob();\n                  fetchItems();\n                }}\n              >\n                Refresh now\n              </button>\n            </div>\n          </section>\n\n          <section className=\"rounded-2xl border bg-white p-4 shadow-sm\">\n            <h3 className=\"text-sm font-semibold\">Diagnostics</h3>\n            <div className=\"mt-2 text-xs text-slate-600\">\n              Failed rows will appear here and can be downloaded for inspection. If items are stuck, check worker logs and Redis connectivity.\n            </div>\n          </section>\n        </aside>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}